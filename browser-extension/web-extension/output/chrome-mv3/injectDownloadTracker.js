var injectdownloadtracker=function(){"use strict";var Dt=Object.defineProperty;var qt=(Y,N,$)=>N in Y?Dt(Y,N,{enumerable:!0,configurable:!0,writable:!0,value:$}):Y[N]=$;var B=(Y,N,$)=>qt(Y,typeof N!="symbol"?N+"":N,$);function Y(s){return s==null||typeof s=="function"?{main:s}:s}var N={},$={},K={},q={},H={},ae={},Ee;function Ze(){if(Ee)return ae;Ee=1;function s(o){return o}function d(o){return o.length===0?s:o.length===1?o[0]:function(n){return o.reduce((e,r)=>r(e),n)}}function a(o){return typeof o=="object"&&o!==null&&"subscribe"in o}function t(o){const u={subscribe(n){let e=null,r=!1,i=!1,c=!1;function f(){if(e===null){c=!0;return}i||(i=!0,typeof e=="function"?e():e&&e.unsubscribe())}return e=o({next(m){var l;r||(l=n.next)==null||l.call(n,m)},error(m){var l;r||(r=!0,(l=n.error)==null||l.call(n,m),f())},complete(){var m;r||(r=!0,(m=n.complete)==null||m.call(n),f())}}),c&&f(),{unsubscribe:f}},pipe(...n){return d(n)(u)}};return u}return ae.isObservable=a,ae.observable=t,ae}var we;function G(){if(we)return H;we=1,Object.defineProperty(H,"__esModule",{value:!0});var s=Ze();function d(n){return e=>{let r=0,i=null;const c=[];function f(){i||(i=e.subscribe({next(l){var p;for(const b of c)(p=b.next)==null||p.call(b,l)},error(l){var p;for(const b of c)(p=b.error)==null||p.call(b,l)},complete(){var l;for(const p of c)(l=p.complete)==null||l.call(p)}}))}function m(){if(r===0&&i){const l=i;i=null,l.unsubscribe()}}return{subscribe(l){return r++,c.push(l),f(),{unsubscribe(){r--,m();const p=c.findIndex(b=>b===l);p>-1&&c.splice(p,1)}}}}}}function a(n){return e=>({subscribe(r){let i=0;return e.subscribe({next(f){var m;(m=r.next)==null||m.call(r,n(f,i++))},error(f){var m;(m=r.error)==null||m.call(r,f)},complete(){var f;(f=r.complete)==null||f.call(r)}})}})}function t(n){return e=>({subscribe(r){return e.subscribe({next(i){var c,f;(c=n.next)==null||c.call(n,i),(f=r.next)==null||f.call(r,i)},error(i){var c,f;(c=n.error)==null||c.call(n,i),(f=r.error)==null||f.call(r,i)},complete(){var i,c;(i=n.complete)==null||i.call(n),(c=r.complete)==null||c.call(r)}})}})}class o extends Error{constructor(e){super(e),this.name="ObservableAbortError",Object.setPrototypeOf(this,o.prototype)}}function u(n){let e;return{promise:new Promise((i,c)=>{let f=!1;function m(){f||(f=!0,c(new o("This operation was aborted.")),l.unsubscribe())}const l=n.subscribe({next(p){f=!0,i(p),m()},error(p){f=!0,c(p),m()},complete(){f=!0,m()}});e=m}),abort:e}}return H.isObservable=s.isObservable,H.observable=s.observable,H.map=a,H.observableToPromise=u,H.share=d,H.tap=t,H}var ue={},Ce;function Xe(){if(Ce)return ue;Ce=1;var s=G();function d(o){return s.observable(u=>{function n(r=0,i=o.op){const c=o.links[r];if(!c)throw new Error("No more links to execute - did you forget to add an ending link?");return c({op:i,next(m){return n(r+1,m)}})}return n().subscribe(u)})}function a(o){return Array.isArray(o)?o:[o]}function t(o){return u=>{const n=a(o.true).map(r=>r(u)),e=a(o.false).map(r=>r(u));return r=>s.observable(i=>{const c=o.condition(r.op)?n:e;return d({op:r.op,links:c}).subscribe(i)})}}return ue.createChain=d,ue.splitLink=t,ue}var me={},W={},J={},Z={},Pe;function be(){if(Pe)return Z;Pe=1;function s(t){const o=Object.create(null);for(const u in t){const n=t[u];o[n]=u}return o}const d={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099},a=s(d);return Z.TRPC_ERROR_CODES_BY_KEY=d,Z.TRPC_ERROR_CODES_BY_NUMBER=a,Z.invert=s,Z}var Le;function ve(){if(Le)return J;Le=1;var s=be();const d=s.invert(s.TRPC_ERROR_CODES_BY_KEY),a={PARSE_ERROR:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,FORBIDDEN:403,METHOD_NOT_SUPPORTED:405,TIMEOUT:408,CONFLICT:409,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,UNPROCESSABLE_CONTENT:422,TOO_MANY_REQUESTS:429,CLIENT_CLOSED_REQUEST:499,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501};function t(c){return a[c]??500}function o(c){const f=Array.isArray(c)?c:[c],m=new Set(f.map(p=>{if("error"in p){const b=p.error.data;if(typeof b.httpStatus=="number")return b.httpStatus;const E=d[p.error.code];return t(E)}return 200}));return m.size!==1?207:m.values().next().value}function u(c){return t(c.code)}const n=()=>{};function e(c,f){return new Proxy(n,{get(l,p){if(!(typeof p!="string"||p==="then"))return e(c,[...f,p])},apply(l,p,b){const E=f[f.length-1]==="apply";return c({args:E?b.length>=2?b[1]:[]:b,path:E?f.slice(0,-1):f})}})}const r=c=>e(c,[]),i=c=>new Proxy(n,{get(f,m){if(!(typeof m!="string"||m==="then"))return c(m)}});return J.TRPC_ERROR_CODES_BY_NUMBER=d,J.createFlatProxy=i,J.createRecursiveProxy=r,J.getHTTPStatusCode=o,J.getHTTPStatusCodeFromError=u,J}var ce={},ke;function et(){if(ke)return ce;ke=1;var s=ve(),d=be();function a(u){const{path:n,error:e,config:r}=u,{code:i}=u.error,c={message:e.message,code:d.TRPC_ERROR_CODES_BY_KEY[i],data:{code:i,httpStatus:s.getHTTPStatusCodeFromError(e)}};return r.isDev&&typeof u.error.stack=="string"&&(c.data.stack=u.error.stack),typeof n=="string"&&(c.data.path=n),r.errorFormatter({...u,shape:c})}function t(u,n){return"error"in n?{...n,error:u.transformer.output.serialize(n.error)}:"data"in n.result?{...n,result:{...n.result,data:u.transformer.output.serialize(n.result.data)}}:n}function o(u,n){return Array.isArray(n)?n.map(e=>t(u,e)):t(u,n)}return ce.getErrorShape=a,ce.transformTRPCResponse=o,ce}var ge={},xe;function tt(){if(xe)return ge;xe=1;function s(t){return!!t&&!Array.isArray(t)&&typeof t=="object"}class d extends Error{}function a(t){if(t instanceof Error)return t;const o=typeof t;if(!(o==="undefined"||o==="function"||t===null)){if(o!=="object")return new Error(String(t));if(s(t)){const u=new d;for(const n in t)u[n]=t[n];return u}}}return ge.getCauseFromUnknown=a,ge}var Oe;function le(){if(Oe)return W;Oe=1,Object.defineProperty(W,"__esModule",{value:!0});var s=ve(),d=et(),a=tt();return be(),W.createFlatProxy=s.createFlatProxy,W.createRecursiveProxy=s.createRecursiveProxy,W.getErrorShape=d.getErrorShape,W.transformTRPCResponse=d.transformTRPCResponse,W.getCauseFromUnknown=a.getCauseFromUnknown,W}var de={},_e;function X(){if(_e)return de;_e=1;function s(o){return!!o&&!Array.isArray(o)&&typeof o=="object"}function d(o,u){if("error"in o){const e=u.transformer.deserialize(o.error);return{ok:!1,error:{...o,error:e}}}return{ok:!0,result:{...o.result,...(!o.result.type||o.result.type==="data")&&{type:"data",data:u.transformer.deserialize(o.result.data)}}}}class a extends Error{constructor(){super("Unable to transform response from server")}}function t(o,u){let n;try{n=d(o,u)}catch{throw new a}if(!n.ok&&(!s(n.error.error)||typeof n.error.error.code!="number"))throw new a;if(n.ok&&!s(n.result))throw new a;return n}return de.isObject=s,de.transformResult=t,de}var Se;function ee(){if(Se)return me;Se=1;var s=le(),d=X();function a(u){return u instanceof o||u instanceof Error&&u.name==="TRPCClientError"}function t(u){return d.isObject(u)&&d.isObject(u.error)&&typeof u.error.code=="number"&&typeof u.error.message=="string"}class o extends Error{static from(n,e={}){const r=n;return a(r)?(e.meta&&(r.meta={...r.meta,...e.meta}),r):t(r)?new o(r.error.message,{...e,result:r}):r instanceof Error?new o(r.message,{...e,cause:s.getCauseFromUnknown(r)}):new o("Unknown error",{...e,cause:r})}constructor(n,e){var i,c;const r=e==null?void 0:e.cause;super(n,{cause:r}),this.meta=e==null?void 0:e.meta,this.cause=r,this.shape=(i=e==null?void 0:e.result)==null?void 0:i.error,this.data=(c=e==null?void 0:e.result)==null?void 0:c.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,o.prototype)}}return me.TRPCClientError=o,me}var z={},De;function ye(){if(De)return z;De=1;var s=ee();const d=l=>typeof l=="function";function a(l){if(l)return l;if(typeof window<"u"&&d(window.fetch))return window.fetch;if(typeof globalThis<"u"&&d(globalThis.fetch))return globalThis.fetch;throw new Error("No fetch implementation found")}function t(l){return l||(typeof window<"u"&&window.AbortController?window.AbortController:typeof globalThis<"u"&&globalThis.AbortController?globalThis.AbortController:null)}function o(l){return{url:l.url.toString().replace(/\/$/,""),fetch:l.fetch,AbortController:t(l.AbortController)}}function u(l){const p={};for(let b=0;b<l.length;b++){const E=l[b];p[b]=E}return p}const n={query:"GET",mutation:"POST"};function e(l){return"input"in l?l.runtime.transformer.serialize(l.input):u(l.inputs.map(p=>l.runtime.transformer.serialize(p)))}const r=l=>{let p=l.url+"/"+l.path;const b=[];if("inputs"in l&&b.push("batch=1"),l.type==="query"){const E=e(l);E!==void 0&&b.push(`input=${encodeURIComponent(JSON.stringify(E))}`)}return b.length&&(p+="?"+b.join("&")),p},i=l=>{if(l.type==="query")return;const p=e(l);return p!==void 0?JSON.stringify(p):void 0},c=l=>m({...l,contentTypeHeader:"application/json",getUrl:r,getBody:i});async function f(l,p){const b=l.getUrl(l),E=l.getBody(l),{type:w}=l,T=await l.headers();/* istanbul ignore if -- @preserve */if(w==="subscription")throw new Error("Subscriptions should use wsLink");const L={...l.contentTypeHeader?{"content-type":l.contentTypeHeader}:{},...l.batchModeHeader?{"trpc-batch-mode":l.batchModeHeader}:{},...T};return a(l.fetch)(b,{method:n[w],signal:p==null?void 0:p.signal,body:E,headers:L})}function m(l){const p=l.AbortController?new l.AbortController:null,b={};let E=!1;return{promise:new Promise((L,S)=>{f(l,p).then(P=>(b.response=P,E=!0,P.json())).then(P=>{b.responseJSON=P,L({json:P,meta:b})}).catch(P=>{E=!0,S(s.TRPCClientError.from(P,{meta:b}))})}),cancel:()=>{E||p==null||p.abort()}}}return z.fetchHTTPResponse=f,z.getBody=i,z.getFetch=a,z.getUrl=r,z.httpRequest=m,z.jsonHttpRequester=c,z.resolveHTTPLinkOptions=o,z}var fe={},qe;function rt(){if(qe)return fe;qe=1;var s=G(),d=X(),a=ee(),t=ye();const o=()=>{throw new Error("Something went wrong. Please submit an issue at https://github.com/trpc/trpc/issues/new")};function u(i){let c=null,f=null;const m=()=>{clearTimeout(f),f=null,c=null};function l(E){var L,S;const w=[[]];let T=0;for(;;){const P=E[T];if(!P)break;const D=w[w.length-1];if(P.aborted){(L=P.reject)==null||L.call(P,new Error("Aborted")),T++;continue}if(i.validate(D.concat(P).map(v=>v.key))){D.push(P),T++;continue}if(D.length===0){(S=P.reject)==null||S.call(P,new Error("Input is too big for a single dispatch")),T++;continue}w.push([])}return w}function p(){const E=l(c);m();for(const w of E){if(!w.length)continue;const T={items:w,cancel:o};for(const D of w)D.batch=T;const L=(D,M)=>{var A;const v=T.items[D];(A=v.resolve)==null||A.call(v,M),v.batch=null,v.reject=null,v.resolve=null},{promise:S,cancel:P}=i.fetch(T.items.map(D=>D.key),L);T.cancel=P,S.then(D=>{var M;for(let v=0;v<D.length;v++){const A=D[v];L(v,A)}for(const v of T.items)(M=v.reject)==null||M.call(v,new Error("Missing result")),v.batch=null}).catch(D=>{var M;for(const v of T.items)(M=v.reject)==null||M.call(v,D),v.batch=null})}}function b(E){const w={aborted:!1,key:E,batch:null,resolve:o,reject:o},T=new Promise((S,P)=>{w.reject=P,w.resolve=S,c||(c=[]),c.push(w)});return f||(f=setTimeout(p)),{promise:T,cancel:()=>{var S;w.aborted=!0,(S=w.batch)!=null&&S.items.every(P=>P.aborted)&&(w.batch.cancel(),w.batch=null)}}}return{load:b}}function n(i){return function(f){const m=t.resolveHTTPLinkOptions(f),l=f.maxURLLength??1/0;return p=>{const b=S=>{const P=M=>{if(l===1/0)return!0;const v=M.map(U=>U.path).join(","),A=M.map(U=>U.input);return t.getUrl({...m,runtime:p,type:S,path:v,inputs:A}).length<=l},D=i({...m,runtime:p,type:S,opts:f});return{validate:P,fetch:D}},E=u(b("query")),w=u(b("mutation")),T=u(b("subscription")),L={query:E,subscription:T,mutation:w};return({op:S})=>s.observable(P=>{const D=L[S.type],{promise:M,cancel:v}=D.load(S);let A;return M.then(j=>{A=j;const U=d.transformResult(j.json,p);if(!U.ok){P.error(a.TRPCClientError.from(U.error,{meta:j.meta}));return}P.next({context:j.meta,result:U.result}),P.complete()}).catch(j=>{P.error(a.TRPCClientError.from(j,{meta:A==null?void 0:A.meta}))}),()=>{v()}})}}}const r=n(i=>c=>{const f=c.map(b=>b.path).join(","),m=c.map(b=>b.input),{promise:l,cancel:p}=t.jsonHttpRequester({...i,path:f,inputs:m,headers(){return i.opts.headers?typeof i.opts.headers=="function"?i.opts.headers({opList:c}):i.opts.headers:{}}});return{promise:l.then(b=>(Array.isArray(b.json)?b.json:c.map(()=>b.json)).map(T=>({meta:b.meta,json:T}))),cancel:p}});return fe.createHTTPBatchLink=n,fe.httpBatchLink=r,fe}var te={},Me;function nt(){if(Me)return te;Me=1,Object.defineProperty(te,"__esModule",{value:!0});var s=G(),d=X(),a=ee(),t=ye();le();function o(n){return e=>{const r=t.resolveHTTPLinkOptions(e);return i=>({op:c})=>s.observable(f=>{const{path:m,input:l,type:p}=c,{promise:b,cancel:E}=n.requester({...r,runtime:i,type:p,path:m,input:l,headers(){return e.headers?typeof e.headers=="function"?e.headers({op:c}):e.headers:{}}});let w;return b.then(T=>{w=T.meta;const L=d.transformResult(T.json,i);if(!L.ok){f.error(a.TRPCClientError.from(L.error,{meta:w}));return}f.next({context:T.meta,result:L.result}),f.complete()}).catch(T=>{f.error(a.TRPCClientError.from(T,{meta:w}))}),()=>{E()}})}}const u=o({requester:t.jsonHttpRequester});return te.httpLink=u,te.httpLinkFactory=o,te}var pe={},Ae;function ot(){if(Ae)return pe;Ae=1,Object.defineProperty(pe,"__esModule",{value:!0});var s=G();function d(n){return typeof FormData>"u"?!1:n instanceof FormData}const a={css:{query:["72e3ff","3fb0d8"],mutation:["c5a3fc","904dfc"],subscription:["ff49e1","d83fbe"]},ansi:{regular:{query:["\x1B[30;46m","\x1B[97;46m"],mutation:["\x1B[30;45m","\x1B[97;45m"],subscription:["\x1B[30;42m","\x1B[97;42m"]},bold:{query:["\x1B[1;30;46m","\x1B[1;97;46m"],mutation:["\x1B[1;30;45m","\x1B[1;97;45m"],subscription:["\x1B[1;30;42m","\x1B[1;97;42m"]}}};function t(n){const{direction:e,type:r,path:i,id:c,input:f}=n,m=[],l=[];if(n.colorMode==="ansi"){const[w,T]=a.ansi.regular[r],[L,S]=a.ansi.bold[r];return m.push(e==="up"?w:T,e==="up"?">>":"<<",r,e==="up"?L:S,`#${c}`,i,"\x1B[0m"),e==="up"?l.push({input:n.input}):l.push({input:n.input,result:"result"in n.result?n.result.result:n.result,elapsedMs:n.elapsedMs}),{parts:m,args:l}}const[p,b]=a.css[r],E=`
    background-color: #${e==="up"?p:b}; 
    color: ${e==="up"?"black":"white"};
    padding: 2px;
  `;return m.push("%c",e==="up"?">>":"<<",r,`#${c}`,`%c${i}%c`,"%O"),l.push(E,`${E}; font-weight: bold;`,`${E}; font-weight: normal;`),e==="up"?l.push({input:f,context:n.context}):l.push({input:f,result:n.result,elapsedMs:n.elapsedMs,context:n.context}),{parts:m,args:l}}const o=({c:n=console,colorMode:e="css"})=>r=>{const i=r.input,c=d(i)?Object.fromEntries(i):i,{parts:f,args:m}=t({...r,colorMode:e,input:c}),l=r.direction==="down"&&r.result&&(r.result instanceof Error||"error"in r.result.result)?"error":"log";n[l].apply(null,[f.join(" ")].concat(m))};function u(n={}){const{enabled:e=()=>!0}=n,r=n.colorMode??(typeof window>"u"?"ansi":"css"),{logger:i=o({c:n.console,colorMode:r})}=n;return()=>({op:c,next:f})=>s.observable(m=>{e({...c,direction:"up"})&&i({...c,direction:"up"});const l=Date.now();function p(b){const E=Date.now()-l;e({...c,direction:"down",result:b})&&i({...c,direction:"down",elapsedMs:E,result:b})}return f(c).pipe(s.tap({next(b){p(b)},error(b){p(b)}})).subscribe(m)})}return pe.loggerLink=u,pe}var re={},Ne;function it(){if(Ne)return re;Ne=1,Object.defineProperty(re,"__esModule",{value:!0});var s=G(),d=X(),a=ee();le();/* istanbul ignore next -- @preserve */const t=e=>e===0?0:Math.min(1e3*2**e,3e4);function o(e){const{url:r,WebSocket:i=WebSocket,retryDelayMs:c=t,onOpen:f,onClose:m}=e;/* istanbul ignore next -- @preserve */if(!i)throw new Error("No WebSocket implementation found - you probably don't want to use this on the server, but if you do you need to pass a `WebSocket`-ponyfill");let l=[];const p=Object.create(null);let b=0,E=null,w=null,T=U(),L="connecting";function S(){L!=="open"||E||(E=setTimeout(()=>{E=null,l.length===1?T.send(JSON.stringify(l.pop())):T.send(JSON.stringify(l)),l=[]}))}function P(){if(w!==null||L==="closed")return;const g=c(b++);M(g)}function D(){L="connecting";const g=T;T=U(),v(g)}function M(g){w||(L="connecting",w=setTimeout(D,g))}function v(g){Object.values(p).some(h=>h.ws===g)||g.close()}function A(){Object.values(p).forEach(g=>{g.type==="subscription"&&g.callbacks.complete()})}function j(g){l.some(R=>R.id===g.op.id)||y(g.op,g.callbacks)}function U(){const g=typeof r=="function"?r():r,R=new i(g);clearTimeout(w),w=null,R.addEventListener("open",()=>{/* istanbul ignore next -- @preserve */R===T&&(b=0,L="open",f==null||f(),S())}),R.addEventListener("error",()=>{R===T&&P()});const h=k=>{if(k.method==="reconnect"&&R===T){L==="open"&&(m==null||m()),D();for(const C of Object.values(p))C.type==="subscription"&&j(C)}},x=k=>{var _,O;const C=k.id!==null&&p[k.id];if(C){if((O=(_=C.callbacks).next)==null||O.call(_,k),C.ws!==T&&R===T){const I=C.ws;C.ws=T,v(I)}"result"in k&&k.result.type==="stopped"&&R===T&&C.callbacks.complete()}};return R.addEventListener("message",({data:k})=>{const C=JSON.parse(k);"method"in C?h(C):x(C),(R!==T||L==="closed")&&v(R)}),R.addEventListener("close",({code:k})=>{var C,_,O,I;L==="open"&&(m==null||m({code:k})),T===R&&P();for(const[se,V]of Object.entries(p))if(V.ws===R){if(L==="closed"){delete p[se],(_=(C=V.callbacks).complete)==null||_.call(C);continue}V.type==="subscription"?j(V):(delete p[se],(I=(O=V.callbacks).error)==null||I.call(O,a.TRPCClientError.from(new u("WebSocket closed prematurely"))))}}),R}function y(g,R){const{type:h,input:x,path:k,id:C}=g,_={id:C,method:h,params:{input:x,path:k}};return p[C]={ws:T,type:h,callbacks:R,op:g},l.push(_),S(),()=>{var I,se;const O=(I=p[C])==null?void 0:I.callbacks;delete p[C],l=l.filter(V=>V.id!==C),(se=O==null?void 0:O.complete)==null||se.call(O),T.readyState===i.OPEN&&g.type==="subscription"&&(l.push({id:C,method:"subscription.stop"}),S())}}return{close:()=>{L="closed",m==null||m(),A(),v(T),clearTimeout(w),w=null},request:y,getConnection(){return T}}}class u extends Error{constructor(r){super(r),this.name="TRPCWebSocketClosedError",Object.setPrototypeOf(this,u.prototype)}}function n(e){return r=>{const{client:i}=e;return({op:c})=>s.observable(f=>{const{type:m,path:l,id:p,context:b}=c,E=r.transformer.serialize(c.input),w=i.request({type:m,path:l,input:E,id:p,context:b},{error(T){f.error(T),w()},complete(){f.complete()},next(T){const L=d.transformResult(T,r);if(!L.ok){f.error(a.TRPCClientError.from(L.error));return}f.next({result:L.result}),c.type!=="subscription"&&(w(),f.complete())}});return()=>{w()}})}}return re.createWSClient=o,re.wsLink=n,re}var Ie;function st(){if(Ie)return q;Ie=1,Object.defineProperty(q,"__esModule",{value:!0});var s=G(),d=Xe(),a=ee(),t=le(),o=ye(),u=rt(),n=nt(),e=ot(),r=it();X();class i{$request({type:g,input:R,path:h,context:x={}}){return d.createChain({links:this.links,op:{id:++this.requestId,type:g,path:h,input:R,context:x}}).pipe(s.share())}requestAsPromise(g){const R=this.$request(g),{promise:h,abort:x}=s.observableToPromise(R);return new Promise((C,_)=>{var O;(O=g.signal)==null||O.addEventListener("abort",x),h.then(I=>{C(I.result.data)}).catch(I=>{_(a.TRPCClientError.from(I))})})}query(g,R,h){return this.requestAsPromise({type:"query",path:g,input:R,context:h==null?void 0:h.context,signal:h==null?void 0:h.signal})}mutation(g,R,h){return this.requestAsPromise({type:"mutation",path:g,input:R,context:h==null?void 0:h.context,signal:h==null?void 0:h.signal})}subscription(g,R,h){return this.$request({type:"subscription",path:g,input:R,context:h==null?void 0:h.context}).subscribe({next(k){var C,_,O;k.result.type==="started"?(C=h.onStarted)==null||C.call(h):k.result.type==="stopped"?(_=h.onStopped)==null||_.call(h):(O=h.onData)==null||O.call(h,k.result.data)},error(k){var C;(C=h.onError)==null||C.call(h,k)},complete(){var k;(k=h.onComplete)==null||k.call(h)}})}constructor(g){this.requestId=0;const R=(()=>{const h=g.transformer;return h?"input"in h?g.transformer:{input:h,output:h}:{input:{serialize:x=>x,deserialize:x=>x},output:{serialize:x=>x,deserialize:x=>x}}})();this.runtime={transformer:{serialize:h=>R.input.serialize(h),deserialize:h=>R.output.deserialize(h)},combinedTransformer:R},this.links=g.links.map(h=>h(this.runtime))}}function c(y){return new i(y)}function f(y){return new i(y)}const m={query:"query",mutate:"mutation",subscribe:"subscription"},l=y=>m[y];function p(y){return t.createFlatProxy(g=>y.hasOwnProperty(g)?y[g]:g==="__untypedClient"?y:t.createRecursiveProxy(({path:R,args:h})=>{const x=[g,...R],k=l(x.pop()),C=x.join(".");return y[k](C,...h)}))}function b(y){const g=new i(y);return p(g)}function E(y){return y.__untypedClient}function w(y){if(y)return y;if(typeof window<"u"&&window.TextDecoder)return new window.TextDecoder;if(typeof globalThis<"u"&&globalThis.TextDecoder)return new globalThis.TextDecoder;throw new Error("No TextDecoder implementation found")}async function T(y){const g=y.parse??JSON.parse,R=h=>{var _;if((_=y.signal)!=null&&_.aborted||!h||h==="}")return;const x=h.indexOf(":"),k=h.substring(2,x-1),C=h.substring(x+1);y.onSingle(Number(k),g(C))};await L(y.readableStream,R,y.textDecoder)}async function L(y,g,R){let h="";const x=k=>{const _=R.decode(k).split(`
`);if(_.length===1)h+=_[0];else if(_.length>1){g(h+_[0]);for(let O=1;O<_.length-1;O++)g(_[O]);h=_[_.length-1]}};"getReader"in y?await P(y,x):await S(y,x),g(h)}function S(y,g){return new Promise(R=>{y.on("data",g),y.on("end",R)})}async function P(y,g){const R=y.getReader();let h=await R.read();for(;!h.done;)g(h.value),h=await R.read()}const D=(y,g)=>{const R=y.AbortController?new y.AbortController:null,h=o.fetchHTTPResponse({...y,contentTypeHeader:"application/json",batchModeHeader:"stream",getUrl:o.getUrl,getBody:o.getBody},R),x=()=>R==null?void 0:R.abort(),k=h.then(async C=>{if(!C.body)throw new Error("Received response without body");const _={response:C};return T({readableStream:C.body,onSingle:g,parse:O=>({json:JSON.parse(O),meta:_}),signal:R==null?void 0:R.signal,textDecoder:y.textDecoder})});return{cancel:x,promise:k}},M=y=>{const g=w(y.opts.textDecoder);return(R,h)=>{const x=R.map(O=>O.path).join(","),k=R.map(O=>O.input),{cancel:C,promise:_}=D({...y,textDecoder:g,path:x,inputs:k,headers(){return y.opts.headers?typeof y.opts.headers=="function"?y.opts.headers({opList:R}):y.opts.headers:{}}},(O,I)=>{h(O,I)});return{promise:_.then(()=>[]),cancel:C}}},v=u.createHTTPBatchLink(M),A=y=>{if("input"in y){if(!(y.input instanceof FormData))throw new Error("Input is not FormData");return y.input}},j=y=>{if(y.type!=="mutation")throw new Error("We only handle mutations with formdata");return o.httpRequest({...y,getUrl(){return`${y.url}/${y.path}`},getBody:A})},U=n.httpLinkFactory({requester:j});return q.splitLink=d.splitLink,q.TRPCClientError=a.TRPCClientError,q.getFetch=o.getFetch,q.httpBatchLink=u.httpBatchLink,q.httpLink=n.httpLink,q.httpLinkFactory=n.httpLinkFactory,q.loggerLink=e.loggerLink,q.createWSClient=r.createWSClient,q.wsLink=r.wsLink,q.TRPCUntypedClient=i,q.clientCallTypeToProcedureType=l,q.createTRPCClient=f,q.createTRPCClientProxy=p,q.createTRPCProxyClient=b,q.createTRPCUntypedClient=c,q.experimental_formDataLink=U,q.getUntypedClient=E,q.unstable_httpBatchStreamLink=v,q}var F={},je;function at(){if(je)return F;je=1,Object.defineProperty(F,"__esModule",{value:!0}),F.isTRPCRequestWithId=F.isTRPCRequest=F.isTRPCResponse=F.isTRPCMessage=void 0;function s(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function d(e){return e==null}function a(e){return!!(s(e)&&"trpc"in e&&s(e.trpc))}F.isTRPCMessage=a;function t(e){return a(e)&&"id"in e.trpc&&!d(e.trpc.id)}function o(e){return t(e)&&("error"in e.trpc||"result"in e.trpc)}F.isTRPCResponse=o;function u(e){return t(e)&&"method"in e.trpc}F.isTRPCRequest=u;function n(e){return u(e)&&t(e)}return F.isTRPCRequestWithId=n,F}var Ue;function Re(){if(Ue)return K;Ue=1,Object.defineProperty(K,"__esModule",{value:!0}),K.createBaseLink=void 0;const s=st(),d=G(),a=at(),t=o=>u=>({op:n})=>(0,d.observable)(e=>{const r=[],{id:i,type:c,path:f}=n;try{const m=u.transformer.serialize(n.input),l=()=>{e.error(new s.TRPCClientError("Port disconnected prematurely"))};o.addCloseListener(l),r.push(()=>o.removeCloseListener(l));const p=b=>{if(!(0,a.isTRPCResponse)(b))return;const{trpc:E}=b;if(i===E.id){if("error"in E)return e.error(s.TRPCClientError.from(E));e.next({result:Object.assign(Object.assign({},E.result),(!E.result.type||E.result.type==="data")&&{type:"data",data:u.transformer.deserialize(E.result.data)})}),(c!=="subscription"||E.result.type==="stopped")&&e.complete()}};o.addMessageListener(p),r.push(()=>o.removeMessageListener(p)),o.postMessage({trpc:{id:i,jsonrpc:void 0,method:c,params:{path:f,input:m}}})}catch(m){e.error(new s.TRPCClientError(m instanceof Error?m.message:"Unknown error"))}return()=>{c==="subscription"&&o.postMessage({trpc:{id:i,jsonrpc:void 0,method:"subscription.stop"}}),r.forEach(m=>m())}});return K.createBaseLink=t,K}var Be;function ut(){if(Be)return $;Be=1,Object.defineProperty($,"__esModule",{value:!0}),$.chromeLink=void 0;const s=Re(),d=a=>(0,s.createBaseLink)({postMessage(t){a.port.postMessage(t)},addMessageListener(t){a.port.onMessage.addListener(t)},removeMessageListener(t){a.port.onMessage.removeListener(t)},addCloseListener(t){a.port.onDisconnect.addListener(t)},removeCloseListener(t){a.port.onDisconnect.removeListener(t)}});return $.chromeLink=d,$}var ne={},Fe;function ct(){if(Fe)return ne;Fe=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.windowLink=void 0;const s=Re(),d=a=>{var t;const o=new Map,u=a.window,n=(t=a.postWindow)!==null&&t!==void 0?t:u;return(0,s.createBaseLink)({postMessage(e){n.postMessage(e,{targetOrigin:a.postOrigin})},addMessageListener(e){const r=i=>{e(i.data)};o.set(e,r),u.addEventListener("message",r)},removeMessageListener(e){const r=o.get(e);r&&u.removeEventListener("message",r)},addCloseListener(e){u.addEventListener("beforeunload",e)},removeCloseListener(e){u.removeEventListener("beforeunload",e)}})};return ne.windowLink=d,ne}var oe={},ie={},$e;function lt(){return $e||($e=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.TRPC_BROWSER_LOADED_EVENT=void 0,ie.TRPC_BROWSER_LOADED_EVENT="TRPC_BROWSER::POPUP_LOADED"),ie}var He;function dt(){if(He)return oe;He=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.popupLink=void 0;const s=lt(),d=Re(),a=t=>{const o=new Map,u=new Set;let n=null;async function e(r){if(!n||n.closed){n=t.createPopup(),await Promise.race([new Promise(i=>{var c;try{(c=n==null?void 0:n.addEventListener)===null||c===void 0||c.call(n,"load",i)}catch{}}),new Promise(i=>{r.addEventListener("message",c=>{c.data===s.TRPC_BROWSER_LOADED_EVENT&&i()})}),new Promise(i=>{console.warn("Could not detect if popup loading succeeded after 15s timeout, continuing anyway"),setTimeout(i,15e3)})]);try{if(!n.addEventListener)throw new Error("popupWindow.addEventListener is not a function");n.addEventListener("beforeunload",()=>{n=null})}catch{const c=setInterval(()=>{n&&n.closed&&(n=null,u.forEach(f=>{f()}),clearInterval(c))},1e3)}}return n}return(0,d.createBaseLink)({async postMessage(r){return(await e(t.listenWindow)).postMessage(r,{targetOrigin:t.postOrigin})},addMessageListener(r){const i=c=>{r(c.data)};o.set(r,i),t.listenWindow.addEventListener("message",i)},removeMessageListener(r){const i=o.get(r);i&&t.listenWindow.removeEventListener("message",i)},addCloseListener(r){t.listenWindow.addEventListener("beforeunload",r),u.add(r)},removeCloseListener(r){t.listenWindow.removeEventListener("beforeunload",r),u.delete(r)}})};return oe.popupLink=a,oe}var ze;function ft(){return ze||(ze=1,function(s){var d=N.__createBinding||(Object.create?function(t,o,u,n){n===void 0&&(n=u);var e=Object.getOwnPropertyDescriptor(o,u);(!e||("get"in e?!o.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(t,n,e)}:function(t,o,u,n){n===void 0&&(n=u),t[n]=o[u]}),a=N.__exportStar||function(t,o){for(var u in t)u!=="default"&&!Object.prototype.hasOwnProperty.call(o,u)&&d(o,t,u)};Object.defineProperty(s,"__esModule",{value:!0}),a(ut(),s),a(ct(),s),a(dt(),s)}(N)),N}var We=ft();function pt(s){return s}function ht(s){return s.length===0?pt:s.length===1?s[0]:function(a){return s.reduce((t,o)=>o(t),a)}}function mt(s){const d={subscribe(a){let t=null,o=!1,u=!1,n=!1;function e(){if(t===null){n=!0;return}u||(u=!0,typeof t=="function"?t():t&&t.unsubscribe())}return t=s({next(r){var i;o||(i=a.next)==null||i.call(a,r)},error(r){var i;o||(o=!0,(i=a.error)==null||i.call(a,r),e())},complete(){var r;o||(o=!0,(r=a.complete)==null||r.call(a),e())}}),n&&e(),{unsubscribe:e}},pipe(...a){return ht(a)(d)}};return d}function bt(s){return d=>{let a=0,t=null;const o=[];function u(){t||(t=d.subscribe({next(e){var r;for(const i of o)(r=i.next)==null||r.call(i,e)},error(e){var r;for(const i of o)(r=i.error)==null||r.call(i,e)},complete(){var e;for(const r of o)(e=r.complete)==null||e.call(r)}}))}function n(){if(a===0&&t){const e=t;t=null,e.unsubscribe()}}return{subscribe(e){return a++,o.push(e),u(),{unsubscribe(){a--,n();const r=o.findIndex(i=>i===e);r>-1&&o.splice(r,1)}}}}}}class Te extends Error{constructor(d){super(d),this.name="ObservableAbortError",Object.setPrototypeOf(this,Te.prototype)}}function gt(s){let d;return{promise:new Promise((t,o)=>{let u=!1;function n(){u||(u=!0,o(new Te("This operation was aborted.")),e.unsubscribe())}const e=s.subscribe({next(r){u=!0,t(r),n()},error(r){u=!0,o(r),n()},complete(){u=!0,n()}});d=n}),abort:d}}function yt(s){return mt(d=>{function a(o=0,u=s.op){const n=s.links[o];if(!n)throw new Error("No more links to execute - did you forget to add an ending link?");return n({op:u,next(r){return a(o+1,r)}})}return a().subscribe(d)})}function Ye(s){const d=Object.create(null);for(const a in s){const t=s[a];d[t]=a}return d}const Ge={PARSE_ERROR:-32700,BAD_REQUEST:-32600,INTERNAL_SERVER_ERROR:-32603,NOT_IMPLEMENTED:-32603,UNAUTHORIZED:-32001,FORBIDDEN:-32003,NOT_FOUND:-32004,METHOD_NOT_SUPPORTED:-32005,TIMEOUT:-32008,CONFLICT:-32009,PRECONDITION_FAILED:-32012,PAYLOAD_TOO_LARGE:-32013,UNPROCESSABLE_CONTENT:-32022,TOO_MANY_REQUESTS:-32029,CLIENT_CLOSED_REQUEST:-32099};Ye(Ge),Ye(Ge);const Je=()=>{};function Qe(s,d){return new Proxy(Je,{get(t,o){if(!(typeof o!="string"||o==="then"))return Qe(s,[...d,o])},apply(t,o,u){const n=d[d.length-1]==="apply";return s({args:n?u.length>=2?u[1]:[]:u,path:n?d.slice(0,-1):d})}})}const Rt=s=>Qe(s,[]),Tt=s=>new Proxy(Je,{get(d,a){if(!(typeof a!="string"||a==="then"))return s(a)}});function Et(s){return!!s&&!Array.isArray(s)&&typeof s=="object"}class wt extends Error{}function Ct(s){if(s instanceof Error)return s;const d=typeof s;if(!(d==="undefined"||d==="function"||s===null)){if(d!=="object")return new Error(String(s));if(Et(s)){const a=new wt;for(const t in s)a[t]=s[t];return a}}}function Ve(s){return!!s&&!Array.isArray(s)&&typeof s=="object"}function Pt(s){return s instanceof Q||s instanceof Error&&s.name==="TRPCClientError"}function Lt(s){return Ve(s)&&Ve(s.error)&&typeof s.error.code=="number"&&typeof s.error.message=="string"}class Q extends Error{static from(d,a={}){const t=d;return Pt(t)?(a.meta&&(t.meta={...t.meta,...a.meta}),t):Lt(t)?new Q(t.error.message,{...a,result:t}):t instanceof Error?new Q(t.message,{...a,cause:Ct(t)}):new Q("Unknown error",{...a,cause:t})}constructor(d,a){var o,u;const t=a==null?void 0:a.cause;super(d,{cause:t}),this.meta=a==null?void 0:a.meta,this.cause=t,this.shape=(o=a==null?void 0:a.result)==null?void 0:o.error,this.data=(u=a==null?void 0:a.result)==null?void 0:u.error.data,this.name="TRPCClientError",Object.setPrototypeOf(this,Q.prototype)}}class vt{$request({type:d,input:a,path:t,context:o={}}){return yt({links:this.links,op:{id:++this.requestId,type:d,path:t,input:a,context:o}}).pipe(bt())}requestAsPromise(d){const a=this.$request(d),{promise:t,abort:o}=gt(a);return new Promise((n,e)=>{var r;(r=d.signal)==null||r.addEventListener("abort",o),t.then(i=>{n(i.result.data)}).catch(i=>{e(Q.from(i))})})}query(d,a,t){return this.requestAsPromise({type:"query",path:d,input:a,context:t==null?void 0:t.context,signal:t==null?void 0:t.signal})}mutation(d,a,t){return this.requestAsPromise({type:"mutation",path:d,input:a,context:t==null?void 0:t.context,signal:t==null?void 0:t.signal})}subscription(d,a,t){return this.$request({type:"subscription",path:d,input:a,context:t==null?void 0:t.context}).subscribe({next(u){var n,e,r;u.result.type==="started"?(n=t.onStarted)==null||n.call(t):u.result.type==="stopped"?(e=t.onStopped)==null||e.call(t):(r=t.onData)==null||r.call(t,u.result.data)},error(u){var n;(n=t.onError)==null||n.call(t,u)},complete(){var u;(u=t.onComplete)==null||u.call(t)}})}constructor(d){this.requestId=0;const a=(()=>{const t=d.transformer;return t?"input"in t?d.transformer:{input:t,output:t}:{input:{serialize:o=>o,deserialize:o=>o},output:{serialize:o=>o,deserialize:o=>o}}})();this.runtime={transformer:{serialize:t=>a.input.serialize(t),deserialize:t=>a.output.deserialize(t)},combinedTransformer:a},this.links=d.links.map(t=>t(this.runtime))}}const kt={query:"query",mutate:"mutation",subscribe:"subscription"},xt=s=>kt[s];function Ot(s){return Tt(d=>s.hasOwnProperty(d)?s[d]:d==="__untypedClient"?s:Rt(({path:a,args:t})=>{const o=[d,...a],u=xt(o.pop()),n=o.join(".");return s[u](n,...t)}))}function Ke(s){const d=new vt(s);return Ot(d)}const _t=Y(()=>{function s(e){if(!e)return"";if(e.includes("Finish loading on"))return"Loading complete";if(e.includes("Fetching param cache")){const r=e.match(/(\d+)MB fetched/),i=e.match(/cache\[(\d+)\/(\d+)\]/),c=e.match(/(\d+)% complete/);return[`Fetching model parameters (${i?i[1]:"?"}/${i?i[2]:"?"})`,r?`${r[1]}MB downloaded`:"",c?`${c[1]}% complete`:""].filter(Boolean).join(" • ")}if(e.includes("Loading model from cache")||e.includes("Load ndarray cache")){const r=e.match(/cache\[(\d+)\/(\d+)\]/),i=e.match(/(\d+)MB loaded/);return[`Loading from cache (${r?r[1]:"?"}/${r?r[2]:"?"})`,i?`${i[1]}MB loaded`:""].filter(Boolean).join(" • ")}if(e.match(/Load [a-zA-Z0-9_.-]+/)){const r=e.match(/Load ([a-zA-Z0-9_.-]+)/),i=e.match(/(\d+)%/);return`Loading ${r?r[1]:"component"}${i?` (${i[1]}%)`:""}`}if(e.includes("Loading shaders")||e.includes("Loading GPU shader")){const r=e.match(/\[(\d+)\/(\d+)\]/);return`Loading GPU shaders (${r?r[1]:"?"}/${r?r[2]:"?"})`}return e.includes("Initialize WebGPU pipeline")?"Initializing WebGPU pipeline":e.includes("Load tokenizer")?"Loading tokenizer":e.includes("Load config")?"Loading configuration":e}class d extends HTMLElement{constructor(){super();B(this,"downloadProgress",0);B(this,"downloadStatusText","");B(this,"timeElapsed",0);B(this,"isCompleted",!1);B(this,"trpcClient",null);B(this,"subscription",null);B(this,"progressBarInner",null);B(this,"statusTextElement",null);B(this,"timeElapsedElement",null);B(this,"containerElement",null);B(this,"removalTimeout",null);this.attachShadow({mode:"open"}),this.shadowRoot&&(this.shadowRoot.appendChild(d.template.content.cloneNode(!0)),this.progressBarInner=this.shadowRoot.querySelector(".progress-bar-inner"),this.statusTextElement=this.shadowRoot.querySelector(".status-text"),this.timeElapsedElement=this.shadowRoot.querySelector(".time-elapsed"),this.containerElement=this.shadowRoot.querySelector(".download-tracker")),this.initClient(),this.startListening()}static get template(){const i=document.createElement("template");return i.innerHTML=`
      <style>
        :host {
          display: none; /* Hide by default */
          font-family: var(--dt-font-family, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif);
          margin: var(--dt-margin, 10px 0);

          /* Define all customizable properties with defaults */
          --dt-border-color: #e0e0e0;
          --dt-background-color: #f9f9f9;
          --dt-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
          --dt-border-radius: 8px;
          --dt-padding: 12px;

          --dt-progress-height: 8px;
          --dt-progress-background: #eaeaea;
          --dt-progress-border-radius: 4px;
          --dt-progress-margin: 8px 0;

          --dt-progress-fill-color: #4a6cf7;
          --dt-progress-completed-color: #10b981;
          --dt-progress-transition: width 0.3s ease;

          --dt-text-color: #333;
          --dt-subtext-color: #666;
          --dt-text-size: 14px;
          --dt-subtext-size: 12px;
          --dt-subtext-margin-top: 4px;
        }

        :host(.active) {
          display: block; /* Show when active */
        }

        .download-tracker {
          border: 1px solid var(--dt-border-color);
          border-radius: var(--dt-border-radius);
          padding: var(--dt-padding);
          background-color: var(--dt-background-color);
          box-shadow: var(--dt-box-shadow);
        }

        .progress-bar {
          height: var(--dt-progress-height);
          background-color: var(--dt-progress-background);
          border-radius: var(--dt-progress-border-radius);
          overflow: hidden;
          margin: var(--dt-progress-margin);
        }

        .progress-bar-inner {
          height: 100%;
          background-color: var(--dt-progress-fill-color);
          width: 0%;
          transition: var(--dt-progress-transition);
        }

        .status-text {
          font-size: var(--dt-text-size);
          color: var(--dt-text-color);
        }

        .time-elapsed {
          font-size: var(--dt-subtext-size);
          color: var(--dt-subtext-color);
          margin-top: var(--dt-subtext-margin-top);
        }

        .completed .progress-bar-inner {
          background-color: var(--dt-progress-completed-color);
        }
      </style>

      <div class="download-tracker" part="container">
        <div class="progress-bar" part="progress-container">
          <div class="progress-bar-inner" part="progress-bar"></div>
        </div>
        <div class="status-text" part="status-text"></div>
        <div class="time-elapsed" part="time-elapsed"></div>
      </div>
    `,i}connectedCallback(){var i,c,f;this.containerElement&&(this.containerElement.setAttribute("role","progressbar"),this.containerElement.setAttribute("aria-live","polite"),this.containerElement.setAttribute("aria-label","Download progress"),(i=this.progressBarInner)==null||i.setAttribute("aria-valuenow","0"),(c=this.progressBarInner)==null||c.setAttribute("aria-valuemin","0"),(f=this.progressBarInner)==null||f.setAttribute("aria-valuemax","100")),this.startListening()}disconnectedCallback(){this.stopListening(),this.removalTimeout!==null&&(window.clearTimeout(this.removalTimeout),this.removalTimeout=null)}initClient(){try{this.trpcClient=Ke({links:[We.windowLink({window})]})}catch(i){console.error("[DownloadTracker] Failed to initialize TRPC client:",i)}}startListening(){if(!this.trpcClient){console.error("[DownloadTracker] Cannot start listening: TRPC client not initialized");return}try{this.subscription=this.trpcClient.languageModel.downloadProgress.subscribe(void 0,{onData:i=>{console.log({data:i}),this.updateProgress(i)},onError:i=>{console.error("[DownloadTracker] Subscription error:",i),this.statusTextElement.textContent="Error tracking download",this.scheduleRemoval()}})}catch(i){console.error("[DownloadTracker] Failed to subscribe to download progress:",i)}}stopListening(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}scheduleRemoval(i=100){this.removalTimeout!==null&&window.clearTimeout(this.removalTimeout),this.removalTimeout=window.setTimeout(()=>{this.remove()},i)}updateProgress(i){if(!this.progressBarInner||!this.statusTextElement||!this.timeElapsedElement||!this.containerElement)return;this.classList.contains("active")||this.classList.add("active"),this.downloadProgress=i.progress,this.downloadStatusText=i.text,this.timeElapsed=i.timeElapsed;const c=Math.min(Math.max(this.downloadProgress*100,0),100);this.progressBarInner.style.width=`${c}%`,this.progressBarInner.setAttribute("aria-valuenow",c.toString());const f=s(this.downloadStatusText);this.statusTextElement.textContent=`${f} ${c.toFixed(0)}%`,this.timeElapsed>0&&(this.timeElapsedElement.textContent=`Time elapsed: ${this.timeElapsed.toFixed(1)}s`),(c>=100||this.downloadStatusText.includes("Finish loading"))&&(this.isCompleted=!0,this.containerElement.classList.add("completed"),this.statusTextElement.textContent="Download complete",this.containerElement.setAttribute("aria-label","Download completed"),this.dispatchEvent(new CustomEvent("downloadcomplete",{bubbles:!0,composed:!0,detail:{timeElapsed:this.timeElapsed}})),this.scheduleRemoval(0))}reset(){!this.progressBarInner||!this.statusTextElement||!this.timeElapsedElement||!this.containerElement||(this.downloadProgress=0,this.downloadStatusText="",this.timeElapsed=0,this.isCompleted=!1,this.progressBarInner.style.width="0%",this.statusTextElement.textContent="",this.timeElapsedElement.textContent="",this.containerElement.classList.remove("completed"),this.classList.remove("active"),this.removalTimeout!==null&&(window.clearTimeout(this.removalTimeout),this.removalTimeout=null))}setTheme(i="light"){switch(i){case"dark":this.style.setProperty("--dt-background-color","#222"),this.style.setProperty("--dt-border-color","#444"),this.style.setProperty("--dt-text-color","#eee"),this.style.setProperty("--dt-subtext-color","#bbb"),this.style.setProperty("--dt-progress-background","#333"),this.style.setProperty("--dt-progress-fill-color","#6c8dff"),this.style.setProperty("--dt-progress-completed-color","#2dd4a5");break;case"colorful":this.style.setProperty("--dt-background-color","#f5f0ff"),this.style.setProperty("--dt-border-color","#d0c5f0"),this.style.setProperty("--dt-progress-fill-color","#8a4fff"),this.style.setProperty("--dt-progress-completed-color","#00c68a");break;default:this.style.cssText="";break}}}let a=null,t=null;function o(){if(!a)try{a=Ke({links:[We.windowLink({window})]})}catch(e){console.error("[DownloadTrackerInjector] Failed to initialize global TRPC client:",e)}}function u(){if(!(!a||t))try{t=a.languageModel.downloadProgress.subscribe(void 0,{onData:e=>{console.log("[DownloadTrackerInjector] Download detected:",e)},onError:e=>{console.error("[DownloadTrackerInjector] Global subscription error:",e),n()}})}catch(e){console.error("[DownloadTrackerInjector] Failed to start global subscription:",e)}}function n(){t&&(t.unsubscribe(),t=null)}try{console.log("[DownloadTrackerInjector] Registering custom element..."),customElements.get("download-tracker")||(customElements.define("download-tracker",d),console.log("[DownloadTracker] Custom element registered"),o(),u())}catch(e){console.error("[DownloadTrackerInjector] Failed to register custom element:",e)}});function Mt(){}function he(s,...d){}const St={debug:(...s)=>he(console.debug,...s),log:(...s)=>he(console.log,...s),warn:(...s)=>he(console.warn,...s),error:(...s)=>he(console.error,...s)};return(async()=>{try{return await _t.main()}catch(s){throw St.error('The unlisted script "injectDownloadTracker" crashed on startup!',s),s}})()}();
injectdownloadtracker;
