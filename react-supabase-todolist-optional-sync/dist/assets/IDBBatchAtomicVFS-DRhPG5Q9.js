var bt=Object.defineProperty;var at=y=>{throw TypeError(y)};var kt=(y,n,t)=>n in y?bt(y,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):y[n]=t;var x=(y,n,t)=>kt(y,typeof n!="symbol"?n+"":n,t),V=(y,n,t)=>n.has(y)||at("Cannot "+t);var i=(y,n,t)=>(V(y,n,"read from private field"),t?t.call(y):n.get(y)),S=(y,n,t)=>n.has(y)?at("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(y):n.set(y,t),C=(y,n,t,e)=>(V(y,n,"write to private field"),e?e.call(y,t):n.set(y,t),t),w=(y,n,t)=>(V(y,n,"access private method"),t);var P,U,tt,ht,z,m,W,mt,L,F,R,I,D,$,pt;import{S as G,a as f,b as K,c as N,d as nt,e as ot,f as jt,h as _,i as xt,j as vt,k as St,l as O,m as Y,n as J,o as Q,p as Et,q as It,r as Pt,s as Tt,t as Ct,u as Ot,v as A,w as Ft,x as Lt,y as Rt,z as Dt,A as _t,B as At,C as Ut,D as zt,E as Mt,F as it,G as Bt,H as qt}from"./index-Dyy0b0Hg.js";const Ht=512;class Wt{constructor(n,t){x(this,"name");x(this,"mxPathname",64);x(this,"_module");this.name=n,this._module=t}close(){}isReady(){return!0}hasAsyncMethod(n){return!1}xOpen(n,t,e,s,a){return G}xDelete(n,t,e){return f}xAccess(n,t,e,s){return f}xFullPathname(n,t,e,s){return f}xGetLastError(n,t,e){return f}xClose(n){return f}xRead(n,t,e,s,a){return f}xWrite(n,t,e,s,a){return f}xTruncate(n,t,e){return f}xSync(n,t){return f}xFileSize(n,t){return f}xLock(n,t){return f}xUnlock(n,t){return f}xCheckReservedLock(n,t){return f}xFileControl(n,t,e){return K}xSectorSize(n){return Ht}xDeviceCharacteristics(n){return 0}}const $t=Object.getPrototypeOf(async function(){}).constructor;class Vt extends Wt{constructor(t,e){super(t,e);S(this,P)}hasAsyncMethod(t){const e=`j${t.slice(1)}`;return this[e]instanceof $t}getFilename(t){throw new Error("unimplemented")}jOpen(t,e,s,a){return G}jDelete(t,e){return f}jAccess(t,e,s){return f}jFullPathname(t,e){const{read:s,written:a}=new TextEncoder().encodeInto(t,e);return s<t.length?N:a>=e.length?N:(e[a]=0,f)}jGetLastError(t){return f}jClose(t){return f}jRead(t,e,s){return e.fill(0),nt}jWrite(t,e,s){return ot}jTruncate(t,e){return f}jSync(t,e){return f}jFileSize(t,e){return f}jLock(t,e){return f}jUnlock(t,e){return f}jCheckReservedLock(t,e){return e.setInt32(0,0,!0),f}jFileControl(t,e,s){return K}jSectorSize(t){return super.xSectorSize(t)}jDeviceCharacteristics(t){return 0}xOpen(t,e,s,a,o){var g;const l=w(this,P,ht).call(this,e,a),c=w(this,P,U).call(this,"Int32",o);return(g=this.log)==null||g.call(this,"jOpen",l,s,"0x"+a.toString(16)),this.jOpen(l,s,a,c)}xDelete(t,e,s){var o;const a=this._module.UTF8ToString(e);return(o=this.log)==null||o.call(this,"jDelete",a,s),this.jDelete(a,s)}xAccess(t,e,s,a){var c;const o=this._module.UTF8ToString(e),l=w(this,P,U).call(this,"Int32",a);return(c=this.log)==null||c.call(this,"jAccess",o,s),this.jAccess(o,s,l)}xFullPathname(t,e,s,a){var c;const o=this._module.UTF8ToString(e),l=this._module.HEAPU8.subarray(a,a+s);return(c=this.log)==null||c.call(this,"jFullPathname",o,s),this.jFullPathname(o,l)}xGetLastError(t,e,s){var o;const a=this._module.HEAPU8.subarray(s,s+e);return(o=this.log)==null||o.call(this,"jGetLastError",e),this.jGetLastError(a)}xClose(t){var e;return(e=this.log)==null||e.call(this,"jClose",t),this.jClose(t)}xRead(t,e,s,a,o){var g;const l=w(this,P,tt).call(this,e,s),c=X(a,o);return(g=this.log)==null||g.call(this,"jRead",t,s,c),this.jRead(t,l,c)}xWrite(t,e,s,a,o){var g;const l=w(this,P,tt).call(this,e,s),c=X(a,o);return(g=this.log)==null||g.call(this,"jWrite",t,l,c),this.jWrite(t,l,c)}xTruncate(t,e,s){var o;const a=X(e,s);return(o=this.log)==null||o.call(this,"jTruncate",t,a),this.jTruncate(t,a)}xSync(t,e){var s;return(s=this.log)==null||s.call(this,"jSync",t,e),this.jSync(t,e)}xFileSize(t,e){var a;const s=w(this,P,U).call(this,"BigInt64",e);return(a=this.log)==null||a.call(this,"jFileSize",t),this.jFileSize(t,s)}xLock(t,e){var s;return(s=this.log)==null||s.call(this,"jLock",t,e),this.jLock(t,e)}xUnlock(t,e){var s;return(s=this.log)==null||s.call(this,"jUnlock",t,e),this.jUnlock(t,e)}xCheckReservedLock(t,e){var a;const s=w(this,P,U).call(this,"Int32",e);return(a=this.log)==null||a.call(this,"jCheckReservedLock",t),this.jCheckReservedLock(t,s)}xFileControl(t,e,s){var o;const a=new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+s);return(o=this.log)==null||o.call(this,"jFileControl",t,e,a),this.jFileControl(t,e,a)}xSectorSize(t){var e;return(e=this.log)==null||e.call(this,"jSectorSize",t),this.jSectorSize(t)}xDeviceCharacteristics(t){var e;return(e=this.log)==null||e.call(this,"jDeviceCharacteristics",t),this.jDeviceCharacteristics(t)}}P=new WeakSet,U=function(t,e){const s=t==="Int32"?4:8,a=`get${t}`,o=`set${t}`,l=()=>new DataView(this._module.HEAPU8.buffer,this._module.HEAPU8.byteOffset+e,s);let c=l();return new Proxy(c,{get(g,h){if(c.buffer.byteLength===0&&(c=l()),h===a)return function(p,r){if(!r)throw new Error("must be little endian");return c[h](p,r)};if(h===o)return function(p,r,u){if(!u)throw new Error("must be little endian");return c[h](p,r,u)};if(typeof h=="string"&&h.match(/^(get)|(set)/))throw new Error("invalid type");const k=c[h];return typeof k=="function"?k.bind(c):k}})},tt=function(t,e){let s=this._module.HEAPU8.subarray(t,t+e);return new Proxy(s,{get:(a,o,l)=>{s.buffer.byteLength===0&&(s=this._module.HEAPU8.subarray(t,t+e));const c=s[o];return typeof c=="function"?c.bind(s):c}})},ht=function(t,e){if(e&jt){let s=t,a=1;const o=[];for(;a;){const l=this._module.HEAPU8[s++];if(l)o.push(l);else switch(this._module.HEAPU8[s]||(a=null),a){case 1:o.push(63),a=2;break;case 2:o.push(61),a=3;break;case 3:o.push(38),a=2;break}}return new TextDecoder().decode(new Uint8Array(o))}return t?this._module.UTF8ToString(t):null};function X(y,n){return n*4294967296+y+(y<0?2**32:0)}const B={mode:"shared"},Gt={ifAvailable:!0,mode:"shared"},ct={ifAvailable:!0,mode:"exclusive"},Kt=["exclusive","shared","shared+hint"],q=y=>{var n,t,e,ut,dt,ft,yt,gt,wt,E,k;return k=class extends y{constructor(r,u,d){super(r,u,d);S(this,e);S(this,n,{lockPolicy:"exclusive",lockTimeout:1/0});S(this,t,new Map);if(Object.assign(i(this,n),d),Kt.indexOf(i(this,n).lockPolicy)===-1)throw new Error(`WebLocksMixin: invalid lock mode: ${d.lockPolicy}`)}async jLock(r,u){try{if(!i(this,t).has(r)){const b={baseName:this.getFilename(r),type:_,writeHint:!1};i(this,t).set(r,b)}const d=i(this,t).get(r);if(u<=d.type)return f;switch(i(this,n).lockPolicy){case"exclusive":return await w(this,e,ut).call(this,d,u);case"shared":case"shared+hint":return await w(this,e,yt).call(this,d,u)}}catch(d){return console.error("WebLocksMixin: lock error",d),xt}}async jUnlock(r,u){try{const d=i(this,t).get(r);if(u>=d.type)return f;switch(i(this,n).lockPolicy){case"exclusive":return await w(this,e,dt).call(this,d,u);case"shared":case"shared+hint":return await w(this,e,gt).call(this,d,u)}}catch(d){return console.error("WebLocksMixin: unlock error",d),vt}}async jCheckReservedLock(r,u){try{const d=i(this,t).get(r);switch(i(this,n).lockPolicy){case"exclusive":return w(this,e,ft).call(this,d,u);case"shared":case"shared+hint":return await w(this,e,wt).call(this,d,u)}}catch(d){return console.error("WebLocksMixin: check reserved lock error",d),St}return u.setInt32(0,0,!0),f}jFileControl(r,u,d){const b=i(this,t).get(r)??(this.jLock(r,_),i(this,t).get(r));return u===q.WRITE_HINT_OP_CODE&&i(this,n).lockPolicy==="shared+hint"&&(b.writeHint=!0),K}},n=new WeakMap,t=new WeakMap,e=new WeakSet,ut=async function(r,u){if(!r.access){if(!await w(this,e,E).call(this,r,"access"))return O;console.assert(!!r.access)}return r.type=u,f},dt=function(r,u){var d;return u===_&&((d=r.access)==null||d.call(r),console.assert(!r.access)),r.type=u,f},ft=function(r,u){return u.setInt32(0,0,!0),f},yt=async function(r,u){var d,b;switch(r.type){case _:switch(u){case Q:if(r.writeHint&&!await w(this,e,E).call(this,r,"hint"))return O;if(!await w(this,e,E).call(this,r,"gate",B))return(d=r.hint)==null||d.call(r),O;await w(this,e,E).call(this,r,"access",B),r.gate(),console.assert(!r.gate),console.assert(!!r.access),console.assert(!r.reserved);break;default:throw new Error("unsupported lock transition")}break;case Q:switch(u){case Y:if(i(this,n).lockPolicy==="shared+hint"&&!r.hint&&!await w(this,e,E).call(this,r,"hint",ct))return O;if(!await w(this,e,E).call(this,r,"reserved",ct))return(b=r.hint)==null||b.call(r),O;r.access(),console.assert(!r.gate),console.assert(!r.access),console.assert(!!r.reserved);break;case J:if(!await w(this,e,E).call(this,r,"gate"))return O;if(r.access(),!await w(this,e,E).call(this,r,"access"))return r.gate(),O;console.assert(!!r.gate),console.assert(!!r.access),console.assert(!r.reserved);break;default:throw new Error("unsupported lock transition")}break;case Y:switch(u){case J:if(!await w(this,e,E).call(this,r,"gate"))return O;if(!await w(this,e,E).call(this,r,"access"))return r.gate(),O;console.assert(!!r.gate),console.assert(!!r.access),console.assert(!!r.reserved);break;default:throw new Error("unsupported lock transition")}break}return r.type=u,f},gt=async function(r,u){var d,b,T,j,v,M,rt;if(u===_)(d=r.access)==null||d.call(r),(b=r.gate)==null||b.call(r),(T=r.reserved)==null||T.call(r),(j=r.hint)==null||j.call(r),r.writeHint=!1,console.assert(!r.access),console.assert(!r.gate),console.assert(!r.reserved),console.assert(!r.hint);else switch(r.type){case J:r.access(),await w(this,e,E).call(this,r,"access",B),r.gate(),(v=r.reserved)==null||v.call(r),(M=r.hint)==null||M.call(r),console.assert(!!r.access),console.assert(!r.gate),console.assert(!r.reserved);break;case Y:await w(this,e,E).call(this,r,"access",B),r.reserved(),(rt=r.hint)==null||rt.call(r),console.assert(!!r.access),console.assert(!r.gate),console.assert(!r.reserved);break}return r.type=u,f},wt=async function(r,u){return await w(this,e,E).call(this,r,"reserved",Gt)?(r.reserved(),u.setInt32(0,0,!0)):u.setInt32(0,1,!0),f},E=function(r,u,d={}){return console.assert(!r[u]),new Promise(b=>{if(!d.ifAvailable&&i(this,n).lockTimeout<1/0){const j=new AbortController;d=Object.assign({},d,{signal:j.signal}),setTimeout(()=>{j.abort(),b==null||b(!1)},i(this,n).lockTimeout)}const T=`lock##${r.baseName}##${u}`;navigator.locks.request(T,d,j=>{if(j)return new Promise(v=>{r[u]=()=>{v(),r[u]=null},b(!0),b=null});r[u]=null,b(!1),b=null}).catch(j=>{if(j.name!=="AbortError")throw j})})},k};q.WRITE_HINT_OP_CODE=-9999;class Nt{constructor(n,t,e){x(this,"path");x(this,"flags");x(this,"metadata");x(this,"fileSize",0);x(this,"needsMetadataSync",!1);x(this,"rollback",null);x(this,"changedPages",new Set);x(this,"synchronous","full");x(this,"txOptions",{durability:"strict"});this.path=n,this.flags=t,this.metadata=e}}const et=class et extends q(Vt){constructor(t,e,s={}){super(t,e,s);S(this,W);x(this,"mapIdToFile",new Map);x(this,"lastError",null);x(this,"log",null);S(this,z);S(this,m);C(this,z,w(this,W,mt).call(this,s.idbName??t))}static async create(t,e,s){const a=new et(t,e,s);return await a.isReady(),a}close(){i(this,m).close()}async isReady(){await super.isReady(),await i(this,z)}getFilename(t){const e=this.mapIdToFile.get(t).path;return`IDB(${this.name}):${e}`}async jOpen(t,e,s,a){try{const o=new URL(t||Math.random().toString(36).slice(2),"file://").pathname;let l=await i(this,m).q(({metadata:g})=>g.get(o));if(!l&&s&Et&&(l={name:o,fileSize:0,version:0},await i(this,m).q(({metadata:g})=>g.put(l),"rw")),!l)throw new Error(`File ${o} not found`);const c=new Nt(o,s,l);return this.mapIdToFile.set(e,c),a.setInt32(0,s,!0),f}catch(o){return this.lastError=o,G}}async jDelete(t,e){try{const s=new URL(t,"file://").pathname;return i(this,m).q(({metadata:a,blocks:o})=>{const l=IDBKeyRange.bound([s,-1/0],[s,1/0]);o.delete(l),a.delete(s)},"rw"),e&&await i(this,m).sync(!1),f}catch(s){return this.lastError=s,It}}async jAccess(t,e,s){try{const a=new URL(t,"file://").pathname,o=await i(this,m).q(({metadata:l})=>l.get(a));return s.setInt32(0,o?1:0,!0),f}catch(a){return this.lastError=a,Pt}}async jClose(t){try{const e=this.mapIdToFile.get(t);return this.mapIdToFile.delete(t),e.flags&Tt&&await i(this,m).q(({metadata:s,blocks:a})=>{s.delete(e.path),a.delete(IDBKeyRange.bound([e.path,0],[e.path,1/0]))},"rw"),e.needsMetadataSync&&i(this,m).q(({metadata:s})=>s.put(e.metadata),"rw"),await i(this,m).sync(e.synchronous==="full"),f}catch(e){return this.lastError=e,Ct}}async jRead(t,e,s){try{const a=this.mapIdToFile.get(t);let o=0;for(;o<e.byteLength;){const l=s+o,c=await i(this,m).q(({blocks:p})=>{const r=IDBKeyRange.bound([a.path,-l],[a.path,1/0]);return p.get(r)});if(!c||c.data.byteLength-c.offset<=l)return e.fill(0,o),nt;const g=e.subarray(o),h=l+c.offset,k=Math.min(Math.max(c.data.byteLength-h,0),g.byteLength);g.set(c.data.subarray(h,h+k)),o+=k}return f}catch(a){return this.lastError=a,Ot}}jWrite(t,e,s){try{const a=this.mapIdToFile.get(t);if(a.flags&A&&!a.rollback){const c=Object.assign({pendingVersion:a.metadata.version-1},a.metadata);i(this,m).q(({metadata:g})=>g.put(c),"rw",a.txOptions),a.rollback=Object.assign({},a.metadata),a.metadata.version--}a.flags&A&&a.changedPages.add(s);const o=e.slice(),l=a.metadata.version;if(!(s<a.metadata.fileSize)||a.flags&A||a.flags&Ft){const c={path:a.path,offset:-s,version:l,data:e.slice()};i(this,m).q(({blocks:g})=>{g.put(c),a.changedPages.add(s)},"rw",a.txOptions)}else i(this,m).q(async({blocks:c})=>{const g=IDBKeyRange.bound([a.path,-s],[a.path,1/0]),h=await c.get(g);h.data.subarray(s+h.offset).set(o),c.put(h)},"rw",a.txOptions);return a.metadata.fileSize<s+e.length&&(a.metadata.fileSize=s+e.length,a.needsMetadataSync=!0),f}catch(a){return this.lastError=a,ot}}jTruncate(t,e){try{const s=this.mapIdToFile.get(t);return e<s.metadata.fileSize&&(i(this,m).q(({blocks:a})=>{const o=IDBKeyRange.bound([s.path,-1/0],[s.path,-e,1/0]);a.delete(o)},"rw",s.txOptions),s.metadata.fileSize=e,s.needsMetadataSync=!0),f}catch(s){return this.lastError=s,Lt}}async jSync(t,e){try{const s=this.mapIdToFile.get(t);return s.needsMetadataSync&&(i(this,m).q(({metadata:a})=>a.put(s.metadata),"rw",s.txOptions),s.needsMetadataSync=!1),s.flags&A?s.synchronous==="full"&&await i(this,m).sync(!0):await i(this,m).sync(s.synchronous==="full"),f}catch(s){return this.lastError=s,Rt}}jFileSize(t,e){try{const s=this.mapIdToFile.get(t);return e.setBigInt64(0,BigInt(s.metadata.fileSize),!0),f}catch(s){return this.lastError=s,Dt}}async jLock(t,e){const s=this.mapIdToFile.get(t),a=await super.jLock(t,e);return e===Q&&(s.metadata=await i(this,m).q(async({metadata:o,blocks:l})=>{const c=await o.get(s.path);return c.pendingVersion&&(console.warn(`removing failed transaction ${c.pendingVersion}`),await new Promise((g,h)=>{const k=IDBKeyRange.bound([c.name,-1/0],[c.name,1/0]),p=l.openCursor(k);p.onsuccess=()=>{const r=p.result;r?(r.value.version<c.version&&r.delete(),r.continue()):g()},p.onerror=()=>h(p.error)}),delete c.pendingVersion,o.put(c)),c},"rw",s.txOptions)),a}async jUnlock(t,e){if(e===_){const s=this.mapIdToFile.get(t);await i(this,m).sync(s.synchronous==="full")}return super.jUnlock(t,e)}jFileControl(t,e,s){var a,o,l,c,g;try{const h=this.mapIdToFile.get(t);switch(e){case Mt:const k=lt(s,4),p=lt(s,8);(a=this.log)==null||a.call(this,"xFileControl",h.path,"PRAGMA",k,p);const r=T=>{const j=new TextEncoder().encode(T),v=this._module._sqlite3_malloc(j.byteLength);return this._module.HEAPU8.subarray(v,v+j.byteLength).set(j),s.setUint32(0,v,!0),it};switch(k.toLowerCase()){case"page_size":if(h.flags&A&&p&&h.metadata.fileSize)return it;break;case"synchronous":if(p)switch(p.toLowerCase()){case"0":case"off":h.synchronous="off",h.txOptions={durability:"relaxed"};break;case"1":case"normal":h.synchronous="normal",h.txOptions={durability:"relaxed"};break;case"2":case"3":case"full":case"extra":h.synchronous="full",h.txOptions={durability:"strict"};break}break;case"write_hint":return super.jFileControl(t,q.WRITE_HINT_OP_CODE,null)}break;case zt:(o=this.log)==null||o.call(this,"xFileControl",h.path,"SYNC");const u=Object.assign({},h.metadata),d=h.rollback.fileSize;i(this,m).q(({metadata:T,blocks:j})=>{T.put(u);for(const v of h.changedPages)if(v<d){const M=IDBKeyRange.bound([h.path,-v,u.version],[h.path,-v,1/0],!0);j.delete(M)}h.changedPages.clear()},"rw",h.txOptions),h.needsMetadataSync=!1,h.rollback=null;break;case Ut:return(l=this.log)==null||l.call(this,"xFileControl",h.path,"BEGIN_ATOMIC_WRITE"),f;case At:return(c=this.log)==null||c.call(this,"xFileControl",h.path,"COMMIT_ATOMIC_WRITE"),f;case _t:(g=this.log)==null||g.call(this,"xFileControl",h.path,"ROLLBACK_ATOMIC_WRITE"),h.metadata=h.rollback;const b=Object.assign({},h.metadata);return i(this,m).q(({metadata:T,blocks:j})=>{T.put(b);for(const v of h.changedPages)j.delete([h.path,-v,b.version-1]);h.changedPages.clear()},"rw",h.txOptions),h.needsMetadataSync=!1,h.rollback=null,f}}catch(h){return this.lastError=h,N}return super.jFileControl(t,e,s)}jDeviceCharacteristics(t){return 0|Bt|qt}jGetLastError(t){if(this.lastError){console.error(this.lastError);const e=t.subarray(0,t.byteLength-1),{written:s}=new TextEncoder().encodeInto(this.lastError.message,e);t[s]=0}return f}};z=new WeakMap,m=new WeakMap,W=new WeakSet,mt=async function(t){C(this,m,await H.create(t))};let Z=et;function lt(y,n){const t=y.getUint32(n,!0);if(t){const e=new Uint8Array(y.buffer,t);return new TextDecoder().decode(e.subarray(0,e.indexOf(0)))}return null}const st=class st{constructor(n){S(this,$);S(this,L);S(this,F,null);S(this,R,Promise.resolve());S(this,I,null);S(this,D,new WeakSet);x(this,"log",null);C(this,L,n)}static async create(n){const t=await new Promise((e,s)=>{const a=indexedDB.open(n,6);a.onupgradeneeded=async o=>{const l=a.result;switch(o.oldVersion&&console.log(`Upgrading IndexedDB from version ${o.oldVersion}`),o.oldVersion){case 0:l.createObjectStore("blocks",{keyPath:["path","offset","version"]}).createIndex("version",["path","version"]);case 5:const c=a.transaction;c.objectStore("blocks").deleteIndex("version");const g=l.createObjectStore("metadata",{keyPath:"name"});await new Promise((h,k)=>{let p={};const r=c.objectStore("blocks").openCursor();r.onsuccess=()=>{const u=r.result;if(u){const d=u.value;typeof d.offset!="number"||d.path===p.path&&d.offset===p.offset?u.delete():d.offset===0&&(g.put({name:d.path,fileSize:d.fileSize,version:d.version}),delete d.fileSize,u.update(d)),p=d,u.continue()}else h()},r.onerror=()=>k(r.error)});break}},a.onsuccess=()=>e(a.result),a.onerror=()=>s(a.error)});return new st(t)}close(){i(this,L).close()}q(n,t="ro",e={}){const s=t==="ro"?"readonly":"readwrite",a=Object.assign({durability:"default"},e);return C(this,F,(i(this,F)||Promise.resolve()).then(()=>w(this,$,pt).call(this,n,s,a))),i(this,F)}proxyStoreOrIndex(n){return new Proxy(n,{get:(t,e,s)=>{const a=Reflect.get(t,e,s);return typeof a=="function"?(...o)=>{const l=Reflect.apply(a,t,o);return l instanceof IDBRequest&&!e.endsWith("Cursor")?(C(this,I,l),l.addEventListener("error",()=>{console.error(l.error),l.transaction.abort()},{once:!0}),Yt(l)):l}:a}})}async sync(n){i(this,F)&&(await i(this,F),n&&await i(this,R),this.reset())}reset(){C(this,F,null),C(this,R,Promise.resolve()),C(this,I,null)}};L=new WeakMap,F=new WeakMap,R=new WeakMap,I=new WeakMap,D=new WeakMap,$=new WeakSet,pt=async function(n,t,e){var a,o;let s;i(this,I)&&i(this,D).has(i(this,I).transaction)&&i(this,I).transaction.mode>=t&&i(this,I).transaction.durability===e.durability&&(s=i(this,I).transaction,i(this,I).readyState==="pending"&&await new Promise(l=>{i(this,I).addEventListener("success",l,{once:!0}),i(this,I).addEventListener("error",l,{once:!0})}));for(let l=0;l<2;++l){s||(await i(this,R),s=i(this,L).transaction(i(this,L).objectStoreNames,t,e),(a=this.log)==null||a.call(this,"IDBTransaction open",t),i(this,D).add(s),C(this,R,new Promise((g,h)=>{s.addEventListener("complete",()=>{var k;(k=this.log)==null||k.call(this,"IDBTransaction complete"),i(this,D).delete(s),g()}),s.addEventListener("abort",()=>{i(this,D).delete(s),h(new Error("transaction aborted"))})})));const c=[...s.objectStoreNames].map(g=>[g,this.proxyStoreOrIndex(s.objectStore(g))]);try{return await n(Object.fromEntries(c))}catch(g){if(!l&&g.name==="TransactionInactiveError"){(o=this.log)==null||o.call(this,"TransactionInactiveError, retrying"),s=null;continue}throw g}}};let H=st;function Yt(y){return new Promise((n,t)=>{y.onsuccess=()=>n(y.result),y.onerror=()=>t(y.error)})}export{Z as IDBBatchAtomicVFS,H as IDBContext};
