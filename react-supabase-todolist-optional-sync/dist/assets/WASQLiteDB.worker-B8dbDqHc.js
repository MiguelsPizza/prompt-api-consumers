let ct,st,rt,et,An,tt,nt,Nn,Rn,xn,qn,Fn,Gn,jn,Yn,Dn,zn,kn,Qn,Zn,Mn,Jn,Kn,Pn,Cn,Vn,vn,Wn,$n,Xn,Hn,Bn,Un,ot;let __tla=(async()=>{Rn=0;An=1;Qn=5;qn=10;xn=12;Nn=14;Cn=3338;kn=3594;vn=4106;Pn=2570;Un=1802;Bn=1034;Dn=3850;Wn=266;Fn=522;Hn=1546;zn=2058;Gn=778;Kn=4;Vn=8;jn=64;$n=256;Xn=512;Yn=0;Jn=1;Zn=2;Mn=4;nt=2048;tt=16384;et=14;rt=21;st=31;ct=32;ot=33;typeof BigInt.prototype.toJSON>"u"&&(BigInt.prototype.toJSON=function(){return this.toString()});const V=0x7fffffffffffffffn,j=-0x8000000000000000n,z=Object.getPrototypeOf(async function(){}).constructor;class C extends Error{constructor(n,i){super(n),this.code=i}}const k=!0;function sn(t){const n={};t.retryOps=[];const i=t._getSqliteFree(),m=t._malloc(8),u=[m,m+4];function h(s){if(typeof s!="string")return 0;const r=new TextEncoder().encode(s),e=t._sqlite3_malloc(r.byteLength+1);return t.HEAPU8.set(r,e),t.HEAPU8[e+r.byteLength]=0,e}function b(s,r){return BigInt(r)<<32n|BigInt(s)&4294967295n}const y=function(){const s=BigInt(Number.MAX_SAFE_INTEGER)>>32n,r=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(e,c){return c>s||c<r?b(e,c):c*0x100000000+(e&0x7fffffff)-(e&0x80000000)}}(),L=new Set;function p(s){if(!L.has(s))throw new C("not a database",21)}const l=new Map;function f(s){if(!l.has(s))throw new C("not a statement",21)}n.bind_collection=function(s,r){f(s);const e=Array.isArray(r),c=n.bind_parameter_count(s);for(let o=1;o<=c;++o){const a=e?o-1:n.bind_parameter_name(s,o),_=r[a];_!==void 0&&n.bind(s,o,_)}return 0},n.bind=function(s,r,e){switch(f(s),typeof e){case"number":return e===(e|0)?n.bind_int(s,r,e):n.bind_double(s,r,e);case"string":return n.bind_text(s,r,e);default:return e instanceof Uint8Array||Array.isArray(e)?n.bind_blob(s,r,e):e===null?n.bind_null(s,r):typeof e=="bigint"?n.bind_int64(s,r,e):e===void 0?27:(console.warn("unknown binding converted to null",e),n.bind_null(s,r))}},n.bind_blob=function(){const s="sqlite3_bind_blob",r=t.cwrap(s,...E("nnnnn:n"));return function(e,c,o){f(e);const a=o.byteLength??o.length,_=t._sqlite3_malloc(a);t.HEAPU8.subarray(_).set(o);const T=r(e,c,_,a,i);return w(s,T,l.get(e))}}(),n.bind_parameter_count=function(){const r=t.cwrap("sqlite3_bind_parameter_count",...E("n:n"));return function(e){return f(e),r(e)}}(),n.bind_double=function(){const s="sqlite3_bind_double",r=t.cwrap(s,...E("nnn:n"));return function(e,c,o){f(e);const a=r(e,c,o);return w(s,a,l.get(e))}}(),n.bind_int=function(){const s="sqlite3_bind_int",r=t.cwrap(s,...E("nnn:n"));return function(e,c,o){if(f(e),o>0x7fffffff||o<-0x80000000)return 25;const a=r(e,c,o);return w(s,a,l.get(e))}}(),n.bind_int64=function(){const s="sqlite3_bind_int64",r=t.cwrap(s,...E("nnnn:n"));return function(e,c,o){if(f(e),o>V||o<j)return 25;const a=o&4294967295n,_=o>>32n,T=r(e,c,Number(a),Number(_));return w(s,T,l.get(e))}}(),n.bind_null=function(){const s="sqlite3_bind_null",r=t.cwrap(s,...E("nn:n"));return function(e,c){f(e);const o=r(e,c);return w(s,o,l.get(e))}}(),n.bind_parameter_name=function(){const r=t.cwrap("sqlite3_bind_parameter_name",...E("n:s"));return function(e,c){return f(e),r(e,c)}}(),n.bind_text=function(){const s="sqlite3_bind_text",r=t.cwrap(s,...E("nnnnn:n"));return function(e,c,o){f(e);const a=h(o),_=r(e,c,a,-1,i);return w(s,_,l.get(e))}}(),n.changes=function(){const r=t.cwrap("sqlite3_changes",...E("n:n"));return function(e){return p(e),r(e)}}(),n.clear_bindings=function(){const s="sqlite3_clear_bindings",r=t.cwrap(s,...E("n:n"));return function(e){f(e);const c=r(e);return w(s,c,l.get(e))}}(),n.last_insert_id=function(){const r=t.cwrap("sqlite3_last_insert_rowid",...E("n:n"));return function(e){return p(e),r(e)}}(),n.close=function(){const s="sqlite3_close",r=t.cwrap(s,...E("n:n"),{async:k});return async function(e){p(e);const c=await r(e);return L.delete(e),w(s,c,e)}}(),n.column=function(s,r){f(s);const e=n.column_type(s,r);switch(e){case 4:return n.column_blob(s,r);case 2:return n.column_double(s,r);case 1:const c=n.column_int(s,r),o=t.getTempRet0();return y(c,o);case 5:return null;case 3:return n.column_text(s,r);default:throw new C("unknown type",e)}},n.column_blob=function(){const r=t.cwrap("sqlite3_column_blob",...E("nn:n"));return function(e,c){f(e);const o=n.column_bytes(e,c),a=r(e,c);return t.HEAPU8.subarray(a,a+o)}}(),n.column_bytes=function(){const r=t.cwrap("sqlite3_column_bytes",...E("nn:n"));return function(e,c){return f(e),r(e,c)}}(),n.column_count=function(){const r=t.cwrap("sqlite3_column_count",...E("n:n"));return function(e){return f(e),r(e)}}(),n.column_double=function(){const r=t.cwrap("sqlite3_column_double",...E("nn:n"));return function(e,c){return f(e),r(e,c)}}(),n.column_int=function(){const r=t.cwrap("sqlite3_column_int64",...E("nn:n"));return function(e,c){return f(e),r(e,c)}}(),n.column_int64=function(){const r=t.cwrap("sqlite3_column_int64",...E("nn:n"));return function(e,c){f(e);const o=r(e,c),a=t.getTempRet0();return b(o,a)}}(),n.column_name=function(){const r=t.cwrap("sqlite3_column_name",...E("nn:s"));return function(e,c){return f(e),r(e,c)}}(),n.column_names=function(s){const r=[],e=n.column_count(s);for(let c=0;c<e;++c)r.push(n.column_name(s,c));return r},n.column_text=function(){const r=t.cwrap("sqlite3_column_text",...E("nn:s"));return function(e,c){return f(e),r(e,c)}}(),n.column_type=function(){const r=t.cwrap("sqlite3_column_type",...E("nn:n"));return function(e,c){return f(e),r(e,c)}}(),n.create_function=function(s,r,e,c,o,a,_,T){p(s);function d(g){return g instanceof z?async(I,O,R)=>g(I,t.HEAP32.subarray(R/4,R/4+O)):(I,O,R)=>g(I,t.HEAP32.subarray(R/4,R/4+O))}const S=t.create_function(s,r,e,c,o,a&&d(a),_&&d(_),T);return w("sqlite3_create_function",S,s)},n.data_count=function(){const r=t.cwrap("sqlite3_data_count",...E("n:n"));return function(e){return f(e),r(e)}}(),n.exec=async function(s,r,e){for await(const c of n.statements(s,r)){let o;for(;await n.step(c)===100;)if(e){o=o??n.column_names(c);const a=n.row(c);await e(a,o)}}return 0},n.finalize=function(){const r=t.cwrap("sqlite3_finalize",...E("n:n"),{async:k});return async function(e){const c=await r(e);return l.delete(e),c}}(),n.get_autocommit=function(){const r=t.cwrap("sqlite3_get_autocommit",...E("n:n"));return function(e){return r(e)}}(),n.libversion=function(){const r=t.cwrap("sqlite3_libversion",...E(":s"));return function(){return r()}}(),n.libversion_number=function(){const r=t.cwrap("sqlite3_libversion_number",...E(":n"));return function(){return r()}}(),n.limit=function(){const r=t.cwrap("sqlite3_limit",...E("nnn:n"));return function(e,c,o){return r(e,c,o)}}(),n.open_v2=function(){const s="sqlite3_open_v2",r=t.cwrap(s,...E("snnn:n"),{async:k});return async function(e,c,o){c=c||6,o=h(o);try{const a=await A(()=>r(e,u[0],c,o)),_=t.getValue(u[0],"*");return L.add(_),t.ccall("RegisterExtensionFunctions","number",["number"],[_]),w(s,a),_}finally{t._sqlite3_free(o)}}}(),n.progress_handler=function(s,r,e,c){p(s),t.progress_handler(s,r,e,c)},n.reset=function(){const s="sqlite3_reset",r=t.cwrap(s,...E("n:n"),{async:k});return async function(e){f(e);const c=await r(e);return w(s,c,l.get(e))}}(),n.result=function(s,r){switch(typeof r){case"number":r===(r|0)?n.result_int(s,r):n.result_double(s,r);break;case"string":n.result_text(s,r);break;default:if(r instanceof Uint8Array||Array.isArray(r))n.result_blob(s,r);else if(r===null)n.result_null(s);else{if(typeof r=="bigint")return n.result_int64(s,r);console.warn("unknown result converted to null",r),n.result_null(s)}break}},n.result_blob=function(){const r=t.cwrap("sqlite3_result_blob",...E("nnnn:n"));return function(e,c){const o=c.byteLength??c.length,a=t._sqlite3_malloc(o);t.HEAPU8.subarray(a).set(c),r(e,a,o,i)}}(),n.result_double=function(){const r=t.cwrap("sqlite3_result_double",...E("nn:n"));return function(e,c){r(e,c)}}(),n.result_int=function(){const r=t.cwrap("sqlite3_result_int",...E("nn:n"));return function(e,c){r(e,c)}}(),n.result_int64=function(){const r=t.cwrap("sqlite3_result_int64",...E("nnn:n"));return function(e,c){if(c>V||c<j)return 25;const o=c&4294967295n,a=c>>32n;r(e,Number(o),Number(a))}}(),n.result_null=function(){const r=t.cwrap("sqlite3_result_null",...E("n:n"));return function(e){r(e)}}(),n.result_text=function(){const r=t.cwrap("sqlite3_result_text",...E("nnnn:n"));return function(e,c){const o=h(c);r(e,o,-1,i)}}(),n.row=function(s){const r=[],e=n.data_count(s);for(let c=0;c<e;++c){const o=n.column(s,c);r.push(o?.buffer===t.HEAPU8.buffer?o.slice():o)}return r},n.set_authorizer=function(s,r,e){p(s);function c(_,T,d,S,g,I){return[_,T,t.UTF8ToString(d),t.UTF8ToString(S),t.UTF8ToString(g),t.UTF8ToString(I)]}function o(_){return _ instanceof z?async(T,d,S,g,I,O)=>_(...c(T,d,S,g,I,O)):(T,d,S,g,I,O)=>_(...c(T,d,S,g,I,O))}const a=t.set_authorizer(s,o(r),e);return w("sqlite3_set_authorizer",a,s)},n.sql=function(){const r=t.cwrap("sqlite3_sql",...E("n:s"));return function(e){return f(e),r(e)}}(),n.statements=function(s,r,e={}){const c=t.cwrap("sqlite3_prepare_v3","number",["number","number","number","number","number","number"],{async:!0});return async function*(){const o=[];try{let O=function(){I&&!e.unscoped&&n.finalize(I),I=0};const a=new TextEncoder().encode(r),_=a.byteLength-a.byteLength%4+12,T=t._sqlite3_malloc(_),d=T+a.byteLength+1;o.push(()=>t._sqlite3_free(T)),t.HEAPU8.set(a,T),t.HEAPU8[d-1]=0;const S=T+_-8,g=T+_-4;let I;o.push(O),t.setValue(g,T,"*");do{O();const R=t.getValue(g,"*"),Q=await A(()=>c(s,R,d-g,e.flags||0,S,g));Q!==0&&w("sqlite3_prepare_v3",Q,s),I=t.getValue(S,"*"),I&&(l.set(I,s),yield I)}while(I)}finally{for(;o.length;)o.pop()()}}()},n.step=function(){const s="sqlite3_step",r=t.cwrap(s,...E("n:n"),{async:k});return async function(e){f(e);const c=await A(()=>r(e));return w(s,c,l.get(e),[100,101])}}(),n.commit_hook=function(s,r){p(s),t.commit_hook(s,r)},n.update_hook=function(s,r){p(s);function e(o,a,_,T,d){return[o,t.UTF8ToString(a),t.UTF8ToString(_),b(T,d)]}function c(o){return o instanceof z?async(a,_,T,d,S)=>o(...e(a,_,T,d,S)):(a,_,T,d,S)=>o(...e(a,_,T,d,S))}t.update_hook(s,c(r))},n.value=function(s){const r=n.value_type(s);switch(r){case 4:return n.value_blob(s);case 2:return n.value_double(s);case 1:const e=n.value_int(s),c=t.getTempRet0();return y(e,c);case 5:return null;case 3:return n.value_text(s);default:throw new C("unknown type",r)}},n.value_blob=function(){const r=t.cwrap("sqlite3_value_blob",...E("n:n"));return function(e){const c=n.value_bytes(e),o=r(e);return t.HEAPU8.subarray(o,o+c)}}(),n.value_bytes=function(){const r=t.cwrap("sqlite3_value_bytes",...E("n:n"));return function(e){return r(e)}}(),n.value_double=function(){const r=t.cwrap("sqlite3_value_double",...E("n:n"));return function(e){return r(e)}}(),n.value_int=function(){const r=t.cwrap("sqlite3_value_int64",...E("n:n"));return function(e){return r(e)}}(),n.value_int64=function(){const r=t.cwrap("sqlite3_value_int64",...E("n:n"));return function(e){const c=r(e),o=t.getTempRet0();return b(c,o)}}(),n.value_text=function(){const r=t.cwrap("sqlite3_value_text",...E("n:s"));return function(e){return r(e)}}(),n.value_type=function(){const r=t.cwrap("sqlite3_value_type",...E("n:n"));return function(e){return r(e)}}(),n.vfs_register=function(s,r){const e=t.vfs_register(s,r);return w("sqlite3_vfs_register",e)};function w(s,r,e=null,c=[0]){if(c.includes(r))return r;const o=e?t.ccall("sqlite3_errmsg","string",["number"],[e]):s;throw new C(o,r)}async function A(s){let r;do t.retryOps.length&&(await Promise.all(t.retryOps),t.retryOps=[]),r=await s();while(r&&t.retryOps.length);return r}return n}function E(t){const n=[],i=t.match(/([ns@]*):([nsv@])/);switch(i[2]){case"n":n.push("number");break;case"s":n.push("string");break;case"v":n.push(null);break}const m=[];for(let u of i[1])switch(u){case"n":m.push("number");break;case"s":m.push("string");break}return n.push(m),n}const Y=Symbol("Comlink.proxy"),cn=Symbol("Comlink.endpoint"),on=Symbol("Comlink.releaseProxy"),G=Symbol("Comlink.finalizer"),B=Symbol("Comlink.thrown"),J=t=>typeof t=="object"&&t!==null||typeof t=="function",an={canHandle:t=>J(t)&&t[Y],serialize(t){const{port1:n,port2:i}=new MessageChannel;return D(t,n),[i,[i]]},deserialize(t){return t.start(),_n(t)}},un={canHandle:t=>J(t)&&B in t,serialize({value:t}){let n;return t instanceof Error?n={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:n={isError:!1,value:t},[n,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Z=new Map([["proxy",an],["throw",un]]);function fn(t,n){for(const i of t)if(n===i||i==="*"||i instanceof RegExp&&i.test(n))return!0;return!1}function D(t,n=globalThis,i=["*"]){n.addEventListener("message",function m(u){if(!u||!u.data)return;if(!fn(i,u.origin)){console.warn(`Invalid origin '${u.origin}' for comlink proxy`);return}const{id:h,type:b,path:y}=Object.assign({path:[]},u.data),L=(u.data.argumentList||[]).map(x);let p;try{const l=y.slice(0,-1).reduce((w,A)=>w[A],t),f=y.reduce((w,A)=>w[A],t);switch(b){case"GET":p=f;break;case"SET":l[y.slice(-1)[0]]=x(u.data.value),p=!0;break;case"APPLY":p=f.apply(l,L);break;case"CONSTRUCT":{const w=new f(...L);p=q(w)}break;case"ENDPOINT":{const{port1:w,port2:A}=new MessageChannel;D(t,A),p=mn(w,[w])}break;case"RELEASE":p=void 0;break;default:return}}catch(l){p={value:l,[B]:0}}Promise.resolve(p).catch(l=>({value:l,[B]:0})).then(l=>{const[f,w]=H(l);n.postMessage(Object.assign(Object.assign({},f),{id:h}),w),b==="RELEASE"&&(n.removeEventListener("message",m),M(n),G in t&&typeof t[G]=="function"&&t[G]())}).catch(l=>{const[f,w]=H({value:new TypeError("Unserializable return value"),[B]:0});n.postMessage(Object.assign(Object.assign({},f),{id:h}),w)})}),n.start&&n.start()}function ln(t){return t.constructor.name==="MessagePort"}function M(t){ln(t)&&t.close()}function _n(t,n){const i=new Map;return t.addEventListener("message",function(u){const{data:h}=u;if(!h||!h.id)return;const b=i.get(h.id);if(b)try{b(h)}finally{i.delete(h.id)}}),K(t,i,[],n)}function U(t){if(t)throw new Error("Proxy has been released and is not useable")}function nn(t){return N(t,new Map,{type:"RELEASE"}).then(()=>{M(t)})}const W=new WeakMap,F="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const n=(W.get(t)||0)-1;W.set(t,n),n===0&&nn(t)});function En(t,n){const i=(W.get(n)||0)+1;W.set(n,i),F&&F.register(t,n,t)}function hn(t){F&&F.unregister(t)}function K(t,n,i=[],m=function(){}){let u=!1;const h=new Proxy(m,{get(b,y){if(U(u),y===on)return()=>{hn(h),nn(t),n.clear(),u=!0};if(y==="then"){if(i.length===0)return{then:()=>h};const L=N(t,n,{type:"GET",path:i.map(p=>p.toString())}).then(x);return L.then.bind(L)}return K(t,n,[...i,y])},set(b,y,L){U(u);const[p,l]=H(L);return N(t,n,{type:"SET",path:[...i,y].map(f=>f.toString()),value:p},l).then(x)},apply(b,y,L){U(u);const p=i[i.length-1];if(p===cn)return N(t,n,{type:"ENDPOINT"}).then(x);if(p==="bind")return K(t,n,i.slice(0,-1));const[l,f]=$(L);return N(t,n,{type:"APPLY",path:i.map(w=>w.toString()),argumentList:l},f).then(x)},construct(b,y){U(u);const[L,p]=$(y);return N(t,n,{type:"CONSTRUCT",path:i.map(l=>l.toString()),argumentList:L},p).then(x)}});return En(h,t),h}function pn(t){return Array.prototype.concat.apply([],t)}function $(t){const n=t.map(H);return[n.map(i=>i[0]),pn(n.map(i=>i[1]))]}const tn=new WeakMap;function mn(t,n){return tn.set(t,n),t}function q(t){return Object.assign(t,{[Y]:!0})}function H(t){for(const[n,i]of Z)if(i.canHandle(t)){const[m,u]=i.serialize(t);return[{type:"HANDLER",name:n,value:m},u]}return[{type:"RAW",value:t},tn.get(t)||[]]}function x(t){switch(t.type){case"HANDLER":return Z.get(t.name).deserialize(t.value);case"RAW":return t.value}}function N(t,n,i,m){return new Promise(u=>{const h=wn();n.set(h,u),t.start&&t.start(),t.postMessage(Object.assign({id:h},i),m)})}function wn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const Tn=new Error("request for lock canceled");var yn=function(t,n,i,m){function u(h){return h instanceof i?h:new i(function(b){b(h)})}return new(i||(i=Promise))(function(h,b){function y(l){try{p(m.next(l))}catch(f){b(f)}}function L(l){try{p(m.throw(l))}catch(f){b(f)}}function p(l){l.done?h(l.value):u(l.value).then(y,L)}p((m=m.apply(t,n||[])).next())})};class bn{constructor(n,i=Tn){this._value=n,this._cancelError=i,this._weightedQueues=[],this._weightedWaiters=[]}acquire(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise((i,m)=>{this._weightedQueues[n-1]||(this._weightedQueues[n-1]=[]),this._weightedQueues[n-1].push({resolve:i,reject:m}),this._dispatch()})}runExclusive(n,i=1){return yn(this,void 0,void 0,function*(){const[m,u]=yield this.acquire(i);try{return yield n(m)}finally{u()}})}waitForUnlock(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise(i=>{this._weightedWaiters[n-1]||(this._weightedWaiters[n-1]=[]),this._weightedWaiters[n-1].push(i),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(n){this._value=n,this._dispatch()}release(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);this._value+=n,this._dispatch()}cancel(){this._weightedQueues.forEach(n=>n.forEach(i=>i.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var n;for(let i=this._value;i>0;i--){const m=(n=this._weightedQueues[i-1])===null||n===void 0?void 0:n.shift();if(!m)continue;const u=this._value,h=i;this._value-=i,i=this._value+1,m.resolve([u,this._newReleaser(h)])}this._drainUnlockWaiters()}_newReleaser(n){let i=!1;return()=>{i||(i=!0,this.release(n))}}_drainUnlockWaiters(){for(let n=this._value;n>0;n--)this._weightedWaiters[n-1]&&(this._weightedWaiters[n-1].forEach(i=>i()),this._weightedWaiters[n-1]=[])}}var gn=function(t,n,i,m){function u(h){return h instanceof i?h:new i(function(b){b(h)})}return new(i||(i=Promise))(function(h,b){function y(l){try{p(m.next(l))}catch(f){b(f)}}function L(l){try{p(m.throw(l))}catch(f){b(f)}}function p(l){l.done?h(l.value):u(l.value).then(y,L)}p((m=m.apply(t,n||[])).next())})};class In{constructor(n){this._semaphore=new bn(1,n)}acquire(){return gn(this,void 0,void 0,function*(){const[,n]=yield this._semaphore.acquire();return n})}runExclusive(n){return this._semaphore.runExclusive(()=>n())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}let X=1;async function en(t,n={useWebWorker:!0}){const{default:i}=await import("./wa-sqlite-async-DbmgiIC9.js"),m=await i(),u=sn(m),{IDBBatchAtomicVFS:h}=await import("./IDBBatchAtomicVFS-DBAaJ-a6.js"),b=new h(t);u.vfs_register(b,!0);const y=await u.open_v2(t),L=new In,p=new Map;let l=new Set,f=null;function w(){f=null;const o={tables:[...l],groupedUpdates:{},rawUpdates:[]};l.clear(),Array.from(p.values()).forEach(a=>a(o))}u.register_table_onchange_hook(y,(o,a,_)=>{l.add(a),f==null&&(f=setTimeout(w,0))});const A=async(o,a)=>s(async()=>r(o,a)),s=o=>L.runExclusive(o),r=async(o,a)=>{const _=[];for await(const S of u.statements(y,o)){let g;const I=a?[a]:[[]];for(const O of I){O.forEach((Q,P,rn)=>{typeof Q=="boolean"&&(rn[P]=Q?1:0)}),u.reset(S),a&&u.bind_collection(S,O);const R=[];for(;await u.step(S)===100;){const Q=u.row(S);R.push(Q)}g=g??u.column_names(S),g.length&&_.push({columns:g,rows:R})}if(a)break}const T=[];for(const S of _)for(const g of S.rows){const I={};S.columns.forEach((O,R)=>{I[O]=g[R]}),T.push(I)}return{insertId:u.last_insert_id(y),rowsAffected:u.changes(y),rows:{_array:T,length:T.length}}},e=async(o,a)=>s(async()=>{let _=0;const T=u.str_new(y,o),d=u.str_value(T);try{await r("BEGIN TRANSACTION");const g=await u.prepare_v2(y,d);if(g===null)return{rowsAffected:0,rows:{_array:[],length:0}};const I=a||[];for(const O of I){for(let Q=0;Q<O.length;Q++){const P=O[Q];typeof P=="boolean"&&(O[Q]=P?1:0)}u.reset(g.stmt),a&&u.bind_collection(g.stmt,O),await u.step(g.stmt)===101&&(_+=u.changes(y))}await u.finalize(g.stmt),await r("COMMIT")}catch{return await r("ROLLBACK"),{rowsAffected:0,rows:{_array:[],length:0}}}finally{u.str_finish(T)}return{rowsAffected:_,rows:{_array:[],length:0}}});if(n.useWebWorker){const o=a=>{const _=X++;return p.set(_,a),q(()=>{p.delete(_)})};return{execute:q(A),executeBatch:q(e),registerOnTableChange:q(o),close:q(()=>{u.close(y)})}}return{execute:A,executeBatch:e,registerOnTableChange:o=>{const a=X++;return p.set(a,o),()=>{p.delete(a)}},close:()=>u.close(y)}}const v=new Map,Sn="open-wasqlite-db";let Ln=1;const dn=async t=>navigator.locks.request(Sn,async()=>{const n=Ln++;if(!v.has(t)){const h=new Set,b=await en(t);v.set(t,{clientIds:h,db:b})}const i=v.get(t);i.clientIds.add(n);const{db:m}=i,u={...m,close:q(()=>{const{clientIds:h}=i;if(h.delete(n),h.size==0)return console.debug(`Closing connection to ${t}.`),v.delete(t),m.close?.();console.debug(`Connection to ${t} not closed yet due to active clients.`)})};return q(u)}),On=async t=>{const n=await en(t);return q(n)};if(typeof SharedWorkerGlobalScope<"u"){const t=self;t.onconnect=function(n){const i=n.ports[0];console.debug("Exposing shared db on port",i),D(dn,i)},addEventListener("unload",()=>{Array.from(v.values()).forEach(async n=>{(await n.db).close?.()})})}else D(On)})();export{ct as A,st as B,rt as C,et as D,An as E,tt as F,nt as G,Nn as S,Rn as a,xn as b,qn as c,Fn as d,Gn as e,jn as f,Yn as g,Dn as h,zn as i,kn as j,Qn as k,Zn as l,Mn as m,Jn as n,Kn as o,Pn as p,Cn as q,Vn as r,vn as s,Wn as t,$n as u,Xn as v,Hn as w,Bn as x,Un as y,ot as z,__tla};