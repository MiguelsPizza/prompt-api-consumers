{"version":3,"file":"WASQLiteDB.worker-C4k9EJko.js","sources":["../../node_modules/.pnpm/@journeyapps+wa-sqlite@0.4.2/node_modules/@journeyapps/wa-sqlite/src/sqlite-constants.js","../../node_modules/.pnpm/@journeyapps+wa-sqlite@0.4.2/node_modules/@journeyapps/wa-sqlite/src/sqlite-api.js","../../node_modules/.pnpm/comlink@4.4.2/node_modules/comlink/dist/esm/comlink.mjs","../../node_modules/.pnpm/async-mutex@0.4.1/node_modules/async-mutex/index.mjs","../../node_modules/.pnpm/@powersync+web@1.10.0_@journeyapps+wa-sqlite@0.4.2_@powersync+common@1.21.0/node_modules/@powersync/web/lib/src/shared/open-db.js","../../node_modules/.pnpm/@powersync+web@1.10.0_@journeyapps+wa-sqlite@0.4.2_@powersync+common@1.21.0/node_modules/@powersync/web/lib/src/worker/db/WASQLiteDB.worker.js"],"sourcesContent":["// Primary result codes.\n// https://www.sqlite.org/rescode.html\nexport const SQLITE_OK = 0;\nexport const SQLITE_ERROR = 1;\nexport const SQLITE_INTERNAL = 2;\nexport const SQLITE_PERM = 3;\nexport const SQLITE_ABORT = 4;\nexport const SQLITE_BUSY = 5;\nexport const SQLITE_LOCKED = 6;\nexport const SQLITE_NOMEM = 7;\nexport const SQLITE_READONLY = 8;\nexport const SQLITE_INTERRUPT = 9;\nexport const SQLITE_IOERR = 10;\nexport const SQLITE_CORRUPT = 11;\nexport const SQLITE_NOTFOUND = 12;\nexport const SQLITE_FULL = 13;\nexport const SQLITE_CANTOPEN = 14;\nexport const SQLITE_PROTOCOL = 15;\nexport const SQLITE_EMPTY = 16;\nexport const SQLITE_SCHEMA = 17;\nexport const SQLITE_TOOBIG = 18;\nexport const SQLITE_CONSTRAINT = 19;\nexport const SQLITE_MISMATCH = 20;\nexport const SQLITE_MISUSE = 21;\nexport const SQLITE_NOLFS = 22;\nexport const SQLITE_AUTH = 23;\nexport const SQLITE_FORMAT = 24;\nexport const SQLITE_RANGE = 25;\nexport const SQLITE_NOTADB = 26;\nexport const SQLITE_NOTICE = 27;\nexport const SQLITE_WARNING = 28;\nexport const SQLITE_ROW = 100;\nexport const SQLITE_DONE = 101;\n\n// Extended error codes.\nexport const SQLITE_IOERR_ACCESS = 3338;\nexport const SQLITE_IOERR_CHECKRESERVEDLOCK = 3594;\nexport const SQLITE_IOERR_CLOSE = 4106;\nexport const SQLITE_IOERR_DATA = 8202;\nexport const SQLITE_IOERR_DELETE = 2570;\nexport const SQLITE_IOERR_DELETE_NOENT = 5898;\nexport const SQLITE_IOERR_DIR_FSYNC = 1290;\nexport const SQLITE_IOERR_FSTAT = 1802;\nexport const SQLITE_IOERR_FSYNC = 1034;\nexport const SQLITE_IOERR_GETTEMPPATH = 6410;\nexport const SQLITE_IOERR_LOCK = 3850;\nexport const SQLITE_IOERR_NOMEM = 3082;\nexport const SQLITE_IOERR_READ = 266;\nexport const SQLITE_IOERR_RDLOCK = 2314;\nexport const SQLITE_IOERR_SEEK = 5642;\nexport const SQLITE_IOERR_SHORT_READ = 522;\nexport const SQLITE_IOERR_TRUNCATE = 1546;\nexport const SQLITE_IOERR_UNLOCK = 2058;\nexport const SQLITE_IOERR_VNODE = 6922;\nexport const SQLITE_IOERR_WRITE = 778;\nexport const SQLITE_IOERR_BEGIN_ATOMIC = 7434;\nexport const SQLITE_IOERR_COMMIT_ATOMIC = 7690;\nexport const SQLITE_IOERR_ROLLBACK_ATOMIC = 7946;\n\n// Other extended result codes.\nexport const SQLITE_CONSTRAINT_CHECK = 275;\nexport const SQLITE_CONSTRAINT_COMMITHOOK = 531;\nexport const SQLITE_CONSTRAINT_FOREIGNKEY = 787;\nexport const SQLITE_CONSTRAINT_FUNCTION = 1043;\nexport const SQLITE_CONSTRAINT_NOTNULL = 1299;\nexport const SQLITE_CONSTRAINT_PINNED = 2835;\nexport const SQLITE_CONSTRAINT_PRIMARYKEY = 1555;\nexport const SQLITE_CONSTRAINT_ROWID = 2579;\nexport const SQLITE_CONSTRAINT_TRIGGER = 1811;\nexport const SQLITE_CONSTRAINT_UNIQUE = 2067;\nexport const SQLITE_CONSTRAINT_VTAB = 2323;\n\n// Open flags.\n// https://www.sqlite.org/c3ref/c_open_autoproxy.html\nexport const SQLITE_OPEN_READONLY = 0x00000001;\nexport const SQLITE_OPEN_READWRITE = 0x00000002;\nexport const SQLITE_OPEN_CREATE = 0x00000004;\nexport const SQLITE_OPEN_DELETEONCLOSE = 0x00000008;\nexport const SQLITE_OPEN_EXCLUSIVE = 0x00000010;\nexport const SQLITE_OPEN_AUTOPROXY = 0x00000020;\nexport const SQLITE_OPEN_URI = 0x00000040;\nexport const SQLITE_OPEN_MEMORY = 0x00000080;\nexport const SQLITE_OPEN_MAIN_DB = 0x00000100;\nexport const SQLITE_OPEN_TEMP_DB = 0x00000200;\nexport const SQLITE_OPEN_TRANSIENT_DB = 0x00000400;\nexport const SQLITE_OPEN_MAIN_JOURNAL = 0x00000800;\nexport const SQLITE_OPEN_TEMP_JOURNAL = 0x00001000;\nexport const SQLITE_OPEN_SUBJOURNAL = 0x00002000;\nexport const SQLITE_OPEN_SUPER_JOURNAL = 0x00004000;\nexport const SQLITE_OPEN_NOMUTEX = 0x00008000;\nexport const SQLITE_OPEN_FULLMUTEX = 0x00010000;\nexport const SQLITE_OPEN_SHAREDCACHE = 0x00020000;\nexport const SQLITE_OPEN_PRIVATECACHE = 0x00040000;\nexport const SQLITE_OPEN_WAL = 0x00080000;\nexport const SQLITE_OPEN_NOFOLLOW = 0x01000000;\n\n// Locking levels.\n// https://www.sqlite.org/c3ref/c_lock_exclusive.html\nexport const SQLITE_LOCK_NONE = 0;\nexport const SQLITE_LOCK_SHARED = 1;\nexport const SQLITE_LOCK_RESERVED = 2;\nexport const SQLITE_LOCK_PENDING = 3;\nexport const SQLITE_LOCK_EXCLUSIVE = 4;\n\n// Device characteristics.\n// https://www.sqlite.org/c3ref/c_iocap_atomic.html\nexport const SQLITE_IOCAP_ATOMIC = 0x00000001;\nexport const SQLITE_IOCAP_ATOMIC512 = 0x00000002;\nexport const SQLITE_IOCAP_ATOMIC1K = 0x00000004;\nexport const SQLITE_IOCAP_ATOMIC2K = 0x00000008;\nexport const SQLITE_IOCAP_ATOMIC4K = 0x00000010;\nexport const SQLITE_IOCAP_ATOMIC8K = 0x00000020;\nexport const SQLITE_IOCAP_ATOMIC16K = 0x00000040;\nexport const SQLITE_IOCAP_ATOMIC32K = 0x00000080;\nexport const SQLITE_IOCAP_ATOMIC64K = 0x00000100;\nexport const SQLITE_IOCAP_SAFE_APPEND = 0x00000200;\nexport const SQLITE_IOCAP_SEQUENTIAL = 0x00000400;\nexport const SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN = 0x00000800;\nexport const SQLITE_IOCAP_POWERSAFE_OVERWRITE = 0x00001000;\nexport const SQLITE_IOCAP_IMMUTABLE = 0x00002000;\nexport const SQLITE_IOCAP_BATCH_ATOMIC = 0x00004000;\n\n// xAccess flags.\n// https://www.sqlite.org/c3ref/c_access_exists.html\nexport const SQLITE_ACCESS_EXISTS = 0;\nexport const SQLITE_ACCESS_READWRITE = 1;\nexport const SQLITE_ACCESS_READ = 2;\n\n// File control opcodes\n// https://www.sqlite.org/c3ref/c_fcntl_begin_atomic_write.html#sqlitefcntlbeginatomicwrite\nexport const SQLITE_FCNTL_LOCKSTATE = 1; \nexport const SQLITE_FCNTL_GET_LOCKPROXYFILE = 2; \nexport const SQLITE_FCNTL_SET_LOCKPROXYFILE = 3; \nexport const SQLITE_FCNTL_LAST_ERRNO = 4; \nexport const SQLITE_FCNTL_SIZE_HINT = 5; \nexport const SQLITE_FCNTL_CHUNK_SIZE = 6; \nexport const SQLITE_FCNTL_FILE_POINTER = 7; \nexport const SQLITE_FCNTL_SYNC_OMITTED = 8; \nexport const SQLITE_FCNTL_WIN32_AV_RETRY = 9; \nexport const SQLITE_FCNTL_PERSIST_WAL = 10; \nexport const SQLITE_FCNTL_OVERWRITE = 11; \nexport const SQLITE_FCNTL_VFSNAME = 12; \nexport const SQLITE_FCNTL_POWERSAFE_OVERWRITE = 13; \nexport const SQLITE_FCNTL_PRAGMA = 14; \nexport const SQLITE_FCNTL_BUSYHANDLER = 15; \nexport const SQLITE_FCNTL_TEMPFILENAME = 16; \nexport const SQLITE_FCNTL_MMAP_SIZE = 18; \nexport const SQLITE_FCNTL_TRACE = 19; \nexport const SQLITE_FCNTL_HAS_MOVED = 20; \nexport const SQLITE_FCNTL_SYNC = 21; \nexport const SQLITE_FCNTL_COMMIT_PHASETWO = 22; \nexport const SQLITE_FCNTL_WIN32_SET_HANDLE = 23; \nexport const SQLITE_FCNTL_WAL_BLOCK = 24; \nexport const SQLITE_FCNTL_ZIPVFS = 25; \nexport const SQLITE_FCNTL_RBU = 26; \nexport const SQLITE_FCNTL_VFS_POINTER = 27; \nexport const SQLITE_FCNTL_JOURNAL_POINTER = 28; \nexport const SQLITE_FCNTL_WIN32_GET_HANDLE = 29; \nexport const SQLITE_FCNTL_PDB = 30; \nexport const SQLITE_FCNTL_BEGIN_ATOMIC_WRITE = 31; \nexport const SQLITE_FCNTL_COMMIT_ATOMIC_WRITE = 32; \nexport const SQLITE_FCNTL_ROLLBACK_ATOMIC_WRITE = 33; \nexport const SQLITE_FCNTL_LOCK_TIMEOUT = 34; \nexport const SQLITE_FCNTL_DATA_VERSION = 35; \nexport const SQLITE_FCNTL_SIZE_LIMIT = 36; \nexport const SQLITE_FCNTL_CKPT_DONE = 37; \nexport const SQLITE_FCNTL_RESERVE_BYTES = 38; \nexport const SQLITE_FCNTL_CKPT_START = 39;\n\n// Fundamental datatypes.\n// https://www.sqlite.org/c3ref/c_blob.html\nexport const SQLITE_INTEGER = 1;\nexport const SQLITE_FLOAT = 2;\nexport const SQLITE_TEXT = 3;\nexport const SQLITE_BLOB = 4;\nexport const SQLITE_NULL = 5;\n\n// Special destructor behavior.\n// https://www.sqlite.org/c3ref/c_static.html\nexport const SQLITE_STATIC = 0;\nexport const SQLITE_TRANSIENT = -1;\n\n// Text encodings.\n// https://sqlite.org/c3ref/c_any.html\nexport const SQLITE_UTF8 = 1;     /* IMP: R-37514-35566 */\nexport const SQLITE_UTF16LE = 2;  /* IMP: R-03371-37637 */\nexport const SQLITE_UTF16BE = 3;  /* IMP: R-51971-34154 */\nexport const SQLITE_UTF16 = 4;    /* Use native byte order */\n\n// Module constraint ops.\nexport const SQLITE_INDEX_CONSTRAINT_EQ        = 2;\nexport const SQLITE_INDEX_CONSTRAINT_GT        = 4;\nexport const SQLITE_INDEX_CONSTRAINT_LE        = 8;\nexport const SQLITE_INDEX_CONSTRAINT_LT        = 16;\nexport const SQLITE_INDEX_CONSTRAINT_GE        = 32;\nexport const SQLITE_INDEX_CONSTRAINT_MATCH     = 64;\nexport const SQLITE_INDEX_CONSTRAINT_LIKE      = 65;\nexport const SQLITE_INDEX_CONSTRAINT_GLOB      = 66;\nexport const SQLITE_INDEX_CONSTRAINT_REGEXP    = 67;\nexport const SQLITE_INDEX_CONSTRAINT_NE        = 68;\nexport const SQLITE_INDEX_CONSTRAINT_ISNOT     = 69;\nexport const SQLITE_INDEX_CONSTRAINT_ISNOTNULL = 70;\nexport const SQLITE_INDEX_CONSTRAINT_ISNULL    = 71;\nexport const SQLITE_INDEX_CONSTRAINT_IS        = 72;\nexport const SQLITE_INDEX_CONSTRAINT_FUNCTION  = 150;\nexport const SQLITE_INDEX_SCAN_UNIQUE          = 1;  /* Scan visits at most = 1 row */\n\n// Function flags\nexport const SQLITE_DETERMINISTIC = 0x000000800;\nexport const SQLITE_DIRECTONLY    = 0x000080000;\nexport const SQLITE_SUBTYPE       = 0x000100000;\nexport const SQLITE_INNOCUOUS     = 0x000200000;\n\n// Sync flags\nexport const SQLITE_SYNC_NORMAL   = 0x00002;\nexport const SQLITE_SYNC_FULL     = 0x00003;\nexport const SQLITE_SYNC_DATAONLY = 0x00010;\n\n// Authorizer action codes\nexport const SQLITE_CREATE_INDEX        = 1;\nexport const SQLITE_CREATE_TABLE        = 2;\nexport const SQLITE_CREATE_TEMP_INDEX   = 3;\nexport const SQLITE_CREATE_TEMP_TABLE   = 4;\nexport const SQLITE_CREATE_TEMP_TRIGGER = 5;\nexport const SQLITE_CREATE_TEMP_VIEW    = 6;\nexport const SQLITE_CREATE_TRIGGER      = 7;\nexport const SQLITE_CREATE_VIEW         = 8;\nexport const SQLITE_DELETE              = 9;\nexport const SQLITE_DROP_INDEX          = 10;\nexport const SQLITE_DROP_TABLE          = 11;\nexport const SQLITE_DROP_TEMP_INDEX     = 12;\nexport const SQLITE_DROP_TEMP_TABLE     = 13;\nexport const SQLITE_DROP_TEMP_TRIGGER   = 14;\nexport const SQLITE_DROP_TEMP_VIEW      = 15;\nexport const SQLITE_DROP_TRIGGER        = 16;\nexport const SQLITE_DROP_VIEW           = 17;\nexport const SQLITE_INSERT              = 18;\nexport const SQLITE_PRAGMA              = 19;\nexport const SQLITE_READ                = 20;\nexport const SQLITE_SELECT              = 21;\nexport const SQLITE_TRANSACTION         = 22;\nexport const SQLITE_UPDATE              = 23;\nexport const SQLITE_ATTACH              = 24;\nexport const SQLITE_DETACH              = 25;\nexport const SQLITE_ALTER_TABLE         = 26;\nexport const SQLITE_REINDEX             = 27;\nexport const SQLITE_ANALYZE             = 28;\nexport const SQLITE_CREATE_VTABLE       = 29;\nexport const SQLITE_DROP_VTABLE         = 30;\nexport const SQLITE_FUNCTION            = 31;\nexport const SQLITE_SAVEPOINT           = 32;\nexport const SQLITE_COPY                = 0;\nexport const SQLITE_RECURSIVE           = 33;\n\n// Authorizer return codes\nexport const SQLITE_DENY   = 1;\nexport const SQLITE_IGNORE = 2;\n\n// Limit categories\nexport const SQLITE_LIMIT_LENGTH              = 0;\nexport const SQLITE_LIMIT_SQL_LENGTH          = 1;\nexport const SQLITE_LIMIT_COLUMN              = 2;\nexport const SQLITE_LIMIT_EXPR_DEPTH          = 3;\nexport const SQLITE_LIMIT_COMPOUND_SELECT     = 4;\nexport const SQLITE_LIMIT_VDBE_OP             = 5;\nexport const SQLITE_LIMIT_FUNCTION_ARG        = 6;\nexport const SQLITE_LIMIT_ATTACHED            = 7;\nexport const SQLITE_LIMIT_LIKE_PATTERN_LENGTH = 8;\nexport const SQLITE_LIMIT_VARIABLE_NUMBER     = 9;\nexport const SQLITE_LIMIT_TRIGGER_DEPTH       = 10;\nexport const SQLITE_LIMIT_WORKER_THREADS      = 11;","// Copyright 2021 Roy T. Hashimoto. All Rights Reserved.\n\nimport * as SQLite from './sqlite-constants.js';\nexport * from './sqlite-constants.js';\n\n/**\n * Need to have a serializer for bigint\n * https://github.com/GoogleChromeLabs/jsbi/issues/30\n */\nif (typeof BigInt.prototype['toJSON'] == 'undefined') {\n  BigInt.prototype['toJSON'] = function() {\n    return this.toString();\n  };\n}\n\nconst MAX_INT64 = 0x7fffffffffffffffn;\nconst MIN_INT64 = -0x8000000000000000n;\n\nexport class SQLiteError extends Error {\n  constructor(message, code) {\n    super(message);\n    this.code = code;\n  }\n}\n\nconst async = true;\n\nconst onTableChangeCallbacks = {};\nglobalThis.__onTablesChanged = function(db, opType, tableName, rowId) {\n  onTableChangeCallbacks[db]?.(opType, tableName, rowId);\n};\n\n/**\n * Builds a Javascript API from the Emscripten module. This API is still\n * low-level and closely corresponds to the C API exported by the module,\n * but differs in some specifics like throwing exceptions on errors.\n * @param {*} Module SQLite Emscripten module\n * @returns {SQLiteAPI}\n */\nexport function Factory(Module) {\n  /** @type {SQLiteAPI} */ const sqlite3 = {};\n\n  const sqliteFreeAddress = Module._getSqliteFree();\n\n  // Allocate some space for 32-bit returned values.\n  const tmp = Module._malloc(8);\n  const tmpPtr = [tmp, tmp + 4];\n\n  // Convert a JS string to a C string. sqlite3_malloc is used to allocate\n  // memory (use sqlite3_free to deallocate).\n  function createUTF8(s) {\n    if (typeof s !== 'string') return 0;\n    const n = Module.lengthBytesUTF8(s);\n    const zts = Module._sqlite3_malloc(n + 1);\n    Module.stringToUTF8(s, zts, n + 1);\n    return zts;\n  }\n\n  /**\n   * Concatenate 32-bit numbers into a 64-bit (signed) BigInt.\n   * @param {number} lo32\n   * @param {number} hi32\n   * @returns {bigint}\n   */\n  function cvt32x2ToBigInt(lo32, hi32) {\n    return (BigInt(hi32) << 32n) | (BigInt(lo32) & 0xffffffffn);\n  }\n\n  // /**\n  //  * Setup table change update callback\n  //  */\n  // var onTableChangedFunctionPointer = Module.addFunction(onTableUpdate);\n  // var passFnPointer = Module.cwrap('passFnPointer', 'undefined', ['number']);\n  // passFnPointer(onTableChangedFunctionPointer);\n  /**\n   * Concatenate 32-bit numbers and return as number or BigInt, depending\n   * on the value.\n   * @param {number} lo32\n   * @param {number} hi32\n   * @returns {number|bigint}\n   */\n  const cvt32x2AsSafe = (function() {\n    const hiMax = BigInt(Number.MAX_SAFE_INTEGER) >> 32n;\n    const hiMin = BigInt(Number.MIN_SAFE_INTEGER) >> 32n;\n\n    return function(lo32, hi32) {\n      if (hi32 > hiMax || hi32 < hiMin) {\n        // Can't be expressed as a Number so use BigInt.\n        return cvt32x2ToBigInt(lo32, hi32);\n      } else {\n        // Combine the upper and lower 32-bit numbers. The complication is\n        // that lo32 is a signed integer which makes manipulating its bits\n        // a little tricky - the sign bit gets handled separately.\n        return hi32 * 0x100000000 + (lo32 & 0x7fffffff) - (lo32 & 0x80000000);\n      }\n    };\n  })();\n\n  const databases = new Set();\n  function verifyDatabase(db) {\n    if (!databases.has(db)) {\n      throw new SQLiteError('not a database', SQLite.SQLITE_MISUSE);\n    }\n  }\n\n  const mapStmtToDB = new Map();\n  function verifyStatement(stmt) {\n    if (!mapStmtToDB.has(stmt)) {\n      throw new SQLiteError('not a statement', SQLite.SQLITE_MISUSE);\n    }\n  }\n\n  sqlite3.bind_collection = function(stmt, bindings) {\n    verifyStatement(stmt);\n    const isArray = Array.isArray(bindings);\n    const nBindings = sqlite3.bind_parameter_count(stmt);\n    for (let i = 1; i <= nBindings; ++i) {\n      const key = isArray ? i - 1 : sqlite3.bind_parameter_name(stmt, i);\n      const value = bindings[key];\n      if (value !== undefined) {\n        sqlite3.bind(stmt, i, value);\n      }\n    }\n    return SQLite.SQLITE_OK;\n  };\n\n  sqlite3.bind = function(stmt, i, value) {\n    verifyStatement(stmt);\n    switch (typeof value) {\n      case 'number':\n        if (value === (value | 0)) {\n          return sqlite3.bind_int(stmt, i, value);\n        } else {\n          return sqlite3.bind_double(stmt, i, value);\n        }\n      case 'string':\n        return sqlite3.bind_text(stmt, i, value);\n      default:\n        if (value instanceof Uint8Array || Array.isArray(value)) {\n          return sqlite3.bind_blob(stmt, i, value);\n        } else if (value === null) {\n          return sqlite3.bind_null(stmt, i);\n        } else if (typeof value === 'bigint') {\n          return sqlite3.bind_int64(stmt, i, value);\n        } else if (value === undefined) {\n          // Existing binding (or NULL) will be used.\n          return SQLite.SQLITE_NOTICE;\n        } else {\n          console.warn('unknown binding converted to null', value);\n          return sqlite3.bind_null(stmt, i);\n        }\n    }\n  };\n\n  sqlite3.bind_blob = (function() {\n    const fname = 'sqlite3_bind_blob';\n    const f = Module.cwrap(fname, ...decl('nnnnn:n'));\n    return function(stmt, i, value) {\n      verifyStatement(stmt);\n      // @ts-ignore\n      const byteLength = value.byteLength ?? value.length;\n      const ptr = Module._sqlite3_malloc(byteLength);\n      Module.HEAPU8.subarray(ptr).set(value);\n      const result = f(stmt, i, ptr, byteLength, sqliteFreeAddress);\n      // trace(fname, result);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.bind_parameter_count = (function() {\n    const fname = 'sqlite3_bind_parameter_count';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(stmt) {\n      verifyStatement(stmt);\n      const result = f(stmt);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.bind_double = (function() {\n    const fname = 'sqlite3_bind_double';\n    const f = Module.cwrap(fname, ...decl('nnn:n'));\n    return function(stmt, i, value) {\n      verifyStatement(stmt);\n      const result = f(stmt, i, value);\n      // trace(fname, result);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.bind_int = (function() {\n    const fname = 'sqlite3_bind_int';\n    const f = Module.cwrap(fname, ...decl('nnn:n'));\n    return function(stmt, i, value) {\n      verifyStatement(stmt);\n      if (value > 0x7fffffff || value < -0x80000000) return SQLite.SQLITE_RANGE;\n\n      const result = f(stmt, i, value);\n      // trace(fname, result);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.bind_int64 = (function() {\n    const fname = 'sqlite3_bind_int64';\n    const f = Module.cwrap(fname, ...decl('nnnn:n'));\n    return function(stmt, i, value) {\n      verifyStatement(stmt);\n      if (value > MAX_INT64 || value < MIN_INT64) return SQLite.SQLITE_RANGE;\n\n      const lo32 = value & 0xffffffffn;\n      const hi32 = value >> 32n;\n      const result = f(stmt, i, Number(lo32), Number(hi32));\n      // trace(fname, result);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.bind_null = (function() {\n    const fname = 'sqlite3_bind_null';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, i) {\n      verifyStatement(stmt);\n      const result = f(stmt, i);\n      // trace(fname, result);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.bind_parameter_name = (function() {\n    const fname = 'sqlite3_bind_parameter_name';\n    const f = Module.cwrap(fname, ...decl('n:s'));\n    return function(stmt, i) {\n      verifyStatement(stmt);\n      const result = f(stmt, i);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.bind_text = (function() {\n    const fname = 'sqlite3_bind_text';\n    const f = Module.cwrap(fname, ...decl('nnnnn:n'));\n    return function(stmt, i, value) {\n      verifyStatement(stmt);\n      const ptr = createUTF8(value);\n      const result = f(stmt, i, ptr, -1, sqliteFreeAddress);\n      // trace(fname, result);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.changes = (function() {\n    const fname = 'sqlite3_changes';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(db) {\n      verifyDatabase(db);\n      const result = f(db);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.last_insert_id = (function() {\n    const fname = 'sqlite3_last_insert_rowid';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(db) {\n      verifyDatabase(db);\n      const result = f(db);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.close = (function() {\n    const fname = 'sqlite3_close';\n    const f = Module.cwrap(fname, ...decl('n:n'), { async });\n    return async function(db) {\n      verifyDatabase(db);\n      const result = await f(db);\n      databases.delete(db);\n      return check(fname, result, db);\n    };\n  })();\n\n  sqlite3.column = function(stmt, iCol) {\n    verifyStatement(stmt);\n    const type = sqlite3.column_type(stmt, iCol);\n    switch (type) {\n      case SQLite.SQLITE_BLOB:\n        return sqlite3.column_blob(stmt, iCol);\n      case SQLite.SQLITE_FLOAT:\n        return sqlite3.column_double(stmt, iCol);\n      case SQLite.SQLITE_INTEGER:\n        const lo32 = sqlite3.column_int(stmt, iCol);\n        const hi32 = Module.getTempRet0();\n        return cvt32x2AsSafe(lo32, hi32);\n      case SQLite.SQLITE_NULL:\n        return null;\n      case SQLite.SQLITE_TEXT:\n        return sqlite3.column_text(stmt, iCol);\n      default:\n        throw new SQLiteError('unknown type', type);\n    }\n  };\n\n  sqlite3.column_blob = (function() {\n    const fname = 'sqlite3_column_blob';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const nBytes = sqlite3.column_bytes(stmt, iCol);\n      const address = f(stmt, iCol);\n      const result = Module.HEAPU8.subarray(address, address + nBytes);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_bytes = (function() {\n    const fname = 'sqlite3_column_bytes';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const result = f(stmt, iCol);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_count = (function() {\n    const fname = 'sqlite3_column_count';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(stmt) {\n      verifyStatement(stmt);\n      const result = f(stmt);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_double = (function() {\n    const fname = 'sqlite3_column_double';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const result = f(stmt, iCol);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_int = (function() {\n    // Retrieve int64 but use only the lower 32 bits. The upper 32-bits are\n    // accessible with Module.getTempRet0().\n    const fname = 'sqlite3_column_int64';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const result = f(stmt, iCol);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_int64 = (function() {\n    const fname = 'sqlite3_column_int64';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const lo32 = f(stmt, iCol);\n      const hi32 = Module.getTempRet0();\n      const result = cvt32x2ToBigInt(lo32, hi32);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_name = (function() {\n    const fname = 'sqlite3_column_name';\n    const f = Module.cwrap(fname, ...decl('nn:s'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const result = f(stmt, iCol);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_names = function(stmt) {\n    const columns = [];\n    const nColumns = sqlite3.column_count(stmt);\n    for (let i = 0; i < nColumns; ++i) {\n      columns.push(sqlite3.column_name(stmt, i));\n    }\n    return columns;\n  };\n\n  sqlite3.column_text = (function() {\n    const fname = 'sqlite3_column_text';\n    const f = Module.cwrap(fname, ...decl('nn:s'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const result = f(stmt, iCol);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.column_type = (function() {\n    const fname = 'sqlite3_column_type';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(stmt, iCol) {\n      verifyStatement(stmt);\n      const result = f(stmt, iCol);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.create_function = function(db, zFunctionName, nArg, eTextRep, pApp, xFunc, xStep, xFinal) {\n    verifyDatabase(db);\n    if (xFunc && !xStep && !xFinal) {\n      const result = Module.createFunction(db, zFunctionName, nArg, eTextRep, pApp, xFunc);\n      return check('sqlite3_create_function', result, db);\n    }\n\n    if (!xFunc && xStep && xFinal) {\n      const result = Module.createAggregate(db, zFunctionName, nArg, eTextRep, pApp, xStep, xFinal);\n      return check('sqlite3_create_function', result, db);\n    }\n\n    throw new SQLiteError('invalid function combination', SQLite.SQLITE_MISUSE);\n  };\n\n  sqlite3.create_module = function(db, zName, module, appData) {\n    verifyDatabase(db);\n    const result = Module.createModule(db, zName, module, appData);\n    return check('sqlite3_create_module', result, db);\n  };\n\n  sqlite3.data_count = (function() {\n    const fname = 'sqlite3_data_count';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(stmt) {\n      verifyStatement(stmt);\n      const result = f(stmt);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.declare_vtab = (function() {\n    const fname = 'sqlite3_declare_vtab';\n    const f = Module.cwrap(fname, ...decl('ns:n'));\n    return function(pVTab, zSQL) {\n      const result = f(pVTab, zSQL);\n      return check('sqlite3_declare_vtab', result);\n    }\n  })();\n\n  sqlite3.exec = async function(db, sql, callback) {\n    for await (const stmt of sqlite3.statements(db, sql)) {\n      let columns;\n      while ((await sqlite3.step(stmt)) === SQLite.SQLITE_ROW) {\n        if (callback) {\n          columns = columns ?? sqlite3.column_names(stmt);\n          const row = sqlite3.row(stmt);\n          await callback(row, columns);\n        }\n      }\n    }\n    return SQLite.SQLITE_OK;\n  };\n\n  sqlite3.finalize = (function() {\n    const fname = 'sqlite3_finalize';\n    const f = Module.cwrap(fname, ...decl('n:n'), { async });\n    return async function(stmt) {\n      if (!mapStmtToDB.has(stmt)) {\n        return SQLite.SQLITE_MISUSE;\n      }\n      const result = await f(stmt);\n\n      const db = mapStmtToDB.get(stmt);\n      mapStmtToDB.delete(stmt);\n\n      // Don't throw on error here. Typically the error has already been\n      // thrown and finalize() is part of the cleanup.\n      return result;\n    };\n  })();\n\n  sqlite3.get_autocommit = (function() {\n    const fname = 'sqlite3_get_autocommit';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(db) {\n      const result = f(db);\n      return result;\n    };\n  })();\n\n  sqlite3.libversion = (function() {\n    const fname = 'sqlite3_libversion';\n    const f = Module.cwrap(fname, ...decl(':s'));\n    return function() {\n      const result = f();\n      return result;\n    };\n  })();\n\n  sqlite3.libversion_number = (function() {\n    const fname = 'sqlite3_libversion_number';\n    const f = Module.cwrap(fname, ...decl(':n'));\n    return function() {\n      const result = f();\n      return result;\n    };\n  })();\n\n  sqlite3.limit = (function() {\n    const fname = 'sqlite3_limit';\n    const f = Module.cwrap(fname, ...decl('nnn:n'));\n    return function(db, id, newVal) {\n      const result = f(db, id, newVal);\n      return result;\n    };\n  })();\n\n  sqlite3.open_v2 = (function() {\n    const fname = 'sqlite3_open_v2';\n    const f = Module.cwrap(fname, ...decl('snnn:n'), { async });\n    return async function(zFilename, flags, zVfs) {\n      flags = flags || SQLite.SQLITE_OPEN_CREATE | SQLite.SQLITE_OPEN_READWRITE;\n      zVfs = createUTF8(zVfs);\n      Module.ccall('setup_powersync', 'int', []);\n\n      const result = await f(zFilename, tmpPtr[0], flags, zVfs);\n\n      const db = Module.getValue(tmpPtr[0], '*');\n\n      databases.add(db);\n      Module._sqlite3_free(zVfs);\n\n      Module.ccall('RegisterExtensionFunctions', 'void', ['number'], [db]);\n      check(fname, result);\n      return db;\n    };\n  })();\n\n  sqlite3.register_table_onchange_hook = function(db, callback) {\n    // Register hooks for this DB as a global hook\n    // It will call the global handler above\n    Module.ccall('register_table_update_hook', 'int', ['number'], [db]);\n\n    onTableChangeCallbacks[db] = function(opType, tableNamePtr, rowId) {\n      // Need to get the string from the pointer\n      // const tableName = Module.UTF8ToString(Module.getValue(tableNamePtr, '*'));\n      const memory = new DataView(Module.HEAPU8.buffer);\n\n      // Find the null terminator to determine the string length\n      let length = 0;\n      while (memory.getUint8(tableNamePtr + length) !== 0) {\n        length++;\n      }\n\n      // Extract the string content\n      const stringBytes = new Uint8Array(Module.HEAPU8.buffer, tableNamePtr, length);\n      const tableName = new TextDecoder().decode(stringBytes);\n\n      /**\n       * Call the callback inside a setTimeout to avoid blocking SQLite.\n       * We use a setTimeout only after fetching data from the heap to avoid\n       * accessing memory which has been freed. \n       */\n      setTimeout(() => callback(opType, tableName, rowId), 0)\n    };\n  };\n\n  sqlite3.prepare_v2 = (function() {\n    const fname = 'sqlite3_prepare_v2';\n    const f = Module.cwrap(fname, ...decl('nnnnn:n'), { async });\n    return async function(db, sql) {\n      const result = await f(db, sql, -1, tmpPtr[0], tmpPtr[1]);\n      check(fname, result, db);\n\n      const stmt = Module.getValue(tmpPtr[0], '*');\n      if (stmt) {\n        mapStmtToDB.set(stmt, db);\n        return { stmt, sql: Module.getValue(tmpPtr[1], '*') };\n      }\n      return null;\n    };\n  })();\n\n  sqlite3.progress_handler = function(db, nProgressOps, handler, userData) {\n    verifyDatabase(db);\n    Module.progressHandler(db, nProgressOps, handler, userData);\n  };\n\n  sqlite3.reset = (function() {\n    const fname = 'sqlite3_reset';\n    const f = Module.cwrap(fname, ...decl('n:n'), { async });\n    return async function(stmt) {\n      verifyStatement(stmt);\n      const result = await f(stmt);\n      return check(fname, result, mapStmtToDB.get(stmt));\n    };\n  })();\n\n  sqlite3.result = function(context, value) {\n    switch (typeof value) {\n      case 'number':\n        if (value === (value | 0)) {\n          sqlite3.result_int(context, value);\n        } else {\n          sqlite3.result_double(context, value);\n        }\n        break;\n      case 'string':\n        sqlite3.result_text(context, value);\n        break;\n      default:\n        if (value instanceof Uint8Array || Array.isArray(value)) {\n          sqlite3.result_blob(context, value);\n        } else if (value === null) {\n          sqlite3.result_null(context);\n        } else if (typeof value === 'bigint') {\n          return sqlite3.result_int64(context, value);\n        } else {\n          console.warn('unknown result converted to null', value);\n          sqlite3.result_null(context);\n        }\n        break;\n    }\n  };\n\n  sqlite3.result_blob = (function() {\n    const fname = 'sqlite3_result_blob';\n    const f = Module.cwrap(fname, ...decl('nnnn:n'));\n    return function(context, value) {\n      // @ts-ignore\n      const byteLength = value.byteLength ?? value.length;\n      const ptr = Module._sqlite3_malloc(byteLength);\n      Module.HEAPU8.subarray(ptr).set(value);\n      f(context, ptr, byteLength, sqliteFreeAddress); // void return\n    };\n  })();\n\n  sqlite3.result_double = (function() {\n    const fname = 'sqlite3_result_double';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(context, value) {\n      f(context, value); // void return\n    };\n  })();\n\n  sqlite3.result_int = (function() {\n    const fname = 'sqlite3_result_int';\n    const f = Module.cwrap(fname, ...decl('nn:n'));\n    return function(context, value) {\n      f(context, value); // void return\n    };\n  })();\n\n  sqlite3.result_int64 = (function() {\n    const fname = 'sqlite3_result_int64';\n    const f = Module.cwrap(fname, ...decl('nnn:n'));\n    return function(context, value) {\n      if (value > MAX_INT64 || value < MIN_INT64) return SQLite.SQLITE_RANGE;\n\n      const lo32 = value & 0xffffffffn;\n      const hi32 = value >> 32n;\n      f(context, Number(lo32), Number(hi32)); // void return\n    };\n  })();\n\n  sqlite3.result_null = (function() {\n    const fname = 'sqlite3_result_null';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(context) {\n      f(context); // void return\n    };\n  })();\n\n  sqlite3.result_text = (function() {\n    const fname = 'sqlite3_result_text';\n    const f = Module.cwrap(fname, ...decl('nnnn:n'));\n    return function(context, value) {\n      const ptr = createUTF8(value);\n      f(context, ptr, -1, sqliteFreeAddress); // void return\n    };\n  })();\n\n  sqlite3.row = function(stmt) {\n    const row = [];\n    const nColumns = sqlite3.data_count(stmt);\n    for (let i = 0; i < nColumns; ++i) {\n      const value = sqlite3.column(stmt, i);\n\n      // Copy blob if aliasing volatile WebAssembly memory. This avoids an\n      // unnecessary copy if users monkey patch column_blob to copy.\n      // @ts-ignore\n      row.push(value?.buffer === Module.HEAPU8.buffer ? value.slice() : value);\n    }\n    return row;\n  };\n\n  sqlite3.set_authorizer = function(db, authFunction, userData) {\n    verifyDatabase(db);\n    const result = Module.setAuthorizer(db, authFunction, userData);\n    return check('sqlite3_set_authorizer', result, db);\n  };\n\n  sqlite3.sql = (function() {\n    const fname = 'sqlite3_sql';\n    const f = Module.cwrap(fname, ...decl('n:s'));\n    return function(stmt) {\n      verifyStatement(stmt);\n      const result = f(stmt);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.statements = function(db, sql) {\n    return (async function*() {\n      const str = sqlite3.str_new(db, sql);\n      let prepared = { stmt: null, sql: sqlite3.str_value(str) };\n      try {\n        while ((prepared = await sqlite3.prepare_v2(db, prepared.sql))) {\n          // console.log(sqlite3.sql(prepared.stmt));\n          yield prepared.stmt;\n          sqlite3.finalize(prepared.stmt);\n          prepared.stmt = null;\n        }\n      } finally {\n        if (prepared?.stmt) {\n          sqlite3.finalize(prepared.stmt);\n        }\n        sqlite3.str_finish(str);\n      }\n    })();\n  };\n\n  sqlite3.step = (function() {\n    const fname = 'sqlite3_step';\n    const f = Module.cwrap(fname, ...decl('n:n'), { async });\n    return async function(stmt) {\n      verifyStatement(stmt);\n      const result = await f(stmt);\n      return check(fname, result, mapStmtToDB.get(stmt), [SQLite.SQLITE_ROW, SQLite.SQLITE_DONE]);\n    };\n  })();\n\n  // Duplicate some of the SQLite dynamic string API but without\n  // calling SQLite (except for memory allocation). We need some way\n  // to transfer Javascript strings and might as well use an API\n  // that mimics the SQLite API.\n  let stringId = 0;\n  const strings = new Map();\n\n  sqlite3.str_new = function(db, s = '') {\n    const sBytes = Module.lengthBytesUTF8(s);\n    const str = stringId++ & 0xffffffff;\n    const data = {\n      offset: Module._sqlite3_malloc(sBytes + 1),\n      bytes: sBytes\n    };\n    strings.set(str, data);\n    Module.stringToUTF8(s, data.offset, data.bytes + 1);\n    return str;\n  };\n\n  sqlite3.str_appendall = function(str, s) {\n    if (!strings.has(str)) {\n      throw new SQLiteError('not a string', SQLite.SQLITE_MISUSE);\n    }\n    const data = strings.get(str);\n\n    const sBytes = Module.lengthBytesUTF8(s);\n    const newBytes = data.bytes + sBytes;\n    const newOffset = Module._sqlite3_malloc(newBytes + 1);\n    const newArray = Module.HEAPU8.subarray(newOffset, newOffset + newBytes + 1);\n    newArray.set(Module.HEAPU8.subarray(data.offset, data.offset + data.bytes));\n    Module.stringToUTF8(s, newOffset + data.bytes, sBytes + 1);\n\n    Module._sqlite3_free(data.offset);\n    data.offset = newOffset;\n    data.bytes = newBytes;\n    strings.set(str, data);\n  };\n\n  sqlite3.str_finish = function(str) {\n    if (!strings.has(str)) {\n      throw new SQLiteError('not a string', SQLite.SQLITE_MISUSE);\n    }\n    const data = strings.get(str);\n    strings.delete(str);\n    Module._sqlite3_free(data.offset);\n  };\n\n  sqlite3.str_value = function(str) {\n    if (!strings.has(str)) {\n      throw new SQLiteError('not a string', SQLite.SQLITE_MISUSE);\n    }\n    return strings.get(str).offset;\n  };\n\n  sqlite3.user_data = function(context) {\n    return Module.getFunctionUserData(context);\n  };\n\n  sqlite3.value = function(pValue) {\n    const type = sqlite3.value_type(pValue);\n    switch (type) {\n      case SQLite.SQLITE_BLOB:\n        return sqlite3.value_blob(pValue);\n      case SQLite.SQLITE_FLOAT:\n        return sqlite3.value_double(pValue);\n      case SQLite.SQLITE_INTEGER:\n        const lo32 = sqlite3.value_int(pValue);\n        const hi32 = Module.getTempRet0();\n        return cvt32x2AsSafe(lo32, hi32);\n      case SQLite.SQLITE_NULL:\n        return null;\n      case SQLite.SQLITE_TEXT:\n        return sqlite3.value_text(pValue);\n      default:\n        throw new SQLiteError('unknown type', type);\n    }\n  };\n\n  sqlite3.value_blob = (function() {\n    const fname = 'sqlite3_value_blob';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(pValue) {\n      const nBytes = sqlite3.value_bytes(pValue);\n      const address = f(pValue);\n      const result = Module.HEAPU8.subarray(address, address + nBytes);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.value_bytes = (function() {\n    const fname = 'sqlite3_value_bytes';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(pValue) {\n      const result = f(pValue);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.value_double = (function() {\n    const fname = 'sqlite3_value_double';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(pValue) {\n      const result = f(pValue);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.value_int = (function() {\n    const fname = 'sqlite3_value_int64';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(pValue) {\n      const result = f(pValue);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.value_int64 = (function() {\n    const fname = 'sqlite3_value_int64';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(pValue) {\n      const lo32 = f(pValue);\n      const hi32 = Module.getTempRet0();\n      const result = cvt32x2ToBigInt(lo32, hi32);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.value_text = (function() {\n    const fname = 'sqlite3_value_text';\n    const f = Module.cwrap(fname, ...decl('n:s'));\n    return function(pValue) {\n      const result = f(pValue);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.value_type = (function() {\n    const fname = 'sqlite3_value_type';\n    const f = Module.cwrap(fname, ...decl('n:n'));\n    return function(pValue) {\n      const result = f(pValue);\n      // trace(fname, result);\n      return result;\n    };\n  })();\n\n  sqlite3.vfs_register = function(vfs, makeDefault) {\n    const result = Module.registerVFS(vfs, makeDefault);\n    return check('sqlite3_vfs_register', result);\n  };\n\n  function check(fname, result, db = null, allowed = [SQLite.SQLITE_OK]) {\n    // trace(fname, result);\n    if (allowed.includes(result)) return result;\n    const message = db ? Module.ccall('sqlite3_errmsg', 'string', ['number'], [db]) : fname;\n    throw new SQLiteError(message, result);\n  }\n\n  return sqlite3;\n}\n\nfunction trace(...args) {\n  // const date = new Date();\n  // const t = date.getHours().toString().padStart(2, '0') + ':' +\n  //           date.getMinutes().toString().padStart(2, '0') + ':' +\n  //           date.getSeconds().toString().padStart(2, '0') + '.' +\n  //           date.getMilliseconds().toString().padStart(3, '0');\n  // console.debug(t, ...args);\n}\n\n// Helper function to use a more compact signature specification.\nfunction decl(s) {\n  const result = [];\n  const m = s.match(/([ns@]*):([nsv@])/);\n  switch (m[2]) {\n    case 'n':\n      result.push('number');\n      break;\n    case 's':\n      result.push('string');\n      break;\n    case 'v':\n      result.push(null);\n      break;\n  }\n\n  const args = [];\n  for (let c of m[1]) {\n    switch (c) {\n      case 'n':\n        args.push('number');\n        break;\n      case 's':\n        args.push('string');\n        break;\n    }\n  }\n  result.push(args);\n  return result;\n}\n","/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\nconst proxyMarker = Symbol(\"Comlink.proxy\");\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\nconst finalizer = Symbol(\"Comlink.finalizer\");\nconst throwMarker = Symbol(\"Comlink.thrown\");\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\n/**\n * Internal transfer handle to handle objects marked to proxy.\n */\nconst proxyTransferHandler = {\n    canHandle: (val) => isObject(val) && val[proxyMarker],\n    serialize(obj) {\n        const { port1, port2 } = new MessageChannel();\n        expose(obj, port1);\n        return [port2, [port2]];\n    },\n    deserialize(port) {\n        port.start();\n        return wrap(port);\n    },\n};\n/**\n * Internal transfer handler to handle thrown exceptions.\n */\nconst throwTransferHandler = {\n    canHandle: (value) => isObject(value) && throwMarker in value,\n    serialize({ value }) {\n        let serialized;\n        if (value instanceof Error) {\n            serialized = {\n                isError: true,\n                value: {\n                    message: value.message,\n                    name: value.name,\n                    stack: value.stack,\n                },\n            };\n        }\n        else {\n            serialized = { isError: false, value };\n        }\n        return [serialized, []];\n    },\n    deserialize(serialized) {\n        if (serialized.isError) {\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\n        }\n        throw serialized.value;\n    },\n};\n/**\n * Allows customizing the serialization of certain values.\n */\nconst transferHandlers = new Map([\n    [\"proxy\", proxyTransferHandler],\n    [\"throw\", throwTransferHandler],\n]);\nfunction isAllowedOrigin(allowedOrigins, origin) {\n    for (const allowedOrigin of allowedOrigins) {\n        if (origin === allowedOrigin || allowedOrigin === \"*\") {\n            return true;\n        }\n        if (allowedOrigin instanceof RegExp && allowedOrigin.test(origin)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction expose(obj, ep = globalThis, allowedOrigins = [\"*\"]) {\n    ep.addEventListener(\"message\", function callback(ev) {\n        if (!ev || !ev.data) {\n            return;\n        }\n        if (!isAllowedOrigin(allowedOrigins, ev.origin)) {\n            console.warn(`Invalid origin '${ev.origin}' for comlink proxy`);\n            return;\n        }\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\n        let returnValue;\n        try {\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\n            switch (type) {\n                case \"GET\" /* MessageType.GET */:\n                    {\n                        returnValue = rawValue;\n                    }\n                    break;\n                case \"SET\" /* MessageType.SET */:\n                    {\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\n                        returnValue = true;\n                    }\n                    break;\n                case \"APPLY\" /* MessageType.APPLY */:\n                    {\n                        returnValue = rawValue.apply(parent, argumentList);\n                    }\n                    break;\n                case \"CONSTRUCT\" /* MessageType.CONSTRUCT */:\n                    {\n                        const value = new rawValue(...argumentList);\n                        returnValue = proxy(value);\n                    }\n                    break;\n                case \"ENDPOINT\" /* MessageType.ENDPOINT */:\n                    {\n                        const { port1, port2 } = new MessageChannel();\n                        expose(obj, port2);\n                        returnValue = transfer(port1, [port1]);\n                    }\n                    break;\n                case \"RELEASE\" /* MessageType.RELEASE */:\n                    {\n                        returnValue = undefined;\n                    }\n                    break;\n                default:\n                    return;\n            }\n        }\n        catch (value) {\n            returnValue = { value, [throwMarker]: 0 };\n        }\n        Promise.resolve(returnValue)\n            .catch((value) => {\n            return { value, [throwMarker]: 0 };\n        })\n            .then((returnValue) => {\n            const [wireValue, transferables] = toWireValue(returnValue);\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n            if (type === \"RELEASE\" /* MessageType.RELEASE */) {\n                // detach and deactive after sending release response above.\n                ep.removeEventListener(\"message\", callback);\n                closeEndPoint(ep);\n                if (finalizer in obj && typeof obj[finalizer] === \"function\") {\n                    obj[finalizer]();\n                }\n            }\n        })\n            .catch((error) => {\n            // Send Serialization Error To Caller\n            const [wireValue, transferables] = toWireValue({\n                value: new TypeError(\"Unserializable return value\"),\n                [throwMarker]: 0,\n            });\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n        });\n    });\n    if (ep.start) {\n        ep.start();\n    }\n}\nfunction isMessagePort(endpoint) {\n    return endpoint.constructor.name === \"MessagePort\";\n}\nfunction closeEndPoint(endpoint) {\n    if (isMessagePort(endpoint))\n        endpoint.close();\n}\nfunction wrap(ep, target) {\n    const pendingListeners = new Map();\n    ep.addEventListener(\"message\", function handleMessage(ev) {\n        const { data } = ev;\n        if (!data || !data.id) {\n            return;\n        }\n        const resolver = pendingListeners.get(data.id);\n        if (!resolver) {\n            return;\n        }\n        try {\n            resolver(data);\n        }\n        finally {\n            pendingListeners.delete(data.id);\n        }\n    });\n    return createProxy(ep, pendingListeners, [], target);\n}\nfunction throwIfProxyReleased(isReleased) {\n    if (isReleased) {\n        throw new Error(\"Proxy has been released and is not useable\");\n    }\n}\nfunction releaseEndpoint(ep) {\n    return requestResponseMessage(ep, new Map(), {\n        type: \"RELEASE\" /* MessageType.RELEASE */,\n    }).then(() => {\n        closeEndPoint(ep);\n    });\n}\nconst proxyCounter = new WeakMap();\nconst proxyFinalizers = \"FinalizationRegistry\" in globalThis &&\n    new FinalizationRegistry((ep) => {\n        const newCount = (proxyCounter.get(ep) || 0) - 1;\n        proxyCounter.set(ep, newCount);\n        if (newCount === 0) {\n            releaseEndpoint(ep);\n        }\n    });\nfunction registerProxy(proxy, ep) {\n    const newCount = (proxyCounter.get(ep) || 0) + 1;\n    proxyCounter.set(ep, newCount);\n    if (proxyFinalizers) {\n        proxyFinalizers.register(proxy, ep, proxy);\n    }\n}\nfunction unregisterProxy(proxy) {\n    if (proxyFinalizers) {\n        proxyFinalizers.unregister(proxy);\n    }\n}\nfunction createProxy(ep, pendingListeners, path = [], target = function () { }) {\n    let isProxyReleased = false;\n    const proxy = new Proxy(target, {\n        get(_target, prop) {\n            throwIfProxyReleased(isProxyReleased);\n            if (prop === releaseProxy) {\n                return () => {\n                    unregisterProxy(proxy);\n                    releaseEndpoint(ep);\n                    pendingListeners.clear();\n                    isProxyReleased = true;\n                };\n            }\n            if (prop === \"then\") {\n                if (path.length === 0) {\n                    return { then: () => proxy };\n                }\n                const r = requestResponseMessage(ep, pendingListeners, {\n                    type: \"GET\" /* MessageType.GET */,\n                    path: path.map((p) => p.toString()),\n                }).then(fromWireValue);\n                return r.then.bind(r);\n            }\n            return createProxy(ep, pendingListeners, [...path, prop]);\n        },\n        set(_target, prop, rawValue) {\n            throwIfProxyReleased(isProxyReleased);\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\n            // boolean. To show good will, we return true asynchronously \\_()_/\n            const [value, transferables] = toWireValue(rawValue);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"SET\" /* MessageType.SET */,\n                path: [...path, prop].map((p) => p.toString()),\n                value,\n            }, transferables).then(fromWireValue);\n        },\n        apply(_target, _thisArg, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const last = path[path.length - 1];\n            if (last === createEndpoint) {\n                return requestResponseMessage(ep, pendingListeners, {\n                    type: \"ENDPOINT\" /* MessageType.ENDPOINT */,\n                }).then(fromWireValue);\n            }\n            // We just pretend that `bind()` didnt happen.\n            if (last === \"bind\") {\n                return createProxy(ep, pendingListeners, path.slice(0, -1));\n            }\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"APPLY\" /* MessageType.APPLY */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n        construct(_target, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"CONSTRUCT\" /* MessageType.CONSTRUCT */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n    });\n    registerProxy(proxy, ep);\n    return proxy;\n}\nfunction myFlat(arr) {\n    return Array.prototype.concat.apply([], arr);\n}\nfunction processArguments(argumentList) {\n    const processed = argumentList.map(toWireValue);\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\n}\nconst transferCache = new WeakMap();\nfunction transfer(obj, transfers) {\n    transferCache.set(obj, transfers);\n    return obj;\n}\nfunction proxy(obj) {\n    return Object.assign(obj, { [proxyMarker]: true });\n}\nfunction windowEndpoint(w, context = globalThis, targetOrigin = \"*\") {\n    return {\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\n        addEventListener: context.addEventListener.bind(context),\n        removeEventListener: context.removeEventListener.bind(context),\n    };\n}\nfunction toWireValue(value) {\n    for (const [name, handler] of transferHandlers) {\n        if (handler.canHandle(value)) {\n            const [serializedValue, transferables] = handler.serialize(value);\n            return [\n                {\n                    type: \"HANDLER\" /* WireValueType.HANDLER */,\n                    name,\n                    value: serializedValue,\n                },\n                transferables,\n            ];\n        }\n    }\n    return [\n        {\n            type: \"RAW\" /* WireValueType.RAW */,\n            value,\n        },\n        transferCache.get(value) || [],\n    ];\n}\nfunction fromWireValue(value) {\n    switch (value.type) {\n        case \"HANDLER\" /* WireValueType.HANDLER */:\n            return transferHandlers.get(value.name).deserialize(value.value);\n        case \"RAW\" /* WireValueType.RAW */:\n            return value.value;\n    }\n}\nfunction requestResponseMessage(ep, pendingListeners, msg, transfers) {\n    return new Promise((resolve) => {\n        const id = generateUUID();\n        pendingListeners.set(id, resolve);\n        if (ep.start) {\n            ep.start();\n        }\n        ep.postMessage(Object.assign({ id }, msg), transfers);\n    });\n}\nfunction generateUUID() {\n    return new Array(4)\n        .fill(0)\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\n        .join(\"-\");\n}\n\nexport { createEndpoint, expose, finalizer, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","const E_TIMEOUT = new Error('timeout while waiting for mutex to become available');\nconst E_ALREADY_LOCKED = new Error('mutex already locked');\nconst E_CANCELED = new Error('request for lock canceled');\n\nvar __awaiter$2 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass Semaphore {\n    constructor(_value, _cancelError = E_CANCELED) {\n        this._value = _value;\n        this._cancelError = _cancelError;\n        this._weightedQueues = [];\n        this._weightedWaiters = [];\n    }\n    acquire(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        return new Promise((resolve, reject) => {\n            if (!this._weightedQueues[weight - 1])\n                this._weightedQueues[weight - 1] = [];\n            this._weightedQueues[weight - 1].push({ resolve, reject });\n            this._dispatch();\n        });\n    }\n    runExclusive(callback, weight = 1) {\n        return __awaiter$2(this, void 0, void 0, function* () {\n            const [value, release] = yield this.acquire(weight);\n            try {\n                return yield callback(value);\n            }\n            finally {\n                release();\n            }\n        });\n    }\n    waitForUnlock(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        return new Promise((resolve) => {\n            if (!this._weightedWaiters[weight - 1])\n                this._weightedWaiters[weight - 1] = [];\n            this._weightedWaiters[weight - 1].push(resolve);\n            this._dispatch();\n        });\n    }\n    isLocked() {\n        return this._value <= 0;\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(value) {\n        this._value = value;\n        this._dispatch();\n    }\n    release(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        this._value += weight;\n        this._dispatch();\n    }\n    cancel() {\n        this._weightedQueues.forEach((queue) => queue.forEach((entry) => entry.reject(this._cancelError)));\n        this._weightedQueues = [];\n    }\n    _dispatch() {\n        var _a;\n        for (let weight = this._value; weight > 0; weight--) {\n            const queueEntry = (_a = this._weightedQueues[weight - 1]) === null || _a === void 0 ? void 0 : _a.shift();\n            if (!queueEntry)\n                continue;\n            const previousValue = this._value;\n            const previousWeight = weight;\n            this._value -= weight;\n            weight = this._value + 1;\n            queueEntry.resolve([previousValue, this._newReleaser(previousWeight)]);\n        }\n        this._drainUnlockWaiters();\n    }\n    _newReleaser(weight) {\n        let called = false;\n        return () => {\n            if (called)\n                return;\n            called = true;\n            this.release(weight);\n        };\n    }\n    _drainUnlockWaiters() {\n        for (let weight = this._value; weight > 0; weight--) {\n            if (!this._weightedWaiters[weight - 1])\n                continue;\n            this._weightedWaiters[weight - 1].forEach((waiter) => waiter());\n            this._weightedWaiters[weight - 1] = [];\n        }\n    }\n}\n\nvar __awaiter$1 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass Mutex {\n    constructor(cancelError) {\n        this._semaphore = new Semaphore(1, cancelError);\n    }\n    acquire() {\n        return __awaiter$1(this, void 0, void 0, function* () {\n            const [, releaser] = yield this._semaphore.acquire();\n            return releaser;\n        });\n    }\n    runExclusive(callback) {\n        return this._semaphore.runExclusive(() => callback());\n    }\n    isLocked() {\n        return this._semaphore.isLocked();\n    }\n    waitForUnlock() {\n        return this._semaphore.waitForUnlock();\n    }\n    release() {\n        if (this._semaphore.isLocked())\n            this._semaphore.release();\n    }\n    cancel() {\n        return this._semaphore.cancel();\n    }\n}\n\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nfunction withTimeout(sync, timeout, timeoutError = E_TIMEOUT) {\n    return {\n        acquire: (weight) => {\n            if (weight !== undefined && weight <= 0) {\n                throw new Error(`invalid weight ${weight}: must be positive`);\n            }\n            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n                let isTimeout = false;\n                const handle = setTimeout(() => {\n                    isTimeout = true;\n                    reject(timeoutError);\n                }, timeout);\n                try {\n                    const ticket = yield sync.acquire(weight);\n                    if (isTimeout) {\n                        const release = Array.isArray(ticket) ? ticket[1] : ticket;\n                        release();\n                    }\n                    else {\n                        clearTimeout(handle);\n                        resolve(ticket);\n                    }\n                }\n                catch (e) {\n                    if (!isTimeout) {\n                        clearTimeout(handle);\n                        reject(e);\n                    }\n                }\n            }));\n        },\n        runExclusive(callback, weight) {\n            return __awaiter(this, void 0, void 0, function* () {\n                let release = () => undefined;\n                try {\n                    const ticket = yield this.acquire(weight);\n                    if (Array.isArray(ticket)) {\n                        release = ticket[1];\n                        return yield callback(ticket[0]);\n                    }\n                    else {\n                        release = ticket;\n                        return yield callback();\n                    }\n                }\n                finally {\n                    release();\n                }\n            });\n        },\n        release(weight) {\n            sync.release(weight);\n        },\n        cancel() {\n            return sync.cancel();\n        },\n        waitForUnlock: (weight) => {\n            if (weight !== undefined && weight <= 0) {\n                throw new Error(`invalid weight ${weight}: must be positive`);\n            }\n            return new Promise((resolve, reject) => {\n                const handle = setTimeout(() => reject(timeoutError), timeout);\n                sync.waitForUnlock(weight).then(() => {\n                    clearTimeout(handle);\n                    resolve();\n                });\n            });\n        },\n        isLocked: () => sync.isLocked(),\n        getValue: () => sync.getValue(),\n        setValue: (value) => sync.setValue(value),\n    };\n}\n\n// eslint-disable-next-lisne @typescript-eslint/explicit-module-boundary-types\nfunction tryAcquire(sync, alreadyAcquiredError = E_ALREADY_LOCKED) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return withTimeout(sync, 0, alreadyAcquiredError);\n}\n\nexport { E_ALREADY_LOCKED, E_CANCELED, E_TIMEOUT, Mutex, Semaphore, tryAcquire, withTimeout };\n","import * as SQLite from '@journeyapps/wa-sqlite';\nimport '@journeyapps/wa-sqlite';\nimport * as Comlink from 'comlink';\nimport { Mutex } from 'async-mutex';\nlet nextId = 1;\nexport async function _openDB(dbFileName, options = { useWebWorker: true }) {\n    const { default: moduleFactory } = await import('@journeyapps/wa-sqlite/dist/wa-sqlite-async.mjs');\n    const module = await moduleFactory();\n    const sqlite3 = SQLite.Factory(module);\n    const { IDBBatchAtomicVFS } = await import('@journeyapps/wa-sqlite/src/examples/IDBBatchAtomicVFS.js');\n    const vfs = new IDBBatchAtomicVFS(dbFileName);\n    sqlite3.vfs_register(vfs, true);\n    const db = await sqlite3.open_v2(dbFileName);\n    const statementMutex = new Mutex();\n    /**\n     * Listeners are exclusive to the DB connection.\n     */\n    const listeners = new Map();\n    let updatedTables = new Set();\n    let updateTimer = null;\n    function fireUpdates() {\n        updateTimer = null;\n        const event = { tables: [...updatedTables], groupedUpdates: {}, rawUpdates: [] };\n        updatedTables.clear();\n        Array.from(listeners.values()).forEach((l) => l(event));\n    }\n    sqlite3.register_table_onchange_hook(db, (opType, tableName, rowId) => {\n        updatedTables.add(tableName);\n        if (updateTimer == null) {\n            updateTimer = setTimeout(fireUpdates, 0);\n        }\n    });\n    /**\n     * This executes single SQL statements inside a requested lock.\n     */\n    const execute = async (sql, bindings) => {\n        // Running multiple statements on the same connection concurrently should not be allowed\n        return _acquireExecuteLock(async () => {\n            return executeSingleStatement(sql, bindings);\n        });\n    };\n    /**\n     * This requests a lock for executing statements.\n     * Should only be used internally.\n     */\n    const _acquireExecuteLock = (callback) => {\n        return statementMutex.runExclusive(callback);\n    };\n    /**\n     * This executes a single statement using SQLite3.\n     */\n    const executeSingleStatement = async (sql, bindings) => {\n        const results = [];\n        for await (const stmt of sqlite3.statements(db, sql)) {\n            let columns;\n            const wrappedBindings = bindings ? [bindings] : [[]];\n            for (const binding of wrappedBindings) {\n                // TODO not sure why this is needed currently, but booleans break\n                binding.forEach((b, index, arr) => {\n                    if (typeof b == 'boolean') {\n                        arr[index] = b ? 1 : 0;\n                    }\n                });\n                sqlite3.reset(stmt);\n                if (bindings) {\n                    sqlite3.bind_collection(stmt, binding);\n                }\n                const rows = [];\n                while ((await sqlite3.step(stmt)) === SQLite.SQLITE_ROW) {\n                    const row = sqlite3.row(stmt);\n                    rows.push(row);\n                }\n                columns = columns ?? sqlite3.column_names(stmt);\n                if (columns.length) {\n                    results.push({ columns, rows });\n                }\n            }\n            // When binding parameters, only a single statement is executed.\n            if (bindings) {\n                break;\n            }\n        }\n        const rows = [];\n        for (const resultset of results) {\n            for (const row of resultset.rows) {\n                const outRow = {};\n                resultset.columns.forEach((key, index) => {\n                    outRow[key] = row[index];\n                });\n                rows.push(outRow);\n            }\n        }\n        const result = {\n            insertId: sqlite3.last_insert_id(db),\n            rowsAffected: sqlite3.changes(db),\n            rows: {\n                _array: rows,\n                length: rows.length\n            }\n        };\n        return result;\n    };\n    /**\n     * This executes SQL statements in a batch.\n     */\n    const executeBatch = async (sql, bindings) => {\n        return _acquireExecuteLock(async () => {\n            let affectedRows = 0;\n            const str = sqlite3.str_new(db, sql);\n            const query = sqlite3.str_value(str);\n            try {\n                await executeSingleStatement('BEGIN TRANSACTION');\n                //Prepare statement once\n                const prepared = await sqlite3.prepare_v2(db, query);\n                if (prepared === null) {\n                    return {\n                        rowsAffected: 0,\n                        rows: { _array: [], length: 0 }\n                    };\n                }\n                const wrappedBindings = bindings ? bindings : [];\n                for (const binding of wrappedBindings) {\n                    // TODO not sure why this is needed currently, but booleans break\n                    for (let i = 0; i < binding.length; i++) {\n                        const b = binding[i];\n                        if (typeof b == 'boolean') {\n                            binding[i] = b ? 1 : 0;\n                        }\n                    }\n                    //Reset bindings\n                    sqlite3.reset(prepared.stmt);\n                    if (bindings) {\n                        sqlite3.bind_collection(prepared.stmt, binding);\n                    }\n                    const result = await sqlite3.step(prepared.stmt);\n                    if (result === SQLite.SQLITE_DONE) {\n                        //The value returned by sqlite3_changes() immediately after an INSERT, UPDATE or DELETE statement run on a view is always zero.\n                        affectedRows += sqlite3.changes(db);\n                    }\n                }\n                //Finalize prepared statement\n                await sqlite3.finalize(prepared.stmt);\n                await executeSingleStatement('COMMIT');\n            }\n            catch (err) {\n                await executeSingleStatement('ROLLBACK');\n                return {\n                    rowsAffected: 0,\n                    rows: { _array: [], length: 0 }\n                };\n            }\n            finally {\n                sqlite3.str_finish(str);\n            }\n            const result = {\n                rowsAffected: affectedRows,\n                rows: { _array: [], length: 0 }\n            };\n            return result;\n        });\n    };\n    if (options.useWebWorker) {\n        const registerOnTableChange = (callback) => {\n            const id = nextId++;\n            listeners.set(id, callback);\n            return Comlink.proxy(() => {\n                listeners.delete(id);\n            });\n        };\n        return {\n            execute: Comlink.proxy(execute),\n            executeBatch: Comlink.proxy(executeBatch),\n            registerOnTableChange: Comlink.proxy(registerOnTableChange),\n            close: Comlink.proxy(() => {\n                sqlite3.close(db);\n            })\n        };\n    }\n    const registerOnTableChange = (callback) => {\n        const id = nextId++;\n        listeners.set(id, callback);\n        return () => {\n            listeners.delete(id);\n        };\n    };\n    return {\n        execute: execute,\n        executeBatch: executeBatch,\n        registerOnTableChange: registerOnTableChange,\n        close: () => sqlite3.close(db)\n    };\n}\n","/**\n * Supports both shared and dedicated workers, based on how the worker is constructed (new SharedWorker vs new Worker()).\n */\nimport '@journeyapps/wa-sqlite';\nimport * as Comlink from 'comlink';\nimport { _openDB } from '../../shared/open-db';\nconst DBMap = new Map();\nconst OPEN_DB_LOCK = 'open-wasqlite-db';\nlet nextClientId = 1;\nconst openDBShared = async (dbFileName) => {\n    // Prevent multiple simultaneous opens from causing race conditions\n    return navigator.locks.request(OPEN_DB_LOCK, async () => {\n        const clientId = nextClientId++;\n        if (!DBMap.has(dbFileName)) {\n            const clientIds = new Set();\n            const connection = await _openDB(dbFileName);\n            DBMap.set(dbFileName, {\n                clientIds,\n                db: connection\n            });\n        }\n        const dbEntry = DBMap.get(dbFileName);\n        dbEntry.clientIds.add(clientId);\n        const { db } = dbEntry;\n        const wrappedConnection = {\n            ...db,\n            close: Comlink.proxy(() => {\n                const { clientIds } = dbEntry;\n                clientIds.delete(clientId);\n                if (clientIds.size == 0) {\n                    console.debug(`Closing connection to ${dbFileName}.`);\n                    DBMap.delete(dbFileName);\n                    return db.close?.();\n                }\n                console.debug(`Connection to ${dbFileName} not closed yet due to active clients.`);\n            })\n        };\n        return Comlink.proxy(wrappedConnection);\n    });\n};\nconst openDBDedicated = async (dbFileName) => {\n    const connection = await _openDB(dbFileName);\n    return Comlink.proxy(connection);\n};\n// Check if we're in a SharedWorker context\nif (typeof SharedWorkerGlobalScope !== 'undefined') {\n    const _self = self;\n    _self.onconnect = function (event) {\n        const port = event.ports[0];\n        console.debug('Exposing shared db on port', port);\n        Comlink.expose(openDBShared, port);\n    };\n    addEventListener('unload', () => {\n        Array.from(DBMap.values()).forEach(async (dbConnection) => {\n            const db = await dbConnection.db;\n            db.close?.();\n        });\n    });\n}\nelse {\n    Comlink.expose(openDBDedicated);\n}\n"],"names":["SQLITE_OK","SQLITE_BUSY","SQLITE_IOERR","SQLITE_NOTFOUND","SQLITE_CANTOPEN","SQLITE_IOERR_LOCK","SQLITE_IOERR_SHORT_READ","SQLITE_OPEN_READONLY","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_LOCK_NONE","SQLITE_LOCK_SHARED","SQLITE_LOCK_RESERVED","SQLITE_LOCK_PENDING","SQLITE_LOCK_EXCLUSIVE","SQLITE_IOCAP_SAFE_APPEND","SQLITE_IOCAP_SEQUENTIAL","SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN","SQLITE_IOCAP_BATCH_ATOMIC","MAX_INT64","MIN_INT64","SQLiteError","message","code","async","onTableChangeCallbacks","db","opType","tableName","rowId","Factory","Module","sqlite3","sqliteFreeAddress","tmp","tmpPtr","createUTF8","n","zts","cvt32x2ToBigInt","lo32","hi32","cvt32x2AsSafe","hiMax","hiMin","databases","verifyDatabase","SQLite.SQLITE_MISUSE","mapStmtToDB","verifyStatement","stmt","bindings","isArray","nBindings","i","key","value","SQLite.SQLITE_OK","SQLite.SQLITE_NOTICE","fname","f","decl","byteLength","ptr","result","check","SQLite.SQLITE_RANGE","iCol","type","SQLite.SQLITE_BLOB","SQLite.SQLITE_FLOAT","SQLite.SQLITE_INTEGER","SQLite.SQLITE_NULL","SQLite.SQLITE_TEXT","nBytes","address","columns","nColumns","zFunctionName","nArg","eTextRep","pApp","xFunc","xStep","xFinal","zName","module","appData","pVTab","zSQL","sql","callback","SQLite.SQLITE_ROW","row","id","newVal","zFilename","flags","zVfs","SQLite.SQLITE_OPEN_CREATE","tableNamePtr","memory","length","stringBytes","nProgressOps","handler","userData","context","authFunction","str","prepared","SQLite.SQLITE_DONE","stringId","strings","s","sBytes","data","newBytes","newOffset","pValue","vfs","makeDefault","allowed","m","args","c","proxyMarker","createEndpoint","releaseProxy","finalizer","throwMarker","isObject","val","proxyTransferHandler","obj","port1","port2","expose","port","wrap","throwTransferHandler","serialized","transferHandlers","isAllowedOrigin","allowedOrigins","origin","allowedOrigin","ep","ev","path","argumentList","fromWireValue","returnValue","parent","prop","rawValue","proxy","transfer","wireValue","transferables","toWireValue","closeEndPoint","error","isMessagePort","endpoint","target","pendingListeners","resolver","createProxy","throwIfProxyReleased","isReleased","releaseEndpoint","requestResponseMessage","proxyCounter","proxyFinalizers","newCount","registerProxy","unregisterProxy","isProxyReleased","_target","r","p","_thisArg","rawArgumentList","last","processArguments","myFlat","arr","processed","v","transferCache","transfers","name","serializedValue","msg","resolve","generateUUID","E_CANCELED","__awaiter$2","thisArg","_arguments","P","generator","adopt","reject","fulfilled","step","e","rejected","Semaphore","_value","_cancelError","weight","release","queue","entry","_a","queueEntry","previousValue","previousWeight","called","waiter","__awaiter$1","Mutex","cancelError","releaser","nextId","_openDB","dbFileName","options","moduleFactory","SQLite.Factory","IDBBatchAtomicVFS","statementMutex","listeners","updatedTables","updateTimer","fireUpdates","event","l","execute","_acquireExecuteLock","executeSingleStatement","results","wrappedBindings","binding","b","index","rows","resultset","outRow","executeBatch","affectedRows","query","registerOnTableChange","Comlink.proxy","DBMap","OPEN_DB_LOCK","nextClientId","openDBShared","clientId","clientIds","connection","dbEntry","wrappedConnection","openDBDedicated","_self","Comlink.expose","dbConnection"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5]}