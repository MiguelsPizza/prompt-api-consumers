let Qn,An,xn,Nn,Pn,Bn,Dn,Wn,Hn,On,Rn,Un,kn,Cn,vn,Kn,Fn,zn,Gn;let __tla=(async()=>{An=0;On=5;Qn=10;xn=12;Nn=14;Rn=3850;vn=522;kn=1;Un=4;Cn=8;Pn=0;Bn=1;Dn=2;Wn=3;Hn=4;Fn=512;zn=1024;Gn=2048;Kn=16384;typeof BigInt.prototype.toJSON>"u"&&(BigInt.prototype.toJSON=function(){return this.toString()});const K=0x7fffffffffffffffn,V=-0x8000000000000000n;class O extends Error{constructor(n,i){super(n),this.code=i}}const R=!0,X={};globalThis.__onTablesChanged=function(t,n,i,w){X[t]?.(n,i,w)};function sn(t){const n={},i=t._getSqliteFree(),w=t._malloc(8),a=[w,w+4];function h(s){if(typeof s!="string")return 0;const r=t.lengthBytesUTF8(s),e=t._sqlite3_malloc(r+1);return t.stringToUTF8(s,e,r+1),e}function g(s,r){return BigInt(r)<<32n|BigInt(s)&4294967295n}const p=function(){const s=BigInt(Number.MAX_SAFE_INTEGER)>>32n,r=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(e,c){return c>s||c<r?g(e,c):c*0x100000000+(e&0x7fffffff)-(e&0x80000000)}}(),b=new Set;function m(s){if(!b.has(s))throw new O("not a database",21)}const f=new Map;function l(s){if(!f.has(s))throw new O("not a statement",21)}n.bind_collection=function(s,r){l(s);const e=Array.isArray(r),c=n.bind_parameter_count(s);for(let o=1;o<=c;++o){const u=e?o-1:n.bind_parameter_name(s,o),E=r[u];E!==void 0&&n.bind(s,o,E)}return 0},n.bind=function(s,r,e){switch(l(s),typeof e){case"number":return e===(e|0)?n.bind_int(s,r,e):n.bind_double(s,r,e);case"string":return n.bind_text(s,r,e);default:return e instanceof Uint8Array||Array.isArray(e)?n.bind_blob(s,r,e):e===null?n.bind_null(s,r):typeof e=="bigint"?n.bind_int64(s,r,e):e===void 0?27:(console.warn("unknown binding converted to null",e),n.bind_null(s,r))}},n.bind_blob=function(){const s="sqlite3_bind_blob",r=t.cwrap(s,..._("nnnnn:n"));return function(e,c,o){l(e);const u=o.byteLength??o.length,E=t._sqlite3_malloc(u);t.HEAPU8.subarray(E).set(o);const L=r(e,c,E,u,i);return y(s,L,f.get(e))}}(),n.bind_parameter_count=function(){const r=t.cwrap("sqlite3_bind_parameter_count",..._("n:n"));return function(e){return l(e),r(e)}}(),n.bind_double=function(){const s="sqlite3_bind_double",r=t.cwrap(s,..._("nnn:n"));return function(e,c,o){l(e);const u=r(e,c,o);return y(s,u,f.get(e))}}(),n.bind_int=function(){const s="sqlite3_bind_int",r=t.cwrap(s,..._("nnn:n"));return function(e,c,o){if(l(e),o>0x7fffffff||o<-0x80000000)return 25;const u=r(e,c,o);return y(s,u,f.get(e))}}(),n.bind_int64=function(){const s="sqlite3_bind_int64",r=t.cwrap(s,..._("nnnn:n"));return function(e,c,o){if(l(e),o>K||o<V)return 25;const u=o&4294967295n,E=o>>32n,L=r(e,c,Number(u),Number(E));return y(s,L,f.get(e))}}(),n.bind_null=function(){const s="sqlite3_bind_null",r=t.cwrap(s,..._("nn:n"));return function(e,c){l(e);const o=r(e,c);return y(s,o,f.get(e))}}(),n.bind_parameter_name=function(){const r=t.cwrap("sqlite3_bind_parameter_name",..._("n:s"));return function(e,c){return l(e),r(e,c)}}(),n.bind_text=function(){const s="sqlite3_bind_text",r=t.cwrap(s,..._("nnnnn:n"));return function(e,c,o){l(e);const u=h(o),E=r(e,c,u,-1,i);return y(s,E,f.get(e))}}(),n.changes=function(){const r=t.cwrap("sqlite3_changes",..._("n:n"));return function(e){return m(e),r(e)}}(),n.last_insert_id=function(){const r=t.cwrap("sqlite3_last_insert_rowid",..._("n:n"));return function(e){return m(e),r(e)}}(),n.close=function(){const s="sqlite3_close",r=t.cwrap(s,..._("n:n"),{async:R});return async function(e){m(e);const c=await r(e);return b.delete(e),y(s,c,e)}}(),n.column=function(s,r){l(s);const e=n.column_type(s,r);switch(e){case 4:return n.column_blob(s,r);case 2:return n.column_double(s,r);case 1:const c=n.column_int(s,r),o=t.getTempRet0();return p(c,o);case 5:return null;case 3:return n.column_text(s,r);default:throw new O("unknown type",e)}},n.column_blob=function(){const r=t.cwrap("sqlite3_column_blob",..._("nn:n"));return function(e,c){l(e);const o=n.column_bytes(e,c),u=r(e,c);return t.HEAPU8.subarray(u,u+o)}}(),n.column_bytes=function(){const r=t.cwrap("sqlite3_column_bytes",..._("nn:n"));return function(e,c){return l(e),r(e,c)}}(),n.column_count=function(){const r=t.cwrap("sqlite3_column_count",..._("n:n"));return function(e){return l(e),r(e)}}(),n.column_double=function(){const r=t.cwrap("sqlite3_column_double",..._("nn:n"));return function(e,c){return l(e),r(e,c)}}(),n.column_int=function(){const r=t.cwrap("sqlite3_column_int64",..._("nn:n"));return function(e,c){return l(e),r(e,c)}}(),n.column_int64=function(){const r=t.cwrap("sqlite3_column_int64",..._("nn:n"));return function(e,c){l(e);const o=r(e,c),u=t.getTempRet0();return g(o,u)}}(),n.column_name=function(){const r=t.cwrap("sqlite3_column_name",..._("nn:s"));return function(e,c){return l(e),r(e,c)}}(),n.column_names=function(s){const r=[],e=n.column_count(s);for(let c=0;c<e;++c)r.push(n.column_name(s,c));return r},n.column_text=function(){const r=t.cwrap("sqlite3_column_text",..._("nn:s"));return function(e,c){return l(e),r(e,c)}}(),n.column_type=function(){const r=t.cwrap("sqlite3_column_type",..._("nn:n"));return function(e,c){return l(e),r(e,c)}}(),n.create_function=function(s,r,e,c,o,u,E,L){if(m(s),u&&!E&&!L){const S=t.createFunction(s,r,e,c,o,u);return y("sqlite3_create_function",S,s)}if(!u&&E&&L){const S=t.createAggregate(s,r,e,c,o,E,L);return y("sqlite3_create_function",S,s)}throw new O("invalid function combination",21)},n.create_module=function(s,r,e,c){m(s);const o=t.createModule(s,r,e,c);return y("sqlite3_create_module",o,s)},n.data_count=function(){const r=t.cwrap("sqlite3_data_count",..._("n:n"));return function(e){return l(e),r(e)}}(),n.declare_vtab=function(){const r=t.cwrap("sqlite3_declare_vtab",..._("ns:n"));return function(e,c){const o=r(e,c);return y("sqlite3_declare_vtab",o)}}(),n.exec=async function(s,r,e){for await(const c of n.statements(s,r)){let o;for(;await n.step(c)===100;)if(e){o=o??n.column_names(c);const u=n.row(c);await e(u,o)}}return 0},n.finalize=function(){const r=t.cwrap("sqlite3_finalize",..._("n:n"),{async:R});return async function(e){if(!f.has(e))return 21;const c=await r(e);return f.get(e),f.delete(e),c}}(),n.get_autocommit=function(){const r=t.cwrap("sqlite3_get_autocommit",..._("n:n"));return function(e){return r(e)}}(),n.libversion=function(){const r=t.cwrap("sqlite3_libversion",..._(":s"));return function(){return r()}}(),n.libversion_number=function(){const r=t.cwrap("sqlite3_libversion_number",..._(":n"));return function(){return r()}}(),n.limit=function(){const r=t.cwrap("sqlite3_limit",..._("nnn:n"));return function(e,c,o){return r(e,c,o)}}(),n.open_v2=function(){const s="sqlite3_open_v2",r=t.cwrap(s,..._("snnn:n"),{async:R});return async function(e,c,o){c=c||6,o=h(o),t.ccall("setup_powersync","int",[]);const u=await r(e,a[0],c,o),E=t.getValue(a[0],"*");return b.add(E),t._sqlite3_free(o),t.ccall("RegisterExtensionFunctions","void",["number"],[E]),y(s,u),E}}(),n.register_table_onchange_hook=function(s,r){t.ccall("register_table_update_hook","int",["number"],[s]),X[s]=function(e,c,o){const u=new DataView(t.HEAPU8.buffer);let E=0;for(;u.getUint8(c+E)!==0;)E++;const L=new Uint8Array(t.HEAPU8.buffer,c,E),S=new TextDecoder().decode(L);setTimeout(()=>r(e,S,o),0)}},n.prepare_v2=function(){const s="sqlite3_prepare_v2",r=t.cwrap(s,..._("nnnnn:n"),{async:R});return async function(e,c){const o=await r(e,c,-1,a[0],a[1]);y(s,o,e);const u=t.getValue(a[0],"*");return u?(f.set(u,e),{stmt:u,sql:t.getValue(a[1],"*")}):null}}(),n.progress_handler=function(s,r,e,c){m(s),t.progressHandler(s,r,e,c)},n.reset=function(){const s="sqlite3_reset",r=t.cwrap(s,..._("n:n"),{async:R});return async function(e){l(e);const c=await r(e);return y(s,c,f.get(e))}}(),n.result=function(s,r){switch(typeof r){case"number":r===(r|0)?n.result_int(s,r):n.result_double(s,r);break;case"string":n.result_text(s,r);break;default:if(r instanceof Uint8Array||Array.isArray(r))n.result_blob(s,r);else if(r===null)n.result_null(s);else{if(typeof r=="bigint")return n.result_int64(s,r);console.warn("unknown result converted to null",r),n.result_null(s)}break}},n.result_blob=function(){const r=t.cwrap("sqlite3_result_blob",..._("nnnn:n"));return function(e,c){const o=c.byteLength??c.length,u=t._sqlite3_malloc(o);t.HEAPU8.subarray(u).set(c),r(e,u,o,i)}}(),n.result_double=function(){const r=t.cwrap("sqlite3_result_double",..._("nn:n"));return function(e,c){r(e,c)}}(),n.result_int=function(){const r=t.cwrap("sqlite3_result_int",..._("nn:n"));return function(e,c){r(e,c)}}(),n.result_int64=function(){const r=t.cwrap("sqlite3_result_int64",..._("nnn:n"));return function(e,c){if(c>K||c<V)return 25;const o=c&4294967295n,u=c>>32n;r(e,Number(o),Number(u))}}(),n.result_null=function(){const r=t.cwrap("sqlite3_result_null",..._("n:n"));return function(e){r(e)}}(),n.result_text=function(){const r=t.cwrap("sqlite3_result_text",..._("nnnn:n"));return function(e,c){const o=h(c);r(e,o,-1,i)}}(),n.row=function(s){const r=[],e=n.data_count(s);for(let c=0;c<e;++c){const o=n.column(s,c);r.push(o?.buffer===t.HEAPU8.buffer?o.slice():o)}return r},n.set_authorizer=function(s,r,e){m(s);const c=t.setAuthorizer(s,r,e);return y("sqlite3_set_authorizer",c,s)},n.sql=function(){const r=t.cwrap("sqlite3_sql",..._("n:s"));return function(e){return l(e),r(e)}}(),n.statements=function(s,r){return async function*(){const e=n.str_new(s,r);let c={stmt:null,sql:n.str_value(e)};try{for(;c=await n.prepare_v2(s,c.sql);)yield c.stmt,n.finalize(c.stmt),c.stmt=null}finally{c?.stmt&&n.finalize(c.stmt),n.str_finish(e)}}()},n.step=function(){const s="sqlite3_step",r=t.cwrap(s,..._("n:n"),{async:R});return async function(e){l(e);const c=await r(e);return y(s,c,f.get(e),[100,101])}}();let T=0;const d=new Map;n.str_new=function(s,r=""){const e=t.lengthBytesUTF8(r),c=T++&0xffffffff,o={offset:t._sqlite3_malloc(e+1),bytes:e};return d.set(c,o),t.stringToUTF8(r,o.offset,o.bytes+1),c},n.str_appendall=function(s,r){if(!d.has(s))throw new O("not a string",21);const e=d.get(s),c=t.lengthBytesUTF8(r),o=e.bytes+c,u=t._sqlite3_malloc(o+1);t.HEAPU8.subarray(u,u+o+1).set(t.HEAPU8.subarray(e.offset,e.offset+e.bytes)),t.stringToUTF8(r,u+e.bytes,c+1),t._sqlite3_free(e.offset),e.offset=u,e.bytes=o,d.set(s,e)},n.str_finish=function(s){if(!d.has(s))throw new O("not a string",21);const r=d.get(s);d.delete(s),t._sqlite3_free(r.offset)},n.str_value=function(s){if(!d.has(s))throw new O("not a string",21);return d.get(s).offset},n.user_data=function(s){return t.getFunctionUserData(s)},n.value=function(s){const r=n.value_type(s);switch(r){case 4:return n.value_blob(s);case 2:return n.value_double(s);case 1:const e=n.value_int(s),c=t.getTempRet0();return p(e,c);case 5:return null;case 3:return n.value_text(s);default:throw new O("unknown type",r)}},n.value_blob=function(){const r=t.cwrap("sqlite3_value_blob",..._("n:n"));return function(e){const c=n.value_bytes(e),o=r(e);return t.HEAPU8.subarray(o,o+c)}}(),n.value_bytes=function(){const r=t.cwrap("sqlite3_value_bytes",..._("n:n"));return function(e){return r(e)}}(),n.value_double=function(){const r=t.cwrap("sqlite3_value_double",..._("n:n"));return function(e){return r(e)}}(),n.value_int=function(){const r=t.cwrap("sqlite3_value_int64",..._("n:n"));return function(e){return r(e)}}(),n.value_int64=function(){const r=t.cwrap("sqlite3_value_int64",..._("n:n"));return function(e){const c=r(e),o=t.getTempRet0();return g(c,o)}}(),n.value_text=function(){const r=t.cwrap("sqlite3_value_text",..._("n:s"));return function(e){return r(e)}}(),n.value_type=function(){const r=t.cwrap("sqlite3_value_type",..._("n:n"));return function(e){return r(e)}}(),n.vfs_register=function(s,r){const e=t.registerVFS(s,r);return y("sqlite3_vfs_register",e)};function y(s,r,e=null,c=[0]){if(c.includes(r))return r;const o=e?t.ccall("sqlite3_errmsg","string",["number"],[e]):s;throw new O(o,r)}return n}function _(t){const n=[],i=t.match(/([ns@]*):([nsv@])/);switch(i[2]){case"n":n.push("number");break;case"s":n.push("string");break;case"v":n.push(null);break}const w=[];for(let a of i[1])switch(a){case"n":w.push("number");break;case"s":w.push("string");break}return n.push(w),n}const Y=Symbol("Comlink.proxy"),cn=Symbol("Comlink.endpoint"),on=Symbol("Comlink.releaseProxy"),z=Symbol("Comlink.finalizer"),B=Symbol("Comlink.thrown"),J=t=>typeof t=="object"&&t!==null||typeof t=="function",an={canHandle:t=>J(t)&&t[Y],serialize(t){const{port1:n,port2:i}=new MessageChannel;return D(t,n),[i,[i]]},deserialize(t){return t.start(),_n(t)}},un={canHandle:t=>J(t)&&B in t,serialize({value:t}){let n;return t instanceof Error?n={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:n={isError:!1,value:t},[n,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},Z=new Map([["proxy",an],["throw",un]]);function fn(t,n){for(const i of t)if(n===i||i==="*"||i instanceof RegExp&&i.test(n))return!0;return!1}function D(t,n=globalThis,i=["*"]){n.addEventListener("message",function w(a){if(!a||!a.data)return;if(!fn(i,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:h,type:g,path:p}=Object.assign({path:[]},a.data),b=(a.data.argumentList||[]).map(x);let m;try{const f=p.slice(0,-1).reduce((T,d)=>T[d],t),l=p.reduce((T,d)=>T[d],t);switch(g){case"GET":m=l;break;case"SET":f[p.slice(-1)[0]]=x(a.data.value),m=!0;break;case"APPLY":m=l.apply(f,b);break;case"CONSTRUCT":{const T=new l(...b);m=Q(T)}break;case"ENDPOINT":{const{port1:T,port2:d}=new MessageChannel;D(t,d),m=En(T,[T])}break;case"RELEASE":m=void 0;break;default:return}}catch(f){m={value:f,[B]:0}}Promise.resolve(m).catch(f=>({value:f,[B]:0})).then(f=>{const[l,T]=F(f);n.postMessage(Object.assign(Object.assign({},l),{id:h}),T),g==="RELEASE"&&(n.removeEventListener("message",w),M(n),z in t&&typeof t[z]=="function"&&t[z]())}).catch(f=>{const[l,T]=F({value:new TypeError("Unserializable return value"),[B]:0});n.postMessage(Object.assign(Object.assign({},l),{id:h}),T)})}),n.start&&n.start()}function ln(t){return t.constructor.name==="MessagePort"}function M(t){ln(t)&&t.close()}function _n(t,n){const i=new Map;return t.addEventListener("message",function(a){const{data:h}=a;if(!h||!h.id)return;const g=i.get(h.id);if(g)try{g(h)}finally{i.delete(h.id)}}),G(t,i,[],n)}function P(t){if(t)throw new Error("Proxy has been released and is not useable")}function nn(t){return v(t,new Map,{type:"RELEASE"}).then(()=>{M(t)})}const W=new WeakMap,H="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const n=(W.get(t)||0)-1;W.set(t,n),n===0&&nn(t)});function hn(t,n){const i=(W.get(n)||0)+1;W.set(n,i),H&&H.register(t,n,t)}function wn(t){H&&H.unregister(t)}function G(t,n,i=[],w=function(){}){let a=!1;const h=new Proxy(w,{get(g,p){if(P(a),p===on)return()=>{wn(h),nn(t),n.clear(),a=!0};if(p==="then"){if(i.length===0)return{then:()=>h};const b=v(t,n,{type:"GET",path:i.map(m=>m.toString())}).then(x);return b.then.bind(b)}return G(t,n,[...i,p])},set(g,p,b){P(a);const[m,f]=F(b);return v(t,n,{type:"SET",path:[...i,p].map(l=>l.toString()),value:m},f).then(x)},apply(g,p,b){P(a);const m=i[i.length-1];if(m===cn)return v(t,n,{type:"ENDPOINT"}).then(x);if(m==="bind")return G(t,n,i.slice(0,-1));const[f,l]=$(b);return v(t,n,{type:"APPLY",path:i.map(T=>T.toString()),argumentList:f},l).then(x)},construct(g,p){P(a);const[b,m]=$(p);return v(t,n,{type:"CONSTRUCT",path:i.map(f=>f.toString()),argumentList:b},m).then(x)}});return hn(h,t),h}function mn(t){return Array.prototype.concat.apply([],t)}function $(t){const n=t.map(F);return[n.map(i=>i[0]),mn(n.map(i=>i[1]))]}const tn=new WeakMap;function En(t,n){return tn.set(t,n),t}function Q(t){return Object.assign(t,{[Y]:!0})}function F(t){for(const[n,i]of Z)if(i.canHandle(t)){const[w,a]=i.serialize(t);return[{type:"HANDLER",name:n,value:w},a]}return[{type:"RAW",value:t},tn.get(t)||[]]}function x(t){switch(t.type){case"HANDLER":return Z.get(t.name).deserialize(t.value);case"RAW":return t.value}}function v(t,n,i,w){return new Promise(a=>{const h=pn();n.set(h,a),t.start&&t.start(),t.postMessage(Object.assign({id:h},i),w)})}function pn(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const gn=new Error("request for lock canceled");var bn=function(t,n,i,w){function a(h){return h instanceof i?h:new i(function(g){g(h)})}return new(i||(i=Promise))(function(h,g){function p(f){try{m(w.next(f))}catch(l){g(l)}}function b(f){try{m(w.throw(f))}catch(l){g(l)}}function m(f){f.done?h(f.value):a(f.value).then(p,b)}m((w=w.apply(t,n||[])).next())})};class yn{constructor(n,i=gn){this._value=n,this._cancelError=i,this._weightedQueues=[],this._weightedWaiters=[]}acquire(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise((i,w)=>{this._weightedQueues[n-1]||(this._weightedQueues[n-1]=[]),this._weightedQueues[n-1].push({resolve:i,reject:w}),this._dispatch()})}runExclusive(n,i=1){return bn(this,void 0,void 0,function*(){const[w,a]=yield this.acquire(i);try{return yield n(w)}finally{a()}})}waitForUnlock(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);return new Promise(i=>{this._weightedWaiters[n-1]||(this._weightedWaiters[n-1]=[]),this._weightedWaiters[n-1].push(i),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(n){this._value=n,this._dispatch()}release(n=1){if(n<=0)throw new Error(`invalid weight ${n}: must be positive`);this._value+=n,this._dispatch()}cancel(){this._weightedQueues.forEach(n=>n.forEach(i=>i.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var n;for(let i=this._value;i>0;i--){const w=(n=this._weightedQueues[i-1])===null||n===void 0?void 0:n.shift();if(!w)continue;const a=this._value,h=i;this._value-=i,i=this._value+1,w.resolve([a,this._newReleaser(h)])}this._drainUnlockWaiters()}_newReleaser(n){let i=!1;return()=>{i||(i=!0,this.release(n))}}_drainUnlockWaiters(){for(let n=this._value;n>0;n--)this._weightedWaiters[n-1]&&(this._weightedWaiters[n-1].forEach(i=>i()),this._weightedWaiters[n-1]=[])}}var Tn=function(t,n,i,w){function a(h){return h instanceof i?h:new i(function(g){g(h)})}return new(i||(i=Promise))(function(h,g){function p(f){try{m(w.next(f))}catch(l){g(l)}}function b(f){try{m(w.throw(f))}catch(l){g(l)}}function m(f){f.done?h(f.value):a(f.value).then(p,b)}m((w=w.apply(t,n||[])).next())})};class dn{constructor(n){this._semaphore=new yn(1,n)}acquire(){return Tn(this,void 0,void 0,function*(){const[,n]=yield this._semaphore.acquire();return n})}runExclusive(n){return this._semaphore.runExclusive(()=>n())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}let j=1;async function en(t,n={useWebWorker:!0}){const{default:i}=await import("./wa-sqlite-async-DtsIopgF.js"),w=await i(),a=sn(w),{IDBBatchAtomicVFS:h}=await import("./IDBBatchAtomicVFS-TaNwt78X.js"),g=new h(t);a.vfs_register(g,!0);const p=await a.open_v2(t),b=new dn,m=new Map;let f=new Set,l=null;function T(){l=null;const c={tables:[...f],groupedUpdates:{},rawUpdates:[]};f.clear(),Array.from(m.values()).forEach(o=>o(c))}a.register_table_onchange_hook(p,(c,o,u)=>{f.add(o),l==null&&(l=setTimeout(T,0))});const d=async(c,o)=>y(async()=>s(c,o)),y=c=>b.runExclusive(c),s=async(c,o)=>{const u=[];for await(const S of a.statements(p,c)){let I;const N=o?[o]:[[]];for(const q of N){q.forEach((A,C,rn)=>{typeof A=="boolean"&&(rn[C]=A?1:0)}),a.reset(S),o&&a.bind_collection(S,q);const k=[];for(;await a.step(S)===100;){const A=a.row(S);k.push(A)}I=I??a.column_names(S),I.length&&u.push({columns:I,rows:k})}if(o)break}const E=[];for(const S of u)for(const I of S.rows){const N={};S.columns.forEach((q,k)=>{N[q]=I[k]}),E.push(N)}return{insertId:a.last_insert_id(p),rowsAffected:a.changes(p),rows:{_array:E,length:E.length}}},r=async(c,o)=>y(async()=>{let u=0;const E=a.str_new(p,c),L=a.str_value(E);try{await s("BEGIN TRANSACTION");const I=await a.prepare_v2(p,L);if(I===null)return{rowsAffected:0,rows:{_array:[],length:0}};const N=o||[];for(const q of N){for(let A=0;A<q.length;A++){const C=q[A];typeof C=="boolean"&&(q[A]=C?1:0)}a.reset(I.stmt),o&&a.bind_collection(I.stmt,q),await a.step(I.stmt)===101&&(u+=a.changes(p))}await a.finalize(I.stmt),await s("COMMIT")}catch{return await s("ROLLBACK"),{rowsAffected:0,rows:{_array:[],length:0}}}finally{a.str_finish(E)}return{rowsAffected:u,rows:{_array:[],length:0}}});if(n.useWebWorker){const c=o=>{const u=j++;return m.set(u,o),Q(()=>{m.delete(u)})};return{execute:Q(d),executeBatch:Q(r),registerOnTableChange:Q(c),close:Q(()=>{a.close(p)})}}return{execute:d,executeBatch:r,registerOnTableChange:c=>{const o=j++;return m.set(o,c),()=>{m.delete(o)}},close:()=>a.close(p)}}const U=new Map,Sn="open-wasqlite-db";let In=1;const Ln=async t=>navigator.locks.request(Sn,async()=>{const n=In++;if(!U.has(t)){const h=new Set,g=await en(t);U.set(t,{clientIds:h,db:g})}const i=U.get(t);i.clientIds.add(n);const{db:w}=i,a={...w,close:Q(()=>{const{clientIds:h}=i;if(h.delete(n),h.size==0)return console.debug(`Closing connection to ${t}.`),U.delete(t),w.close?.();console.debug(`Connection to ${t} not closed yet due to active clients.`)})};return Q(a)}),qn=async t=>{const n=await en(t);return Q(n)};if(typeof SharedWorkerGlobalScope<"u"){const t=self;t.onconnect=function(n){const i=n.ports[0];console.debug("Exposing shared db on port",i),D(Ln,i)},addEventListener("unload",()=>{Array.from(U.values()).forEach(async n=>{(await n.db).close?.()})})}else D(qn)})();export{Qn as S,An as a,xn as b,Nn as c,Pn as d,Bn as e,Dn as f,Wn as g,Hn as h,On as i,Rn as j,Un as k,kn as l,Cn as m,vn as n,Kn as o,Fn as p,zn as q,Gn as r,__tla};